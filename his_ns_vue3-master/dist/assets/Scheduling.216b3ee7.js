import{f as E,p as F}from"./api.12427e84.js";import{i as fe,g as me,f as A,n as ge}from"./utils.1f1ce994.js";import{_ as ve,r,l as ce,s as M,b as i,c as _e,o as v,d as x,h as l,g as t,e as Y,F as U,m,p as J,i as c,w as G,f as $,E as De}from"./index.eaac7b27.js";const be={class:"search-controls"},ye={class:"dialog-footer"},Ve={class:"dialog-footer"},we={__name:"Scheduling",setup(he){const Q=r(!1),B=r(!1),D=r({}),R=r([]),N=r([]),I=r(""),S=r(""),b=r(["",""]),q=r(10),H=[10,20,30,50],K=r(1),w=r(!1),h=r(!1),k=r(null),p=r({id:"",realName:"",schedDate:"",noon:"",registQuota:0}),W=r({registQuota:[{required:!0,message:"\u8BF7\u8F93\u5165\u6302\u53F7\u9650\u989D",trigger:"blur"},{type:"number",message:"\u6302\u53F7\u9650\u989D\u5FC5\u987B\u4E3A\u6570\u5B57"}],schedDate:[{required:!0,message:"\u8BF7\u9009\u62E9\u6392\u73ED\u65E5\u671F",trigger:"change"}],noon:[{required:!0,message:"\u8BF7\u9009\u62E9\u5348\u522B",trigger:"change"}]}),O={deptId:"",ndate:[],ruleSelection:[]},s=r(JSON.parse(JSON.stringify(O))),X=r({deptId:[{required:!0,message:"\u8BF7\u9009\u62E9\u79D1\u5BA4",trigger:"change"}],ndate:[{required:!0,message:"\u8BF7\u9009\u62E9\u6392\u73ED\u65E5\u671F\u8303\u56F4",trigger:"change"}],ruleSelection:[{required:!0,type:"array",message:"\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u6392\u73ED\u89C4\u5219",trigger:"change"}]});function g(n=1){Q.value=!0,K.value=n;const e=new URLSearchParams;e.append("pn",n),e.append("count",q.value),I.value&&e.append("keyword",I.value),S.value&&e.append("deptId",S.value),b.value&&b.value.length===2&&(e.append("start",b.value[0]),e.append("end",b.value[1])),E(`/scheduling/page?${e.toString()}`).then(o=>{o.result?D.value=o.data:o.errMsg==="\u672A\u767B\u5F55"?M.push("/login"):m.error(o.errMsg||"\u6570\u636E\u52A0\u8F7D\u5931\u8D25")}).catch(o=>{console.error(o),m.error("\u8BF7\u6C42\u5F02\u5E38\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")}).finally(()=>{Q.value=!1})}function Z(){const n=[],[e,o]=s.value.ndate;if(!e||!o){m.error("\u8BF7\u9009\u62E9\u6709\u6548\u7684\u65E5\u671F\u8303\u56F4");return}let y=new Date(e);const C=new Date(o);s.value.ruleSelection.forEach(f=>{let d=new Date(y);for(;fe(d,C);){const V=me(d),u=f.week;u[(V-1)*2]==="1"&&n.push({schedDate:A(d),deptID:s.value.deptId,userID:f.userID,noon:"\u4E0A\u5348",ruleID:f.id}),u[(V-1)*2+1]==="1"&&n.push({schedDate:A(d),deptID:s.value.deptId,userID:f.userID,noon:"\u4E0B\u5348",ruleID:f.id}),d=ge(d)}}),n.length>0?F("/scheduling/add",n).then(f=>{f.data.result?(w.value=!1,g(1),m.success("\u6392\u73ED\u8BA1\u5212\u751F\u6210\u6210\u529F")):m.error(f.data.errMsg||"\u6392\u73ED\u8BA1\u5212\u751F\u6210\u5931\u8D25")}).catch(f=>{m.error("\u8BF7\u6C42\u5931\u8D25")}):m.warning("\u6839\u636E\u60A8\u7684\u89C4\u5219\u548C\u65E5\u671F\u8303\u56F4\uFF0C\u6CA1\u6709\u751F\u6210\u4EFB\u4F55\u6392\u73ED\u6761\u76EE\u3002")}ce(async()=>{g(1),ee()});async function ee(){const e=await E("/department/page?count=200&pn=1",null);e.result?R.value=e.data.records:e.errMsg=="\u672A\u767B\u5F55"&&M.push("/login")}async function le(){if(!s.value.deptId){N.value=[];return}B.value=!0;let n=`/rule/page?count=200&pn=1&deptid=${s.value.deptId}`;const e=await E(n,null);e.result?N.value=e.data.records:e.errMsg=="\u672A\u767B\u5F55"&&M.push("/login"),B.value=!1}function ae(n){g(n)}function te(n){s.value.ruleSelection=n}function ne(){s.value=JSON.parse(JSON.stringify(O)),N.value=[]}function oe(n){p.value={id:n.id,realName:n.realName,schedDate:n.schedDate,noon:n.noon,registQuota:n.registQuota},h.value=!0}function re(){k.value&&k.value.resetFields(),p.value={id:"",realName:"",schedDate:"",noon:"",registQuota:0}}async function ue(){!k.value||await k.value.validate(n=>{n&&F("/scheduling/update",p.value).then(e=>{e.data.result?(h.value=!1,g(D.value.current),m.success("\u4FEE\u6539\u6210\u529F")):(e.data.errMsg=="\u672A\u767B\u5F55"&&M.push("/login"),m.error(e.data.errMsg||"\u4FEE\u6539\u5931\u8D25"))})})}function de(n){De.confirm("\u786E\u8BA4\u662F\u5426\u5220\u9664?","\u8B66\u544A",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{var e=new FormData;e.append("id",n),F("/scheduling/del",e).then(o=>{o.data.result?(g(D.value.current),m.success("\u5220\u9664\u6210\u529F")):(o.data.errMsg=="\u672A\u767B\u5F55"&&M.push("/login"),m.error(o.data.errMsg||"\u5220\u9664\u5931\u8D25"))})})}return(n,e)=>{const o=i("el-option"),y=i("el-select"),C=i("el-date-picker"),f=i("el-input"),d=i("el-button"),V=i("el-row"),u=i("el-table-column"),P=i("el-table"),z=i("el-col"),se=i("el-pagination"),_=i("el-form-item"),ie=i("el-input-number"),T=i("el-form"),L=i("el-dialog"),j=_e("loading");return v(),x(U,null,[l(V,{class:"search-bar"},{default:t(()=>[Y("div",be,[l(y,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=a=>S.value=a),filterable:"",clearable:"",onClear:e[1]||(e[1]=a=>g(1)),placeholder:"\u6240\u5C5E\u79D1\u5BA4",onChange:e[2]||(e[2]=a=>g(1))},{default:t(()=>[(v(!0),x(U,null,J(R.value,a=>(v(),$(o,{key:a.id,label:a.deptCode+a.deptName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(C,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=a=>b.value=a),type:"daterange","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4",size:n.size,format:"YYYY/MM/DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue","size"]),l(f,{modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=a=>I.value=a),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D\u6216\u6392\u73ED\u540D"},null,8,["modelValue"]),l(d,{type:"primary",onClick:e[5]||(e[5]=a=>g(1))},{default:t(()=>e[19]||(e[19]=[c("\u67E5\u8BE2")])),_:1,__:[19]})]),l(d,{type:"primary",onClick:e[6]||(e[6]=a=>w.value=!0)},{default:t(()=>e[20]||(e[20]=[c("\u65B0\u589E\u6392\u73ED\u8BA1\u5212")])),_:1,__:[20]})]),_:1}),e[27]||(e[27]=Y("div",{style:{"margin-top":"40px"}},null,-1)),l(V,{class:"m-2"},{default:t(()=>[l(z,{span:24},{default:t(()=>[G((v(),$(P,{data:D.value.records,style:{width:"100%"}},{default:t(()=>[l(u,{fixed:"",prop:"id",label:"\u5E8F\u53F7",width:"80",align:"center"}),l(u,{prop:"schedDate",label:"\u65E5\u671F",align:"center"}),l(u,{prop:"deptName",label:"\u6240\u5C5E\u79D1\u5BA4",align:"center"}),l(u,{prop:"realName",label:"\u59D3\u540D",align:"center"}),l(u,{prop:"noon",label:"\u5348\u522B",align:"center"}),l(u,{prop:"registName",label:"\u6302\u53F7\u7EA7\u522B",align:"center"}),l(u,{prop:"registQuota",label:"\u6302\u53F7\u9650\u989D",align:"center"}),l(u,{fixed:"right",label:"\u64CD\u4F5C",align:"center"},{default:t(a=>[l(d,{link:"",type:"primary",onClick:pe=>oe(a.row)},{default:t(()=>e[21]||(e[21]=[c("\u7F16\u8F91")])),_:2,__:[21]},1032,["onClick"]),l(d,{link:"",type:"danger",onClick:pe=>de(a.row.id)},{default:t(()=>e[22]||(e[22]=[c("\u5220\u9664")])),_:2,__:[22]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,Q.value]])]),_:1})]),_:1}),e[28]||(e[28]=Y("div",{style:{"margin-top":"20px"}},null,-1)),l(V,null,{default:t(()=>[l(z,{span:20},{default:t(()=>[l(se,{background:"",layout:"prev, pager, next",total:D.value.total,"page-count":D.value.pages,onCurrentChange:ae},null,8,["total","page-count"])]),_:1}),l(z,{span:4},{default:t(()=>[l(y,{modelValue:q.value,"onUpdate:modelValue":e[7]||(e[7]=a=>q.value=a),class:"m-2",placeholder:"\u6BCF\u9875\u884C\u6570",onChange:e[8]||(e[8]=a=>g(1))},{default:t(()=>[(v(),x(U,null,J(H,a=>l(o,{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(L,{modelValue:h.value,"onUpdate:modelValue":e[14]||(e[14]=a=>h.value=a),title:"\u7F16\u8F91\u6392\u73ED",onClose:re},{footer:t(()=>[Y("span",ye,[l(d,{onClick:e[13]||(e[13]=a=>h.value=!1)},{default:t(()=>e[23]||(e[23]=[c("\u53D6\u6D88")])),_:1,__:[23]}),l(d,{type:"primary",onClick:ue},{default:t(()=>e[24]||(e[24]=[c(" \u4FDD\u5B58 ")])),_:1,__:[24]})])]),default:t(()=>[l(T,{model:p.value,rules:W.value,ref_key:"editFormRef",ref:k,"label-width":"100px"},{default:t(()=>[l(_,{label:"\u533B\u751F\u59D3\u540D",prop:"realName"},{default:t(()=>[l(f,{modelValue:p.value.realName,"onUpdate:modelValue":e[9]||(e[9]=a=>p.value.realName=a),disabled:""},null,8,["modelValue"])]),_:1}),l(_,{label:"\u6392\u73ED\u65E5\u671F",prop:"schedDate"},{default:t(()=>[l(C,{modelValue:p.value.schedDate,"onUpdate:modelValue":e[10]||(e[10]=a=>p.value.schedDate=a),type:"date",placeholder:"\u9009\u62E9\u4E00\u4E2A\u65E5\u671F",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(_,{label:"\u5348\u522B",prop:"noon"},{default:t(()=>[l(y,{modelValue:p.value.noon,"onUpdate:modelValue":e[11]||(e[11]=a=>p.value.noon=a),placeholder:"\u9009\u62E9\u5348\u522B"},{default:t(()=>[l(o,{label:"\u4E0A\u5348",value:"\u4E0A\u5348"}),l(o,{label:"\u4E0B\u5348",value:"\u4E0B\u5348"})]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"\u6302\u53F7\u9650\u989D",prop:"registQuota"},{default:t(()=>[l(ie,{modelValue:p.value.registQuota,"onUpdate:modelValue":e[12]||(e[12]=a=>p.value.registQuota=a),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(L,{modelValue:w.value,"onUpdate:modelValue":e[18]||(e[18]=a=>w.value=a),title:"\u65B0\u589E\u6392\u73ED\u8BA1\u5212",onClose:ne,width:"60%"},{footer:t(()=>[Y("span",Ve,[l(d,{onClick:e[17]||(e[17]=a=>w.value=!1)},{default:t(()=>e[25]||(e[25]=[c("\u53D6\u6D88")])),_:1,__:[25]}),l(d,{type:"primary",disabled:s.value.ruleSelection.length==0,onClick:Z},{default:t(()=>e[26]||(e[26]=[c(" \u751F\u6210\u6392\u73ED\u8BA1\u5212 ")])),_:1,__:[26]},8,["disabled"])])]),default:t(()=>[l(T,{model:s.value,rules:X.value,"label-width":"100px"},{default:t(()=>[l(_,{label:"\u6240\u5C5E\u79D1\u5BA4",prop:"deptId"},{default:t(()=>[l(y,{modelValue:s.value.deptId,"onUpdate:modelValue":e[15]||(e[15]=a=>s.value.deptId=a),filterable:"",clearable:"",placeholder:"\u6240\u5C5E\u79D1\u5BA4",onChange:le},{default:t(()=>[(v(!0),x(U,null,J(R.value,a=>(v(),$(o,{key:a.id,label:a.deptName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"\u6392\u73ED\u89C4\u5219",prop:"ruleSelection"},{default:t(()=>[G((v(),$(P,{data:N.value,style:{width:"100%"},onSelectionChange:te},{default:t(()=>[l(u,{type:"selection",width:"50",align:"left"}),l(u,{prop:"ruleName",label:"\u89C4\u5219\u540D\u79F0",align:"center"}),l(u,{prop:"deptName",label:"\u6240\u5C5E\u79D1\u5BA4",align:"center"}),l(u,{prop:"realName",label:"\u59D3\u540D",align:"center"}),l(u,{prop:"week",label:"\u89C4\u5219",width:"150",align:"center"})]),_:1},8,["data"])),[[j,B.value]])]),_:1}),l(_,{label:"\u6392\u73ED\u65E5\u671F",prop:"ndate"},{default:t(()=>[l(C,{modelValue:s.value.ndate,"onUpdate:modelValue":e[16]||(e[16]=a=>s.value.ndate=a),type:"daterange","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",size:n.size,format:"YYYY/MM/DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","size"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}};var Ye=ve(we,[["__scopeId","data-v-33aed18e"]]);export{Ye as default};
