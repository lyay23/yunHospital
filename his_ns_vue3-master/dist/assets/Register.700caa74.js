import{f as b,p as te}from"./api.12427e84.js";import{f as ne,a as oe,b as re}from"./utils.1f1ce994.js";import{a as se,r as s,l as ue,s as _,b as g,c as ie,o as p,d as C,h as l,g as t,e as u,F as k,i as x,p as U,w as A,f as y,t as v,n as H,z as Q,E as j,m as G}from"./index.eaac7b27.js";const de={m:"4",style:{"padding-left":"50px"}},pe={m:"t-0 b-2"},ce={m:"t-0 b-2"},ge={m:"t-0 b-2"},ve={m:"t-0 b-2"},fe={m:"t-0 b-2"},we={__name:"Register",setup(me){const J=se(),w=s(!1),R=s(!1),B=s({}),m=s(),L=s({}),h=s(),E=s({}),F=s({}),q=s({}),D=s(""),$=s(""),S=s(""),N=s(""),K=s(10),i=[],d=[];s(!1),s(!1),ue(async()=>{W(),P()});async function O(n){w.value=!0;let e=`/medicalcard/page?count=${K.value}&pn=${n}`;D!=""&&(e+=`&keyword=${D.value}`);const c=await b(e,null);c.result?(B.value=c.data,w.value=!1):c.errMsg=="\u672A\u767B\u5F55"&&_.push("/login")}async function P(){const e=await b("/registlevel/page?count=100&pn=1",null);e.result?E.value=e.data:e.errMsg=="\u672A\u767B\u5F55"&&_.push("/login")}async function W(){const e=await b("/department/page?&count=200&pn=1",null);e.result?F.value=e.data.records:e.errMsg=="\u672A\u767B\u5F55"&&_.push("/login")}async function X(){let n=`/user/page?&dept=${$.value}&userType=172&count=200&pn=1`;const e=await b(n,null);e.result?q.value=e.data.records:e.errMsg=="\u672A\u767B\u5F55"&&_.push("/login")}async function I(n){R.value=!0;var e=new Date,c=ne(e);let o=`/scheduling/page?count=100&pn=${n}&start=${c}&end=${c}`;S!=""&&(o+=`&userId=${S.value}`),N!=""&&(o+=`&regLevel=${N.value}`),e.getHours()>12&&(o+="&noon=\u4E0B\u5348");const f=await b(o,null);f.result?(L.value=f.data,R.value=!1):f.errMsg=="\u672A\u767B\u5F55"&&_.push("/login")}function Y(){if(i.value==null||i.value.length==0){j.alert("\u8BF7\u9009\u62E9\u6302\u53F7\u5C31\u8BCA\u5361","\u63D0\u793A",{});return}if(d.value==null||d.value.length==0){j.alert("\u8BF7\u9009\u62E9\u6302\u53F7\u4FE1\u606F","\u63D0\u793A",{});return}console.log(i.value);var n={register:{medicalCardId:i.value[0].id,RealName:i.value[0].realname,age:oe(i.value[0].birthdate),ageType:"\u5C81",visitDate:d.value[0].schedDate,noon:d.value[0].noon,deptID:d.value[0].deptID,userID:d.value[0].userID,registLeID:d.value[0].registlevelId,settleID:i.value[0].cardtype,isBook:0,registerID:J.getUserInfo.value.id,timeInterval:re(),channel:186},scheduling:d.value[0]};te("/register/add",n).then(e=>{w.value=!1,e.data.result?(G.success("\u6302\u53F7\u6210\u529F"),m.value.clearSelection(),h.value.clearSelection(),I(1)):G.error(e.data.errMsg)})}function Z(n){i.value=[],i.value=n,console.log(m.value)}function ee(n,e){m.value.clearSelection(),n.length!=0&&m.value.toggleRowSelection(e,!0)}function le(n){d.value=n}function ae(n,e){h.value.clearSelection(),n.length!=0&&h.value.toggleRowSelection(e,!0)}return(n,e)=>{const c=g("el-input"),o=g("el-col"),f=g("el-button"),M=g("el-option"),T=g("el-select"),V=g("el-row"),r=g("el-table-column"),z=ie("loading");return p(),C(k,null,[l(V,null,{default:t(()=>[l(o,{span:6,style:{"padding-right":"20px"}},{default:t(()=>[l(c,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=a=>D.value=a),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D\u6216\u8EAB\u4EFD\u8BC1\u53F7\u7801",class:"w-100 m-2"},null,8,["modelValue"])]),_:1}),l(o,{span:2,class:"m-2"},{default:t(()=>[l(f,{type:"primary",onClick:e[1]||(e[1]=a=>O(1))},{default:t(()=>e[8]||(e[8]=[x("\u67E5\u8BE2")])),_:1,__:[8]})]),_:1}),l(o,{span:4}),l(o,{span:6,style:{"padding-right":"20px"}},{default:t(()=>[l(T,{modelValue:$.value,"onUpdate:modelValue":e[2]||(e[2]=a=>$.value=a),class:"m-2",filterable:"",clearable:"",placeholder:"\u79D1\u5BA4",onChange:e[3]||(e[3]=a=>X(1))},{default:t(()=>[(p(!0),C(k,null,U(F.value,a=>(p(),y(M,{key:a.id,label:a.deptCode+a.deptName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(o,{span:6},{default:t(()=>[l(T,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=a=>S.value=a),class:"m-2",filterable:"",clearable:"",placeholder:"\u533B\u751F",onChange:e[5]||(e[5]=a=>I(1))},{default:t(()=>[(p(!0),C(k,null,U(q.value,a=>(p(),y(M,{key:a.id,label:a.realName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e[10]||(e[10]=u("div",{style:{"margin-top":"10px"}},null,-1)),l(V,null,{default:t(()=>[l(o,{span:4}),l(o,{span:4}),l(o,{span:4}),l(o,{span:6},{default:t(()=>[l(T,{modelValue:N.value,"onUpdate:modelValue":e[6]||(e[6]=a=>N.value=a),class:"m-2",filterable:"",clearable:"",placeholder:"\u6302\u53F7\u7EA7\u522B",onChange:e[7]||(e[7]=a=>I(1))},{default:t(()=>[(p(!0),C(k,null,U(E.value.records,a=>(p(),y(M,{key:a.id,label:a.registCode+a.registName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(o,{span:4}),l(o,{span:2},{default:t(()=>[l(f,{type:"danger",onClick:Y},{default:t(()=>e[9]||(e[9]=[x("\u73B0\u573A\u6302\u53F7")])),_:1,__:[9]})]),_:1})]),_:1}),e[11]||(e[11]=u("div",{style:{"margin-top":"40px"}},null,-1)),l(V,{class:"m-2"},{default:t(()=>[l(o,{span:24},{default:t(()=>[A((p(),y(H(Q),{ref_key:"multipleTableRef",ref:m,data:B.value.records,style:{width:"100%"},onSelect:ee,onSelectionChange:Z},{default:t(()=>[l(r,{type:"selection",width:"30",align:"left"}),l(r,{type:"expand"},{default:t(a=>[u("div",de,[u("p",pe,"\u5173\u8054\u7528\u6237: "+v(a.row.customerName),1),u("p",ce,"\u5173\xA0\xA0\xA0\xA0\xA0\xA0\u7CFB: "+v(a.row.relationshipName),1),u("p",ge,"\u5BB6\u5EAD\u5730\u5740: "+v(a.row.addr),1),u("p",ve,"\u6CE8\u518C\u65F6\u95F4: "+v(a.row.createdate),1),u("p",fe,"\u6CE8\u518C\u6E20\u9053: "+v(a.row.channelName),1)])]),_:1}),l(r,{prop:"id",label:"\u5E8F\u53F7",width:"55",align:"center"}),l(r,{prop:"realname",label:"\u59D3\u540D",width:"65",align:"center"}),l(r,{prop:"gender",label:"\u6027\u522B",width:"55",align:"center"},{default:t(a=>[x(v(a.row.gender==71?"\u7537":"\u5973"),1)]),_:1}),l(r,{prop:"idnumber",label:"\u8EAB\u4EFD\u8BC1",align:"center"}),l(r,{prop:"birthdate",label:"\u51FA\u751F\u65E5\u671F",align:"center"}),l(r,{prop:"phone",label:"\u624B\u673A\u53F7",align:"center"}),l(r,{prop:"cardtypeName",label:"\u5361\u7C7B\u578B",align:"center"})]),_:1},8,["data"])),[[z,w.value]])]),_:1})]),_:1}),e[12]||(e[12]=u("div",{style:{"margin-top":"40px"}},null,-1)),l(V,{class:"m-2"},{default:t(()=>[l(o,{span:24},{default:t(()=>[A((p(),y(H(Q),{ref_key:"multipleTableRef2",ref:h,data:L.value.records,style:{width:"100%"},onSelect:ae,onSelectionChange:le},{default:t(()=>[l(r,{type:"selection",width:"55",align:"left"}),l(r,{prop:"realName",label:"\u59D3\u540D",align:"center"}),l(r,{prop:"schedDate",label:"\u65E5\u671F",align:"center"}),l(r,{prop:"noon",label:"\u5348\u522B",align:"center"}),l(r,{prop:"registName",label:"\u53F7\u522B",align:"center"}),l(r,{prop:"registFee",label:"\u6302\u53F7\u8D39",align:"center"}),l(r,{prop:"regNum",label:"\u4F59\u53F7",align:"center"},{default:t(a=>[x(v(a.row.registQuota-a.row.regNum),1)]),_:1})]),_:1},8,["data"])),[[z,R.value]])]),_:1})]),_:1}),e[13]||(e[13]=u("div",{style:{"margin-top":"20px"}},null,-1))],64)}}};export{we as default};
