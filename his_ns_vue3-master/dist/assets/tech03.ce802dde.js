import{g as F,p as z}from"./api.12427e84.js";import{_ as re,r,k as E,l as ie,m as f,b as u,o as pe,f as me,g as a,h as l,e as c,i as _,n as x,U as ce,O as _e,a3 as fe,a4 as ve,a5 as be,t as ge}from"./index.eaac7b27.js";import{c as ye}from"./utils.1f1ce994.js";const Ne=["src"],we={class:"dialog-footer"},Ve={__name:"tech03",setup(xe){const M=r(""),I=r([]),v=r({}),d=r({}),g=r([]),i=r([]),N=r(!1),$=r(null),k=r(""),D=r([]),w=r([]),j=r("/api/upload"),H=r({token:sessionStorage.getItem("token")||""}),R=r(""),U=r(!1),G=E(()=>i.value.length>0&&i.value.every(t=>t.state===2||t.state===3)),J=E(()=>i.value.length>0&&i.value.every(t=>t.state===4)),K=E(()=>i.value.length>0&&i.value.every(t=>t.state===4));ie(()=>{q()});const q=async()=>{const t=new Date().toISOString().split("T")[0],e=await F(`/register/page?count=100&visitState=2&regDate=${t}`);e.status===200&&e.data.result?I.value=e.data.data.records:(I.value=[],f.error("\u67E5\u8BE2\u4ECA\u65E5\u60A3\u8005\u5931\u8D25"))},S=async t=>{if(!t){v.value=null,d.value={},g.value=[];return}v.value=t,d.value={caseNumber:t.caseNumber,patientName:t.realName,age:t.age,deptName:t.deptName,doctorName:t.doctorName};const e=await F("/checkapply/page",{registId:t.id,recordType:180,count:200});if(e.status===200&&e.data.result){const o=e.data.data.records;if(g.value=o.map(s=>({...s,quantity:Number(s.quantity)||1,totalAmount:(Number(s.price)||0)*(Number(s.quantity)||1)})),o.length>0){const s=o[0];d.value={...s,caseNumber:t.caseNumber,patientName:t.realName,age:t.age,creationTime:s.creationTime?ye(s.creationTime):"",settleCategoryName:s.settleCategoryName,deptName:s.deptName,doctorName:s.doctorName,invoiceNo:s.invoiceNo}}else g.value=[]}else g.value=[]},L=t=>{i.value=t},P=async(t,e)=>{const o=await z("/checkapply/updateState",{ids:t,state:e});return o.data.result?(t.forEach(s=>{const C=g.value.find(h=>h.id===s);C&&(C.state=e)}),i.value=[],!0):(f.error(o.data.errMsg||"\u64CD\u4F5C\u5931\u8D25"),!1)},Q=async()=>{var o;const t=i.value.map(s=>s.id),e=await z("/checkapply/updateState",{ids:t,state:4});e.data.result?(f.success("\u6267\u884C\u786E\u8BA4\u6210\u529F"),(o=v.value)!=null&&o.id&&await S(v.value)):f.error(e.data.errMsg||"\u6267\u884C\u786E\u8BA4\u5931\u8D25")},W=async()=>{const t=i.value.map(o=>o.id);await P(t,0)&&(f.success("\u53D6\u6D88\u6267\u884C\u6210\u529F"),v.value&&await S(v.value))},X=()=>{k.value="",D.value=[],w.value=[],N.value=!0},Y=async()=>{const t=i.value.map(s=>s.id),e={checkApplyIds:t,registId:v.value.id,resultDesc:k.value,resultImages:w.value.join(",")},o=await z("/checkapply/save-result",e);o.data.result?(f.success("\u63D0\u4EA4\u7ED3\u679C\u6210\u529F"),N.value=!1,await P(t,5)):f.error(o.data.errMsg||"\u63D0\u4EA4\u5931\u8D25")},Z=t=>{const e=t.response?t.response.data:t.url,o=w.value.indexOf(e);o>-1&&w.value.splice(o,1)},ee=t=>{R.value=t.url,U.value=!0},le=(t,e,o)=>{t.result?w.value.push(t.data):(f.error(t.errMsg||"\u56FE\u7247\u4E0A\u4F20\u5931\u8D25"),o.splice(o.findIndex(s=>s.uid===e.uid),1))},A=t=>({0:"\u5DF2\u4F5C\u5E9F",1:"\u6682\u5B58",2:"\u5DF2\u5F00\u7ACB",3:"\u5DF2\u4EA4\u8D39",4:"\u5DF2\u767B\u8BB0",5:"\u6267\u884C\u5B8C",6:"\u5DF2\u9000\u8D39"})[t]||"\u672A\u77E5";return(t,e)=>{const o=u("el-input"),s=u("el-icon"),C=u("el-upload"),h=u("el-dialog"),y=u("el-button"),ae=u("el-header"),B=u("el-tag"),m=u("el-table-column"),O=u("el-table"),te=u("el-tab-pane"),oe=u("el-tabs"),se=u("el-main"),T=u("el-container"),ne=u("el-aside"),p=u("el-col"),V=u("el-row"),b=u("el-form-item"),ue=u("el-form"),de=u("el-divider");return pe(),me(T,{style:{height:"100%",border:"1px solid #eee"}},{default:a(()=>[l(h,{title:"\u586B\u5199\u5904\u7F6E\u7ED3\u679C",modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=n=>N.value=n),width:"50%"},{footer:a(()=>[c("span",we,[l(y,{onClick:e[2]||(e[2]=n=>N.value=!1),size:"small"},{default:a(()=>e[11]||(e[11]=[_("\u53D6\u6D88")])),_:1,__:[11]}),l(y,{style:{"margin-left":"10px"},size:"small",type:"success",onClick:Y},{default:a(()=>e[12]||(e[12]=[_("\u63D0\u4EA4")])),_:1,__:[12]})])]),default:a(()=>[e[13]||(e[13]=c("span",null,"\u7ED3\u679C\u63CF\u8FF0\uFF1A",-1)),l(o,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=n=>k.value=n),placeholder:"\u8BF7\u8F93\u5165\u7ED3\u679C\u63CF\u8FF0",type:"textarea",rows:"3"},null,8,["modelValue"]),e[14]||(e[14]=c("br",null,null,-1)),e[15]||(e[15]=c("br",null,null,-1)),e[16]||(e[16]=c("span",null,"\u7ED3\u679C\u56FE\u7247\uFF1A",-1)),l(C,{ref_key:"upload",ref:$,action:j.value,"list-type":"picture-card","on-preview":ee,"on-remove":Z,"on-success":le,"file-list":D.value,multiple:!0,headers:H.value},{default:a(()=>[l(s,null,{default:a(()=>[l(x(ce))]),_:1})]),_:1},8,["action","file-list","headers"]),l(h,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=n=>U.value=n)},{default:a(()=>[c("img",{"w-full":"",src:R.value,alt:"Preview Image",style:{width:"100%"}},null,8,Ne)]),_:1},8,["modelValue"])]),_:1,__:[13,14,15,16]},8,["modelValue"]),l(ne,{width:"350px",class:"aside-card"},{default:a(()=>[l(T,null,{default:a(()=>[l(ae,{class:"search-header"},{default:a(()=>[l(o,{placeholder:"\u8BF7\u8F93\u5165\u75C5\u5386\u53F7/\u59D3\u540D",modelValue:M.value,"onUpdate:modelValue":e[4]||(e[4]=n=>M.value=n),class:"input-with-select search-input",style:{width:"100%"}},{prepend:a(()=>e[17]||(e[17]=[_("\u60A3\u8005\u67E5\u8BE2\uFF1A")])),append:a(()=>[l(y,{icon:x(_e),onClick:q},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),l(se,{class:"patient-list-main",style:{height:"700px",border:"1px solid #eee",padding:"0",margin:"0"}},{default:a(()=>[l(oe,{type:"border-card"},{default:a(()=>[l(te,{label:"\u533B\u6280\u5904\u7F6E"},{default:a(()=>[l(B,null,{default:a(()=>e[18]||(e[18]=[_("\u60A3\u8005\uFF1A")])),_:1,__:[18]}),l(O,{ref:"singleTable",data:I.value,"highlight-current-row":"",onCurrentChange:S,style:{width:"100%"},"show-header":!1,size:"mini",class:"patient-table"},{default:a(()=>[l(m,{property:"caseNumber",label:"\u75C5\u5386\u53F7"}),l(m,{property:"realName",label:"\u59D3\u540D",width:"80"}),l(m,{property:"id",label:"id",width:"100"})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(T,{direction:"vertical",class:"main-card",style:{height:"100%"}},{default:a(()=>[l(V,{style:{"background-color":"#EAF1F5"}},{default:a(()=>[l(p,{span:9,style:{"margin-top":"4px"}},{default:a(()=>[l(B,{size:"mini"},{default:a(()=>e[19]||(e[19]=[_("\u5904\u7F6E\u660E\u7EC6\u4FE1\u606F\uFF1A")])),_:1,__:[19]})]),_:1}),l(p,{span:5},{default:a(()=>[l(y,{type:"text",size:"small",icon:x(fe),onClick:Q,disabled:!G.value},{default:a(()=>e[20]||(e[20]=[_("\u6267\u884C\u786E\u8BA4")])),_:1,__:[20]},8,["icon","disabled"])]),_:1}),l(p,{span:5},{default:a(()=>[l(y,{type:"text",size:"small",icon:x(ve),onClick:W,disabled:!J.value},{default:a(()=>e[21]||(e[21]=[_("\u53D6\u6D88\u6267\u884C")])),_:1,__:[21]},8,["icon","disabled"])]),_:1}),l(p,{span:5},{default:a(()=>[l(y,{type:"text",size:"small",icon:x(be),onClick:X,disabled:!K.value},{default:a(()=>e[22]||(e[22]=[_("\u586B\u5199\u7ED3\u679C")])),_:1,__:[22]},8,["icon","disabled"])]),_:1})]),_:1}),l(ue,{ref:"form",model:d.value,"label-width":"80px",size:"mini",inline:!0,class:"detail-form"},{default:a(()=>[l(V,null,{default:a(()=>e[23]||(e[23]=[c("div",{style:{"font-size":"large","text-align":"center"}},"\u5904\u7F6E\u660E\u7EC6\u5355",-1),c("hr",null,null,-1)])),_:1,__:[23]}),l(V,null,{default:a(()=>[l(p,{span:8},{default:a(()=>[l(b,{label:"\u75C5\u5386\u53F7:"},{default:a(()=>[l(o,{modelValue:d.value.caseNumber,"onUpdate:modelValue":e[5]||(e[5]=n=>d.value.caseNumber=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(p,{span:8},{default:a(()=>[l(b,{label:"\u60A3\u8005\u59D3\u540D:"},{default:a(()=>[l(o,{modelValue:d.value.patientName,"onUpdate:modelValue":e[6]||(e[6]=n=>d.value.patientName=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(p,{span:8},{default:a(()=>[l(b,{label:"\u5E74\u9F84:"},{default:a(()=>[l(o,{modelValue:d.value.age,"onUpdate:modelValue":e[7]||(e[7]=n=>d.value.age=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(V,null,{default:a(()=>[l(p,{span:8},{default:a(()=>[l(b,{label:"\u5C31\u8BCA\u79D1\u5BA4:"},{default:a(()=>[l(o,{modelValue:d.value.deptName,"onUpdate:modelValue":e[8]||(e[8]=n=>d.value.deptName=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(p,{span:8},{default:a(()=>[l(b,{label:"\u5904\u65B9\u72B6\u6001:"},{default:a(()=>[l(o,{value:A(d.value.state),readonly:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),l(V,null,{default:a(()=>[l(p,{span:8},{default:a(()=>[l(b,{label:"\u6536\u8D39\u65E5\u671F:"},{default:a(()=>[l(o,{modelValue:d.value.creationTime,"onUpdate:modelValue":e[9]||(e[9]=n=>d.value.creationTime=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(p,{span:8},{default:a(()=>[l(b,{label:"\u5F00\u5355\u533B\u751F:"},{default:a(()=>[l(o,{modelValue:d.value.doctorName,"onUpdate:modelValue":e[10]||(e[10]=n=>d.value.doctorName=n),readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),l(de,{"content-position":"left"},{default:a(()=>e[24]||(e[24]=[_("\u5904\u7F6E\u4FE1\u606F:")])),_:1,__:[24]}),l(O,{data:g.value,stripe:"",style:{width:"100%"},onSelectionChange:L,class:"detail-table"},{default:a(()=>[l(m,{type:"selection",width:"55"}),l(m,{prop:"itemName",label:"\u5904\u7F6E\u540D\u79F0"}),l(m,{prop:"position",label:"\u5904\u7F6E\u90E8\u4F4D"}),l(m,{prop:"quantity",label:"\u6570\u91CF"}),l(m,{prop:"price",label:"\u5355\u4EF7"}),l(m,{prop:"totalAmount",label:"\u603B\u91D1\u989D"}),l(m,{prop:"state",label:"\u72B6\u6001"},{default:a(n=>[c("span",null,ge(A(n.row.state)),1)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})}}};var Ie=re(Ve,[["__scopeId","data-v-46c42e91"]]);export{Ie as default};
