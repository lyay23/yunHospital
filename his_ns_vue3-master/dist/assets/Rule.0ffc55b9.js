import{f as J,p as K}from"./api.12427e84.js";import{_ as re,r as i,v as de,l as se,s as w,b as p,c as ie,o as d,d as f,h as a,g as t,e as M,F as v,p as b,i as r,w as pe,f as I,m as $,E as me}from"./index.eaac7b27.js";const fe={class:"search-controls"},ve={class:"dialog-footer"},ge={class:"dialog-footer"},_e={__name:"Rule",setup(be){const A=i(!1),V=i({}),R=i([]),C=i([]),F=i(""),B=i(""),P=i(10),Z=[10,20,30,50],j=i(1),N=i(!1),U=i(!1),E=i(null),q=i(null),u=i({id:"",ruleName:"",userID:"",num:null,deptID:"",week:"00000000000000"}),y=i([]);de(()=>u.value.week,o=>{const e=[];if(o&&o.length===14)for(let n=0;n<7;n++)o[n*2]==="1"&&e.push(`am-${n+1}`),o[n*2+1]==="1"&&e.push(`pm-${n+1}`);y.value=e});const S=o=>{const e=Array(14).fill("0");o.forEach(n=>{const[g,k]=n.split("-"),_=(parseInt(k)-1)*2+(g==="pm"?1:0);e[_]="1"}),u.value.week=e.join("")},O=i({ruleName:[{required:!0,message:"\u8BF7\u8F93\u5165\u89C4\u5219\u540D\u79F0",trigger:"blur"}],userID:[{required:!0,message:"\u8BF7\u9009\u62E9\u533B\u751F",trigger:"change"}],num:[{required:!0,message:"\u8BF7\u8F93\u5165\u53EF\u9884\u7EA6\u4EBA\u6570",trigger:"blur"},{type:"number",message:"\u53EF\u9884\u7EA6\u4EBA\u6570\u5FC5\u987B\u4E3A\u6570\u5B57"}],deptID:[{required:!0,message:"\u8BF7\u9009\u62E9\u79D1\u5BA4",trigger:"change"}]});se(async()=>{x(1),W()});async function W(){const e=await J("/department/page?count=1000&pn=1",null);e.result?R.value=e.data.records:e.errMsg=="\u672A\u767B\u5F55"&&w.push("/login")}async function L(o){if(!o){C.value=[],u.value&&(u.value.userID="");return}let e=`/user/page?count=1000&pn=1&utype=172&deptid=${o}`;const n=await J(e,null);n.result?(C.value=n.data.records,u.value&&u.value.userID&&!C.value.find(g=>g.id===u.value.userID)&&(u.value.userID="")):n.errMsg=="\u672A\u767B\u5F55"&&w.push("/login")}async function x(o){A.value=!0;let e=`/rule/page?count=${P.value}&pn=${o}`;F.value!==""&&(e+=`&keyword=${F.value}`),B.value!==""&&(e+=`&deptId=${B.value}`);const n=await J(e,null);n.result?(V.value=n.data,A.value=!1):n.errMsg=="\u672A\u767B\u5F55"&&w.push("/login")}function c(o){x(o)}function h(o){u.value={...o},L(o.deptID),U.value=!0}function Q(o){const e=o==="edit"?q.value:E.value;e&&e.resetFields(),u.value={id:"",ruleName:"",userID:"",num:null,deptID:"",week:"00000000000000"},C.value=[]}async function ee(){!q.value||await q.value.validate(o=>{o&&K("/rule/update",u.value).then(e=>{e.data.result?(U.value=!1,x(V.value.current),$.success("\u4FEE\u6539\u6210\u529F")):(e.data.errMsg=="\u672A\u767B\u5F55"&&w.push("/login"),$.error(e.data.errMsg||"\u4FEE\u6539\u5931\u8D25"))})})}async function le(){!E.value||await E.value.validate(o=>{o&&K("/rule/add",u.value).then(e=>{e.data.result?(N.value=!1,j.value=1,x(1),$.success("\u65B0\u589E\u6210\u529F")):(e.data.errMsg=="\u672A\u767B\u5F55"&&w.push("/login"),$.error(e.data.errMsg||"\u65B0\u589E\u5931\u8D25"))})})}function ae(o){me.confirm("\u786E\u8BA4\u662F\u5426\u5220\u9664?","\u8B66\u544A",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{var e=new FormData;e.append("id",o),K("/rule/del",e).then(n=>{n.data.result?(x(V.value.current),$.success("\u5220\u9664\u6210\u529F")):(n.data.errMsg=="\u672A\u767B\u5F55"&&w.push("/login"),$.error(n.data.errMsg||"\u5220\u9664\u5931\u8D25"))})})}return(o,e)=>{const n=p("el-option"),g=p("el-select"),k=p("el-input"),_=p("el-button"),G=p("el-row"),D=p("el-table-column"),te=p("el-table"),H=p("el-col"),ue=p("el-pagination"),m=p("el-form-item"),s=p("el-text"),T=p("el-checkbox"),z=p("el-checkbox-group"),X=p("el-form"),Y=p("el-dialog"),ne=ie("loading");return d(),f(v,null,[a(G,{class:"search-bar"},{default:t(()=>[M("div",fe,[a(g,{modelValue:B.value,"onUpdate:modelValue":e[0]||(e[0]=l=>B.value=l),filterable:"",clearable:"",onClear:e[1]||(e[1]=l=>x(1)),placeholder:"\u6240\u5C5E\u79D1\u5BA4",onChange:e[2]||(e[2]=l=>x(1))},{default:t(()=>[(d(!0),f(v,null,b(R.value,l=>(d(),I(n,{key:l.id,label:l.deptCode+l.deptName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(k,{modelValue:F.value,"onUpdate:modelValue":e[3]||(e[3]=l=>F.value=l),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D\u6216\u6392\u73ED\u540D"},null,8,["modelValue"]),a(_,{type:"primary",onClick:e[4]||(e[4]=l=>x(1))},{default:t(()=>e[29]||(e[29]=[r("\u67E5\u8BE2")])),_:1,__:[29]})]),a(_,{type:"primary",onClick:e[5]||(e[5]=l=>N.value=!0)},{default:t(()=>e[30]||(e[30]=[r("\u65B0\u589E\u6392\u73ED\u89C4\u5219")])),_:1,__:[30]})]),_:1}),e[51]||(e[51]=M("div",{style:{"margin-top":"40px"}},null,-1)),a(G,{class:"m-2"},{default:t(()=>[a(H,{span:24},{default:t(()=>[pe((d(),I(te,{data:V.value.records,style:{width:"100%"}},{default:t(()=>[a(D,{fixed:"",type:"index",label:"\u5E8F\u53F7",align:"center",width:"80",index:l=>(V.value.current-1)*V.value.size+l+1},null,8,["index"]),a(D,{prop:"ruleName",label:"\u89C4\u5219\u540D\u79F0",align:"center"}),a(D,{prop:"deptName",label:"\u6240\u5C5E\u79D1\u5BA4",align:"center"}),a(D,{prop:"realName",label:"\u59D3\u540D",align:"center"}),a(D,{prop:"week",label:"\u89C4\u5219",align:"center"}),a(D,{prop:"num",label:"\u53EF\u9884\u7EA6\u4EBA\u6570",align:"center"}),a(D,{fixed:"right",label:"\u64CD\u4F5C",align:"center"},{default:t(l=>[a(_,{link:"",type:"primary",onClick:oe=>h(l.row)},{default:t(()=>e[31]||(e[31]=[r("\u7F16\u8F91")])),_:2,__:[31]},1032,["onClick"]),a(_,{link:"",type:"danger",onClick:oe=>ae(l.row.id)},{default:t(()=>e[32]||(e[32]=[r("\u5220\u9664")])),_:2,__:[32]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,A.value]])]),_:1})]),_:1}),e[52]||(e[52]=M("div",{style:{"margin-top":"20px"}},null,-1)),a(G,null,{default:t(()=>[a(H,{span:20},{default:t(()=>[a(ue,{background:"",layout:"prev, pager, next",total:V.value.total,"page-count":V.value.pages,"current-page":j.value,"onUpdate:currentPage":e[6]||(e[6]=l=>j.value=l),onCurrentChange:c},null,8,["total","page-count","current-page"])]),_:1}),a(H,{span:4},{default:t(()=>[a(g,{modelValue:P.value,"onUpdate:modelValue":e[7]||(e[7]=l=>P.value=l),class:"w-20 m-2",placeholder:"\u6BCF\u9875\u884C\u6570",onChange:e[8]||(e[8]=l=>x(1))},{default:t(()=>[(d(),f(v,null,b(Z,l=>a(n,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(Y,{modelValue:U.value,"onUpdate:modelValue":e[17]||(e[17]=l=>U.value=l),title:"\u7F16\u8F91",onClose:e[18]||(e[18]=l=>Q("edit"))},{footer:t(()=>[M("span",ve,[a(_,{onClick:e[16]||(e[16]=l=>U.value=!1)},{default:t(()=>e[40]||(e[40]=[r("\u53D6\u6D88")])),_:1,__:[40]}),a(_,{type:"primary",onClick:ee},{default:t(()=>e[41]||(e[41]=[r(" \u4FDD\u5B58 ")])),_:1,__:[41]})])]),default:t(()=>[a(X,{model:u.value,rules:O.value,ref_key:"editFormRef",ref:q,"label-width":"100px"},{default:t(()=>[a(m,{label:"\u6240\u5C5E\u79D1\u5BA4",prop:"deptID"},{default:t(()=>[a(g,{modelValue:u.value.deptID,"onUpdate:modelValue":e[9]||(e[9]=l=>u.value.deptID=l),filterable:"",placeholder:"\u6240\u5C5E\u79D1\u5BA4",onChange:e[10]||(e[10]=l=>L(u.value.deptID))},{default:t(()=>[(d(!0),f(v,null,b(R.value,l=>(d(),I(n,{key:l.id,label:l.deptName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"\u533B\u751F",prop:"userID"},{default:t(()=>[a(g,{modelValue:u.value.userID,"onUpdate:modelValue":e[11]||(e[11]=l=>u.value.userID=l),filterable:"",placeholder:"\u533B\u751F"},{default:t(()=>[(d(!0),f(v,null,b(C.value,l=>(d(),I(n,{key:l.id,label:l.realName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"\u89C4\u5219\u540D\u79F0",prop:"ruleName"},{default:t(()=>[a(k,{modelValue:u.value.ruleName,"onUpdate:modelValue":e[12]||(e[12]=l=>u.value.ruleName=l),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(m,{label:"\u53EF\u9884\u7EA6\u4EBA\u6570",prop:"num"},{default:t(()=>[a(k,{modelValue:u.value.num,"onUpdate:modelValue":e[13]||(e[13]=l=>u.value.num=l),modelModifiers:{number:!0},autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(m,{label:"\u6392\u73ED\u89C4\u5219"},{default:t(()=>[a(s,{class:"mx-1",style:{"margin-right":"80px"}}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[33]||(e[33]=[r("\u661F\u671F\u4E00")])),_:1,__:[33]}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[34]||(e[34]=[r("\u661F\u671F\u4E8C")])),_:1,__:[34]}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[35]||(e[35]=[r("\u661F\u671F\u4E09")])),_:1,__:[35]}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[36]||(e[36]=[r("\u661F\u671F\u56DB")])),_:1,__:[36]}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[37]||(e[37]=[r("\u661F\u671F\u4E94")])),_:1,__:[37]}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[38]||(e[38]=[r("\u661F\u671F\u516D")])),_:1,__:[38]}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[39]||(e[39]=[r("\u661F\u671F\u5929")])),_:1,__:[39]})]),_:1}),a(m,{label:"\u4E0A\u5348"},{default:t(()=>[a(z,{modelValue:y.value,"onUpdate:modelValue":e[14]||(e[14]=l=>y.value=l),onChange:S},{default:t(()=>[(d(),f(v,null,b(7,l=>a(T,{key:"am-"+l,label:`am-${l}`},null,8,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"\u4E0B\u5348"},{default:t(()=>[a(z,{modelValue:y.value,"onUpdate:modelValue":e[15]||(e[15]=l=>y.value=l),onChange:S},{default:t(()=>[(d(),f(v,null,b(7,l=>a(T,{key:"pm-"+l,label:`pm-${l}`},null,8,["label"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),a(Y,{modelValue:N.value,"onUpdate:modelValue":e[27]||(e[27]=l=>N.value=l),title:"\u65B0\u589E",onClose:e[28]||(e[28]=l=>Q("add"))},{footer:t(()=>[M("span",ge,[a(_,{onClick:e[26]||(e[26]=l=>N.value=!1)},{default:t(()=>e[49]||(e[49]=[r("\u53D6\u6D88")])),_:1,__:[49]}),a(_,{type:"primary",onClick:le},{default:t(()=>e[50]||(e[50]=[r(" \u65B0\u589E ")])),_:1,__:[50]})])]),default:t(()=>[a(X,{model:u.value,rules:O.value,ref_key:"addFormRef",ref:E,"label-width":"100px"},{default:t(()=>[a(m,{label:"\u6240\u5C5E\u79D1\u5BA4",prop:"deptID"},{default:t(()=>[a(g,{modelValue:u.value.deptID,"onUpdate:modelValue":e[19]||(e[19]=l=>u.value.deptID=l),filterable:"",placeholder:"\u6240\u5C5E\u79D1\u5BA4",onChange:e[20]||(e[20]=l=>L(u.value.deptID))},{default:t(()=>[(d(!0),f(v,null,b(R.value,l=>(d(),I(n,{key:l.id,label:l.deptName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"\u533B\u751F",prop:"userID"},{default:t(()=>[a(g,{modelValue:u.value.userID,"onUpdate:modelValue":e[21]||(e[21]=l=>u.value.userID=l),filterable:"",placeholder:"\u533B\u751F"},{default:t(()=>[(d(!0),f(v,null,b(C.value,l=>(d(),I(n,{key:l.id,label:l.realName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"\u89C4\u5219\u540D\u79F0",prop:"ruleName"},{default:t(()=>[a(k,{modelValue:u.value.ruleName,"onUpdate:modelValue":e[22]||(e[22]=l=>u.value.ruleName=l),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(m,{label:"\u53EF\u9884\u7EA6\u4EBA\u6570",prop:"num"},{default:t(()=>[a(k,{modelValue:u.value.num,"onUpdate:modelValue":e[23]||(e[23]=l=>u.value.num=l),modelModifiers:{number:!0},autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(m,{label:"\u6392\u73ED\u89C4\u5219"},{default:t(()=>[a(s,{class:"mx-1",style:{"margin-right":"80px"}}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[42]||(e[42]=[r("\u661F\u671F\u4E00")])),_:1,__:[42]}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[43]||(e[43]=[r("\u661F\u671F\u4E8C")])),_:1,__:[43]}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[44]||(e[44]=[r("\u661F\u671F\u4E09")])),_:1,__:[44]}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[45]||(e[45]=[r("\u661F\u671F\u56DB")])),_:1,__:[45]}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[46]||(e[46]=[r("\u661F\u671F\u4E94")])),_:1,__:[46]}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[47]||(e[47]=[r("\u661F\u671F\u516D")])),_:1,__:[47]}),a(s,{class:"mx-1",style:{"margin-right":"20px"}},{default:t(()=>e[48]||(e[48]=[r("\u661F\u671F\u5929")])),_:1,__:[48]})]),_:1}),a(m,{label:"\u4E0A\u5348"},{default:t(()=>[a(z,{modelValue:y.value,"onUpdate:modelValue":e[24]||(e[24]=l=>y.value=l),onChange:S},{default:t(()=>[(d(),f(v,null,b(7,l=>a(T,{key:"am-"+l,label:`am-${l}`},null,8,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"\u4E0B\u5348"},{default:t(()=>[a(z,{modelValue:y.value,"onUpdate:modelValue":e[25]||(e[25]=l=>y.value=l),onChange:S},{default:t(()=>[(d(),f(v,null,b(7,l=>a(T,{key:"pm-"+l,label:`pm-${l}`},null,8,["label"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}};var Ve=re(_e,[["__scopeId","data-v-d901cc90"]]);export{Ve as default};
