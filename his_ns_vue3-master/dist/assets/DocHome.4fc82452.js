import{A as $t,r as m,k as Ge,l as Dt,v as Xe,B as It,b as d,o as R,f as ue,g as t,h as e,e as x,n as L,C as Nt,i as g,D as Ut,G as nt,H as mt,I as bt,J as Rt,L as At,M as Vt,N as xt,O as tt,P as Et,Q as zt,y as ke,d as ve,T as Tt,R as Ft,t as he,S as Mt,m as i,E as qe,a as st,_ as dt,F as ot,p as rt,U as gt,V as yt,W as _t,X as St,j as lt,z as wt,Y as Ot,Z as ht,s as Ct,c as Bt,w as vt,$ as jt,a0 as Ht,a1 as Lt,a2 as Pt}from"./index.eaac7b27.js";import{a as et,p as pe,f as Ke,g as Ve,d as qt,b as Wt}from"./api.12427e84.js";import{f as kt}from"./utils.1f1ce994.js";var ft={exports:{}};/** @license
 * eventsource.js
 * Available under MIT License (MIT)
 * https://github.com/Yaffle/EventSource/
 */(function(_,ne){(function(S){var U=S.setTimeout,H=S.clearTimeout,z=S.XMLHttpRequest,T=S.XDomainRequest,J=S.ActiveXObject,X=S.EventSource,P=S.document,F=S.Promise,C=S.fetch,E=S.Response,M=S.TextDecoder,te=S.TextEncoder,q=S.AbortController;if(typeof window!="undefined"&&typeof P!="undefined"&&!("readyState"in P)&&P.body==null&&(P.readyState="loading",window.addEventListener("load",function(c){P.readyState="complete"},!1)),z==null&&J!=null&&(z=function(){return new J("Microsoft.XMLHTTP")}),Object.create==null&&(Object.create=function(c){function D(){}return D.prototype=c,new D}),Date.now||(Date.now=function(){return new Date().getTime()}),q==null){var Y=C;C=function(c,D){var u=D.signal;return Y(c,{headers:D.headers,credentials:D.credentials,cache:D.cache}).then(function(l){var o=l.body.getReader();return u._reader=o,u._aborted&&u._reader.cancel(),{status:l.status,statusText:l.statusText,headers:l.headers,body:{getReader:function(){return o}}}})},q=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){this.signal._reader!=null&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function fe(){this.bitsNeeded=0,this.codePoint=0}fe.prototype.decode=function(c){function D(f,n,p){if(p===1)return f>=128>>n&&f<<n<=2047;if(p===2)return f>=2048>>n&&f<<n<=55295||f>=57344>>n&&f<<n<=65535;if(p===3)return f>=65536>>n&&f<<n<=1114111;throw new Error}function u(f,n){if(f===6*1)return n>>6>15?3:n>31?2:1;if(f===6*2)return n>15?3:2;if(f===6*3)return 3;throw new Error}for(var l=65533,o="",a=this.bitsNeeded,y=this.codePoint,A=0;A<c.length;A+=1){var $=c[A];a!==0&&($<128||$>191||!D(y<<6|$&63,a-6,u(a,y)))&&(a=0,y=l,o+=String.fromCharCode(y)),a===0?($>=0&&$<=127?(a=0,y=$):$>=192&&$<=223?(a=6*1,y=$&31):$>=224&&$<=239?(a=6*2,y=$&15):$>=240&&$<=247?(a=6*3,y=$&7):(a=0,y=l),a!==0&&!D(y,a,u(a,y))&&(a=0,y=l)):(a-=6,y=y<<6|$&63),a===0&&(y<=65535?o+=String.fromCharCode(y):(o+=String.fromCharCode(55296+(y-65535-1>>10)),o+=String.fromCharCode(56320+(y-65535-1&1023))))}return this.bitsNeeded=a,this.codePoint=y,o};var j=function(){try{return new M().decode(new te().encode("test"),{stream:!0})==="test"}catch(c){console.debug("TextDecoder does not support streaming option. Using polyfill instead: "+c)}return!1};(M==null||te==null||!j())&&(M=fe);var O=function(){};function Z(c){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=O,this.onload=O,this.onerror=O,this.onreadystatechange=O,this._contentType="",this._xhr=c,this._sendTimeout=0,this._abort=O}Z.prototype.open=function(c,D){this._abort(!0);var u=this,l=this._xhr,o=1,a=0;this._abort=function(p){u._sendTimeout!==0&&(H(u._sendTimeout),u._sendTimeout=0),(o===1||o===2||o===3)&&(o=4,l.onload=O,l.onerror=O,l.onabort=O,l.onprogress=O,l.onreadystatechange=O,l.abort(),a!==0&&(H(a),a=0),p||(u.readyState=4,u.onabort(null),u.onreadystatechange())),o=0};var y=function(){if(o===1){var p=0,I="",Q=void 0;if("contentType"in l)p=200,I="OK",Q=l.contentType;else try{p=l.status,I=l.statusText,Q=l.getResponseHeader("Content-Type")}catch{p=0,I="",Q=void 0}p!==0&&(o=2,u.readyState=2,u.status=p,u.statusText=I,u._contentType=Q,u.onreadystatechange())}},A=function(){if(y(),o===2||o===3){o=3;var p="";try{p=l.responseText}catch{}u.readyState=3,u.responseText=p,u.onprogress()}},$=function(p,I){if((I==null||I.preventDefault==null)&&(I={preventDefault:O}),A(),o===1||o===2||o===3){if(o=4,a!==0&&(H(a),a=0),u.readyState=4,p==="load")u.onload(I);else if(p==="error")u.onerror(I);else if(p==="abort")u.onabort(I);else throw new TypeError;u.onreadystatechange()}},f=function(p){l!=null&&(l.readyState===4?(!("onload"in l)||!("onerror"in l)||!("onabort"in l))&&$(l.responseText===""?"error":"load",p):l.readyState===3?"onprogress"in l||A():l.readyState===2&&y())},n=function(){a=U(function(){n()},500),l.readyState===3&&A()};"onload"in l&&(l.onload=function(p){$("load",p)}),"onerror"in l&&(l.onerror=function(p){$("error",p)}),"onabort"in l&&(l.onabort=function(p){$("abort",p)}),"onprogress"in l&&(l.onprogress=A),"onreadystatechange"in l&&(l.onreadystatechange=function(p){f(p)}),("contentType"in l||!("ontimeout"in z.prototype))&&(D+=(D.indexOf("?")===-1?"?":"&")+"padding=true"),l.open(c,D,!0),"readyState"in l&&(a=U(function(){n()},0))},Z.prototype.abort=function(){this._abort(!1)},Z.prototype.getResponseHeader=function(c){return this._contentType},Z.prototype.setRequestHeader=function(c,D){var u=this._xhr;"setRequestHeader"in u&&u.setRequestHeader(c,D)},Z.prototype.getAllResponseHeaders=function(){return this._xhr.getAllResponseHeaders!=null&&this._xhr.getAllResponseHeaders()||""},Z.prototype.send=function(){if((!("ontimeout"in z.prototype)||!("sendAsBinary"in z.prototype)&&!("mozAnon"in z.prototype))&&P!=null&&P.readyState!=null&&P.readyState!=="complete"){var c=this;c._sendTimeout=U(function(){c._sendTimeout=0,c.send()},4);return}var D=this._xhr;"withCredentials"in D&&(D.withCredentials=this.withCredentials);try{D.send(void 0)}catch(u){throw u}};function G(c){return c.replace(/[A-Z]/g,function(D){return String.fromCharCode(D.charCodeAt(0)+32)})}function k(c){for(var D=Object.create(null),u=c.split(`\r
`),l=0;l<u.length;l+=1){var o=u[l],a=o.split(": "),y=a.shift(),A=a.join(": ");D[G(y)]=A}this._map=D}k.prototype.get=function(c){return this._map[G(c)]},z!=null&&z.HEADERS_RECEIVED==null&&(z.HEADERS_RECEIVED=2);function w(){}w.prototype.open=function(c,D,u,l,o,a,y){c.open("GET",o);var A=0;c.onprogress=function(){var f=c.responseText,n=f.slice(A);A+=n.length,u(n)},c.onerror=function(f){f.preventDefault(),l(new Error("NetworkError"))},c.onload=function(){l(null)},c.onabort=function(){l(null)},c.onreadystatechange=function(){if(c.readyState===z.HEADERS_RECEIVED){var f=c.status,n=c.statusText,p=c.getResponseHeader("Content-Type"),I=c.getAllResponseHeaders();D(f,n,p,new k(I))}},c.withCredentials=a;for(var $ in y)Object.prototype.hasOwnProperty.call(y,$)&&c.setRequestHeader($,y[$]);return c.send(),c};function b(c){this._headers=c}b.prototype.get=function(c){return this._headers.get(c)};function oe(){}oe.prototype.open=function(c,D,u,l,o,a,y){var A=null,$=new q,f=$.signal,n=new M;return C(o,{headers:y,credentials:a?"include":"same-origin",signal:f,cache:"no-store"}).then(function(p){return A=p.body.getReader(),D(p.status,p.statusText,p.headers.get("Content-Type"),new b(p.headers)),new F(function(I,Q){var ee=function(){A.read().then(function(ye){if(ye.done)I(void 0);else{var ce=n.decode(ye.value,{stream:!0});u(ce),ee()}}).catch(function(ye){Q(ye)})};ee()})}).catch(function(p){if(p.name!=="AbortError")return p}).then(function(p){l(p)}),{abort:function(){A!=null&&A.cancel(),$.abort()}}};function B(){this._listeners=Object.create(null)}function ae(c){U(function(){throw c},0)}B.prototype.dispatchEvent=function(c){c.target=this;var D=this._listeners[c.type];if(D!=null)for(var u=D.length,l=0;l<u;l+=1){var o=D[l];try{typeof o.handleEvent=="function"?o.handleEvent(c):o.call(this,c)}catch(a){ae(a)}}},B.prototype.addEventListener=function(c,D){c=String(c);var u=this._listeners,l=u[c];l==null&&(l=[],u[c]=l);for(var o=!1,a=0;a<l.length;a+=1)l[a]===D&&(o=!0);o||l.push(D)},B.prototype.removeEventListener=function(c,D){c=String(c);var u=this._listeners,l=u[c];if(l!=null){for(var o=[],a=0;a<l.length;a+=1)l[a]!==D&&o.push(l[a]);o.length===0?delete u[c]:u[c]=o}};function se(c){this.type=c,this.target=void 0}function ge(c,D){se.call(this,c),this.data=D.data,this.lastEventId=D.lastEventId}ge.prototype=Object.create(se.prototype);function re(c,D){se.call(this,c),this.status=D.status,this.statusText=D.statusText,this.headers=D.headers}re.prototype=Object.create(se.prototype);function Ce(c,D){se.call(this,c),this.error=D.error}Ce.prototype=Object.create(se.prototype);var de=-1,_e=0,ie=1,be=2,Ne=-1,we=0,N=1,s=2,v=3,r=/^text\/event\-stream(;.*)?$/i,h=1e3,K=18e6,me=function(c,D){var u=c==null?D:parseInt(c,10);return u!==u&&(u=D),le(u)},le=function(c){return Math.min(Math.max(c,h),K)},Te=function(c,D,u){try{typeof D=="function"&&D.call(c,u)}catch(l){ae(l)}};function De(c,D){B.call(this),D=D||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,Be(this,c,D)}function Oe(){return z!=null&&"withCredentials"in z.prototype||T==null?new z:new T}var Ee=C!=null&&E!=null&&"body"in E.prototype;function Be(c,D,u){D=String(D);var l=Boolean(u.withCredentials),o=u.lastEventIdQueryParameterName||"lastEventId",a=le(1e3),y=me(u.heartbeatTimeout,45e3),A="",$=a,f=!1,n=0,p=u.headers||{},I=u.Transport,Q=Ee&&I==null?void 0:new Z(I!=null?new I:Oe()),ee=I!=null&&typeof I!="string"?new I:Q==null?new oe:new w,ye=void 0,ce=0,xe=de,Ue="",We="",ze="",Re="",Ie=we,je=0,He=0,Qe=function($e,Se,Le,Pe){if(xe===_e)if($e===200&&Le!=null&&r.test(Le)){xe=ie,f=Date.now(),$=a,c.readyState=ie;var Me=new re("open",{status:$e,statusText:Se,headers:Pe});c.dispatchEvent(Me),Te(c,c.onopen,Me)}else{var Ae="";$e!==200?(Se&&(Se=Se.replace(/\s+/g," ")),Ae="EventSource's response has a status "+$e+" "+Se+" that is not 200. Aborting the connection."):Ae="EventSource's response has a Content-Type specifying an unsupported type: "+(Le==null?"-":Le.replace(/\s+/g," "))+". Aborting the connection.",Ze();var Me=new re("error",{status:$e,statusText:Se,headers:Pe});c.dispatchEvent(Me),Te(c,c.onerror,Me),console.error(Ae)}},W=function($e){if(xe===ie){for(var Se=-1,Le=0;Le<$e.length;Le+=1){var Pe=$e.charCodeAt(Le);(Pe===`
`.charCodeAt(0)||Pe==="\r".charCodeAt(0))&&(Se=Le)}var Me=(Se!==-1?Re:"")+$e.slice(0,Se+1);Re=(Se===-1?Re:"")+$e.slice(Se+1),$e!==""&&(f=Date.now(),n+=$e.length);for(var Ae=0;Ae<Me.length;Ae+=1){var Pe=Me.charCodeAt(Ae);if(Ie===Ne&&Pe===`
`.charCodeAt(0))Ie=we;else if(Ie===Ne&&(Ie=we),Pe==="\r".charCodeAt(0)||Pe===`
`.charCodeAt(0)){if(Ie!==we){Ie===N&&(He=Ae+1);var Je=Me.slice(je,He-1),Ye=Me.slice(He+(He<Ae&&Me.charCodeAt(He)===" ".charCodeAt(0)?1:0),Ae);Je==="data"?(Ue+=`
`,Ue+=Ye):Je==="id"?We=Ye:Je==="event"?ze=Ye:Je==="retry"?(a=me(Ye,a),$=a):Je==="heartbeatTimeout"&&(y=me(Ye,y),ce!==0&&(H(ce),ce=U(function(){it()},y)))}if(Ie===we){if(Ue!==""){A=We,ze===""&&(ze="message");var at=new ge(ze,{data:Ue.slice(1),lastEventId:We});if(c.dispatchEvent(at),ze==="open"?Te(c,c.onopen,at):ze==="message"?Te(c,c.onmessage,at):ze==="error"&&Te(c,c.onerror,at),xe===be)return}Ue="",ze=""}Ie=Pe==="\r".charCodeAt(0)?Ne:we}else Ie===we&&(je=Ae,Ie=N),Ie===N?Pe===":".charCodeAt(0)&&(He=Ae+1,Ie=s):Ie===s&&(Ie=v)}}},V=function($e){if(xe===ie||xe===_e){xe=de,ce!==0&&(H(ce),ce=0),ce=U(function(){it()},$),$=le(Math.min(a*16,$*2)),c.readyState=_e;var Se=new Ce("error",{error:$e});c.dispatchEvent(Se),Te(c,c.onerror,Se),$e!=null&&console.error($e)}},Ze=function(){xe=be,ye!=null&&(ye.abort(),ye=void 0),ce!==0&&(H(ce),ce=0),c.readyState=be},it=function(){if(ce=0,xe!==de){if(!f&&ye!=null)V(new Error("No activity within "+y+" milliseconds. "+(xe===_e?"No response received.":n+" chars received.")+" Reconnecting.")),ye!=null&&(ye.abort(),ye=void 0);else{var $e=Math.max((f||Date.now())+y-Date.now(),1);f=!1,ce=U(function(){it()},$e)}return}f=!1,n=0,ce=U(function(){it()},y),xe=_e,Ue="",ze="",We=A,Re="",je=0,He=0,Ie=we;var Se=D;if(D.slice(0,5)!=="data:"&&D.slice(0,5)!=="blob:"&&A!==""){var Le=D.indexOf("?");Se=Le===-1?D:D.slice(0,Le+1)+D.slice(Le+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,function(Ye,at){return at===o?"":Ye}),Se+=(D.indexOf("?")===-1?"?":"&")+o+"="+encodeURIComponent(A)}var Pe=c.withCredentials,Me={};Me.Accept="text/event-stream";var Ae=c.headers;if(Ae!=null)for(var Je in Ae)Object.prototype.hasOwnProperty.call(Ae,Je)&&(Me[Je]=Ae[Je]);try{ye=ee.open(Q,Qe,W,V,Se,Pe,Me)}catch(Ye){throw Ze(),Ye}};c.url=D,c.readyState=_e,c.withCredentials=l,c.headers=p,c._close=Ze,it()}De.prototype=Object.create(B.prototype),De.prototype.CONNECTING=_e,De.prototype.OPEN=ie,De.prototype.CLOSED=be,De.prototype.close=function(){this._close()},De.CONNECTING=_e,De.OPEN=ie,De.CLOSED=be,De.prototype.withCredentials=void 0;var Fe=X;z!=null&&(X==null||!("withCredentials"in X.prototype))&&(Fe=De),function(c){{var D=c(ne);D!==void 0&&(_.exports=D)}}(function(c){c.EventSourcePolyfill=De,c.NativeEventSource=X,c.EventSource=Fe})})(typeof globalThis=="undefined"?typeof window!="undefined"?window:typeof self!="undefined"?self:$t:globalThis)})(ft,ft.exports);const Xt={class:"medical-form-container"},Kt={class:"action-bar"},Jt={class:"action-group"},Yt={class:"form-section"},Gt={class:"section-header"},Qt={class:"form-section"},Zt={class:"section-header"},ea={class:"diagnosis-wrapper"},ta={class:"form-section"},aa={class:"section-header"},la={class:"dialog-search"},na={class:"dialog-pagination"},oa={class:"dialog-footer"},sa={class:"diagnosis-section"},ia={class:"diagnosis-category"},ra={class:"diagnosis-header"},da={class:"header-title"},ua={class:"header-actions"},ca={class:"diagnosis-category"},pa={class:"diagnosis-header"},fa={class:"header-title"},ma={class:"header-actions"},va={class:"dialog-footer"},ga={class:"ai-title-bar"},ya={key:1,class:"ai-content-wrapper"},_a={key:0,class:"ai-section-block"},ba={class:"ai-section-title"},wa={class:"ai-section-text"},ha={key:1,class:"ai-section-block ai-section-comment"},Ca={class:"ai-section-title ai-section-title-comment"},ka={class:"ai-section-text ai-section-text-comment"},ut=176,ct=177,Da={__name:"Doc01",props:{patient:{type:Object,default:null},isDiagnosed:{type:Boolean,default:!1}},setup(_,{expose:ne}){const S=_,U=m([]),H=m([]),z=m([]),T=m([]),J=m([]),X=m([]),P=m(!0),F=m(!0),C=m(!0),E=m(!0),M=m(!1),te=m(!1),q=m([]),Y=m([]),fe=m(null),j=m(1),O=m(10),Z=m(0),G=m(""),k=m("west");m(!1);const w=m(!1),b=m({}),oe=m(null),B=m(null),ae=m(""),se=m(!1);let ge=null,re=null,Ce="";const de=m(null),_e=m(null),ie=Ge(()=>w.value||S.isDiagnosed);Dt(async()=>{});async function be(f){if(!!f)try{let n=`/disease/page?count=${O.value}&pn=${j.value}&dicaType=${f}`;G.value&&(n+=`&keyword=${G.value}`);const p=await et(n);p.data.result?(q.value=p.data.data.records,Z.value=p.data.data.total):(q.value=[],Z.value=0)}catch(n){console.error(n),q.value=[],Z.value=0,i.error("\u52A0\u8F7D\u75BE\u75C5\u5217\u8868\u5931\u8D25")}}function Ne(f){Y.value=f}function we(f){O.value=f,be(k.value==="west"?ut:ct)}function N(f){j.value=f,be(k.value==="west"?ut:ct)}function s(){j.value=1,be(k.value==="west"?ut:ct)}function v(){if(!S.patient){i.error("\u8BF7\u5148\u9009\u62E9\u4E00\u4F4D\u60A3\u8005");return}M.value=!0}function r(){z.value=JSON.parse(JSON.stringify(U.value)),T.value=JSON.parse(JSON.stringify(H.value))}function h(){U.value=z.value,H.value=T.value,M.value=!1}async function K(f){G.value="",k.value=f,j.value=1,q.value=[],Y.value=[],await be(f==="west"?ut:ct),te.value=!0}function me(f){f==="west"?z.value=z.value.filter(n=>!J.value.includes(n)):T.value=T.value.filter(n=>!X.value.includes(n))}function le(f){J.value=f}function Te(f){X.value=f}function De(){const f=Y.value.map(n=>{const p=k.value==="west"?1:2;return{registId:oe.value,diseaseID:n.id,diagnoseType:p,getSiskDate:new Date,diagnoseCate:1,disease:n}});k.value==="west"?z.value.push(...f):T.value.push(...f),te.value=!1}const Oe=async f=>{if(!f){console.error("\u52A0\u8F7D\u75C5\u5386\u7684rid\u65E0\u6548");return}try{const n=await et("/neudoc/medicalrecord/getByRegistId",{registId:f});if(n.data.data){if(Object.assign(b.value,n.data.data),b.value.medicalDiseases){const p=b.value.medicalDiseases.filter(Q=>Q.diagnoseType===1),I=b.value.medicalDiseases.filter(Q=>Q.diagnoseType===2);U.value=p,H.value=I}}else{const p={registId:S.patient.id,caseNumber:S.patient.caseNumber};D(),Object.assign(b.value,p)}}catch(n){console.error("\u52A0\u8F7D\u75C5\u5386\u5931\u8D25:",n),i.error("\u52A0\u8F7D\u75C5\u5386\u5931\u8D25")}},Ee=f=>new Promise((n,p)=>{if(!S.patient)return i.error("\u8BF7\u5148\u9009\u62E9\u4E00\u4F4D\u60A3\u8005"),p(new Error("No patient selected"));w.value=!1,b.value.medicalDiseases=[...U.value,...H.value],pe("/neudoc/medicalrecord/save",b.value).then(I=>{I.data.result?(f&&typeof f=="function"?f():i.success("\u6682\u5B58\u6210\u529F"),Object.assign(b.value,I.data.data),n(!0)):(i.error(I.data.errMsg||"\u64CD\u4F5C\u5931\u8D25"),p(new Error(I.data.errMsg||"\u64CD\u4F5C\u5931\u8D25")))}).catch(I=>{i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u64CD\u4F5C\u5931\u8D25"),p(I)})}),Be=()=>{if(!S.patient){i.error("\u8BF7\u5148\u9009\u62E9\u4E00\u4F4D\u60A3\u8005");return}Ee(()=>{w.value=!0})};function Fe(){qe.confirm("\u786E\u8BA4\u662F\u5426\u6E05\u7A7A?","\u63D0\u9192",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{b.value={}})}function c(){oe.value?(Oe(oe.value),i.success("\u5237\u65B0\u6210\u529F")):i.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u4F4D\u60A3\u8005")}function D(){b.value={},U.value=[],H.value=[],w.value=!1,ae.value=""}const u=Ge(()=>{const f=U.value.map(I=>I.disease.diseaseName).join(", "),n=H.value.map(I=>I.disease.diseaseName).join(", ");let p="";return f&&(p+=`\u897F\u533B\u8BCA\u65AD: ${f}`),n&&(p&&(p+=`
`),p+=`\u4E2D\u533B\u8BCA\u65AD: ${n}`),p||"\u65E0"});Xe(()=>S.patient,(f,n)=>{f&&f.id?(!n||f.id!==n.id)&&Oe(f.id):D()},{deep:!0,immediate:!0}),Xe([U,H],()=>{P.value=H.value.length===0,F.value=U.value.length===0},{deep:!0}),Xe([z,T],()=>{C.value=T.value.length===0,E.value=z.value.length===0},{deep:!0});function l(){ae.value="",re&&clearInterval(re),ge&&(ge.close(),ge=null),Ce=""}function o(f){return f.replace(/\*\*[^*]+\*\*/g,"").replace(/\*\*/g,"").trim()}function a(f){re&&clearInterval(re);let n=0;const p=ae.value,I=o(f);re=setInterval(()=>{ae.value=p+I.slice(p.length,p.length+n+1),n++,p.length+n>=I.length&&clearInterval(re)},18)}Xe(ae,async()=>{await It(),de.value&&de.value.wrapRef&&(de.value.wrapRef.scrollTop=de.value.wrapRef.scrollHeight),_e.value&&_e.value.scrollIntoView&&_e.value.scrollIntoView({behavior:"smooth",block:"end"})});async function y(){if(!S.patient){i.error("\u8BF7\u5148\u9009\u62E9\u4E00\u4F4D\u60A3\u8005");return}l(),se.value=!0;const f=encodeURIComponent(JSON.stringify(b.value)),p=st().userInfo.token||localStorage.getItem("token");ge=new ft.exports.EventSourcePolyfill(`/ai/stream?message=${f}`,{headers:{token:p}}),ge.onmessage=function(I){let Q=I.data.trim();if(Q.startsWith("data:")&&(Q=Q.substring(5).trim()),!(Q===""||Q.startsWith(":")))try{const ee=JSON.parse(Q);if(ee.output&&ee.output.choices&&ee.output.choices.length>0){const ye=ee.output.choices[0].message;ye&&ye.content&&(Ce=ye.content,a(Ce))}}catch(ee){console.warn("\u65E0\u6CD5\u89E3\u6790SSE\u4E2D\u7684JSON\u7247\u6BB5:",I.data,ee)}},ge.onerror=function(){se.value=!1,ge&&ge.close()}}function A(f){const n=o(f),p={analysis:"",comment:""},I=n.match(/([\s\S]*?)(评价[：:][\s\S]*)/);return I?(p.analysis=I[1].trim(),p.comment=I[2].replace(/^评价[：:]/,"").trim()):p.analysis=n,p}const $=Ge(()=>A(ae.value));return ne({loadMedicalRecord:Oe,clearForm:D,save:Ee}),(f,n)=>{const p=d("el-button"),I=d("el-icon"),Q=d("el-input"),ee=d("el-form-item"),ye=d("el-form"),ce=d("el-table-column"),xe=d("el-table"),Ue=d("el-pagination"),We=d("el-dialog"),ze=d("el-date-picker"),Re=d("el-col"),Ie=d("el-tag"),je=d("el-empty"),He=d("el-card"),Qe=d("el-row"),W=d("el-main");return R(),ue(W,{class:"medical-record-main"},{default:t(()=>[e(Qe,{gutter:40},{default:t(()=>[e(Re,{span:16},{default:t(()=>[x("div",Xt,[x("div",Kt,[x("div",Jt,[e(p,{icon:L(Nt),type:"default",plain:"",onClick:Ee,disabled:ie.value},{default:t(()=>n[21]||(n[21]=[g(" \u6682\u5B58 ")])),_:1,__:[21]},8,["icon","disabled"]),e(p,{type:"success",icon:L(Ut),onClick:Be,disabled:ie.value},{default:t(()=>n[22]||(n[22]=[g(" \u63D0\u4EA4 ")])),_:1,__:[22]},8,["icon","disabled"]),e(p,{type:"danger",plain:"",icon:L(nt),onClick:Fe,disabled:ie.value},{default:t(()=>n[23]||(n[23]=[g(" \u6E05\u7A7A ")])),_:1,__:[23]},8,["icon","disabled"]),e(p,{icon:L(mt),onClick:c},{default:t(()=>n[24]||(n[24]=[g(" \u5237\u65B0 ")])),_:1,__:[24]},8,["icon"]),e(p,{type:"primary",class:"ai-btn-highlight",onClick:y,disabled:ie.value},{default:t(()=>[n[25]||(n[25]=g(" AI\u5206\u6790 ")),e(I,{class:"el-icon--right"},{default:t(()=>[e(L(bt))]),_:1})]),_:1,__:[25]},8,["disabled"])])]),e(ye,{ref:"form","label-width":"100px","label-position":"left",class:"medical-form"},{default:t(()=>[x("div",Yt,[x("div",Gt,[e(I,null,{default:t(()=>[e(L(Rt))]),_:1}),n[26]||(n[26]=x("span",null,"\u75C5\u53F2\u5185\u5BB9",-1))]),e(ee,{label:"\u4E3B\u8BC9"},{default:t(()=>[e(Q,{modelValue:b.value.readme,"onUpdate:modelValue":n[0]||(n[0]=V=>b.value.readme=V),placeholder:_.isDiagnosed?"\u6682\u65E0\u5185\u5BB9":"\u60A3\u8005\u9648\u8FF0\u7684\u4E3B\u8981\u75C7\u72B6\u3001\u4F53\u5F81\u53CA\u5176\u6301\u7EED\u65F6\u95F4",disabled:_.isDiagnosed,class:"custom-input"},null,8,["modelValue","placeholder","disabled"])]),_:1}),e(ee,{label:"\u73B0\u75C5\u53F2"},{default:t(()=>[e(Q,{type:"textarea",modelValue:b.value.present,"onUpdate:modelValue":n[1]||(n[1]=V=>b.value.present=V),placeholder:_.isDiagnosed?"\u6682\u65E0\u5185\u5BB9":"\u56F4\u7ED5\u4E3B\u8BC9\uFF0C\u8BE6\u7EC6\u63CF\u8FF0\u75C5\u60C5\u53D1\u751F\u3001\u53D1\u5C55\u3001\u6F14\u53D8\u3001\u8BCA\u7597\u7684\u8FC7\u7A0B",disabled:_.isDiagnosed,rows:3,class:"custom-textarea"},null,8,["modelValue","placeholder","disabled"])]),_:1}),e(ee,{label:"\u73B0\u75C5\u6CBB\u7597\u60C5\u51B5"},{default:t(()=>[e(Q,{type:"textarea",modelValue:b.value.presentTreat,"onUpdate:modelValue":n[2]||(n[2]=V=>b.value.presentTreat=V),placeholder:_.isDiagnosed?"\u6682\u65E0\u5185\u5BB9":"\u60A3\u8005\u5728\u6765\u672C\u9662\u5C31\u8BCA\u524D\uFF0C\u9488\u5BF9\u73B0\u75C5\u505A\u8FC7\u7684\u6CBB\u7597",disabled:_.isDiagnosed,rows:2,class:"custom-textarea"},null,8,["modelValue","placeholder","disabled"])]),_:1}),e(ee,{label:"\u65E2\u5F80\u53F2"},{default:t(()=>[e(Q,{modelValue:b.value.history,"onUpdate:modelValue":n[3]||(n[3]=V=>b.value.history=V),placeholder:_.isDiagnosed?"\u6682\u65E0\u5185\u5BB9":"\u60A3\u8005\u65E2\u5F80\u7684\u5065\u5EB7\u72B6\u51B5\u548C\u75BE\u75C5\u5386\u53F2",disabled:_.isDiagnosed,class:"custom-input"},null,8,["modelValue","placeholder","disabled"])]),_:1}),e(ee,{label:"\u8FC7\u654F\u53F2"},{default:t(()=>[e(Q,{modelValue:b.value.allergy,"onUpdate:modelValue":n[4]||(n[4]=V=>b.value.allergy=V),placeholder:_.isDiagnosed?"\u6682\u65E0\u5185\u5BB9":"\u60A3\u8005\u7684\u8FC7\u654F\u53F2",disabled:_.isDiagnosed,class:"custom-input"},null,8,["modelValue","placeholder","disabled"])]),_:1}),e(ee,{label:"\u4F53\u683C\u68C0\u67E5"},{default:t(()=>[e(Q,{type:"textarea",modelValue:b.value.physique,"onUpdate:modelValue":n[5]||(n[5]=V=>b.value.physique=V),placeholder:_.isDiagnosed?"\u6682\u65E0\u5185\u5BB9":"\u533B\u751F\u7684\u4F53\u683C\u68C0\u67E5\u7ED3\u679C",disabled:_.isDiagnosed,rows:2,class:"custom-textarea"},null,8,["modelValue","placeholder","disabled"])]),_:1})]),x("div",Qt,[x("div",Zt,[e(I,null,{default:t(()=>[e(L(At))]),_:1}),n[27]||(n[27]=x("span",null,"\u8BCA\u65AD\u4FE1\u606F",-1))]),e(ee,{label:"\u8BC4\u4F30/\u8BCA\u65AD"},{default:t(()=>[x("div",ea,[e(Q,{type:"textarea",rows:3,value:u.value,readonly:"",disabled:ie.value,placeholder:_.isDiagnosed?"\u6682\u65E0\u5185\u5BB9":"\u70B9\u51FB\u53F3\u4FA7\u6309\u94AE\u8FDB\u884C\u8BCA\u65AD",class:"custom-textarea"},null,8,["value","disabled","placeholder"]),e(p,{type:"primary",onClick:v,disabled:ie.value,class:"diagnosis-btn"},{default:t(()=>n[28]||(n[28]=[g(" \u8BC4\u4F30/\u8BCA\u65AD ")])),_:1,__:[28]},8,["disabled"])])]),_:1}),e(ee,{label:"\u68C0\u67E5\u5EFA\u8BAE"},{default:t(()=>[e(Q,{type:"textarea",modelValue:b.value.proposal,"onUpdate:modelValue":n[6]||(n[6]=V=>b.value.proposal=V),placeholder:_.isDiagnosed?"\u6682\u65E0\u5185\u5BB9":"\u533B\u751F\u7684\u68C0\u67E5\u5EFA\u8BAE",disabled:_.isDiagnosed,rows:2,class:"custom-textarea"},null,8,["modelValue","placeholder","disabled"])]),_:1}),e(ee,{label:"\u6CE8\u610F\u4E8B\u9879"},{default:t(()=>[e(Q,{type:"textarea",modelValue:b.value.careful,"onUpdate:modelValue":n[7]||(n[7]=V=>b.value.careful=V),placeholder:_.isDiagnosed?"\u6682\u65E0\u5185\u5BB9":"\u533B\u751F\u7684\u6CE8\u610F\u4E8B\u9879",disabled:_.isDiagnosed,rows:2,class:"custom-textarea"},null,8,["modelValue","placeholder","disabled"])]),_:1})]),x("div",ta,[x("div",aa,[e(I,null,{default:t(()=>[e(L(Vt))]),_:1}),n[29]||(n[29]=x("span",null,"\u68C0\u67E5\u7ED3\u679C",-1))]),e(ee,{label:"\u68C0\u67E5\u7ED3\u679C"},{default:t(()=>[e(Q,{type:"textarea",rows:3,modelValue:b.value.checkResult,"onUpdate:modelValue":n[8]||(n[8]=V=>b.value.checkResult=V),disabled:ie.value,placeholder:_.isDiagnosed?"\u6682\u65E0\u5185\u5BB9":"\u8BF7\u8F93\u5165\u68C0\u67E5\u7ED3\u679C",class:"custom-textarea"},null,8,["modelValue","disabled","placeholder"])]),_:1}),e(ee,{label:"\u5904\u7406\u610F\u89C1"},{default:t(()=>[e(Q,{type:"textarea",rows:3,modelValue:b.value.handling,"onUpdate:modelValue":n[9]||(n[9]=V=>b.value.handling=V),disabled:ie.value,placeholder:_.isDiagnosed?"\u6682\u65E0\u5185\u5BB9":"\u8BF7\u8F93\u5165\u5904\u7406\u610F\u89C1",class:"custom-textarea"},null,8,["modelValue","disabled","placeholder"])]),_:1})])]),_:1},512)]),e(We,{title:"\u9009\u62E9\u8BCA\u65AD",modelValue:te.value,"onUpdate:modelValue":n[14]||(n[14]=V=>te.value=V),width:"50%",class:"custom-dialog"},{footer:t(()=>[x("span",oa,[e(p,{onClick:n[13]||(n[13]=V=>te.value=!1)},{default:t(()=>n[30]||(n[30]=[g("\u53D6 \u6D88")])),_:1,__:[30]}),e(p,{type:"primary",onClick:De},{default:t(()=>n[31]||(n[31]=[g("\u786E \u5B9A")])),_:1,__:[31]})])]),default:t(()=>[x("div",la,[e(Q,{modelValue:G.value,"onUpdate:modelValue":n[10]||(n[10]=V=>G.value=V),placeholder:"\u6309\u75BE\u75C5\u7F16\u7801\u6216\u540D\u79F0\u641C\u7D22",clearable:"",onClear:s,onKeyup:xt(s,["enter"])},{append:t(()=>[e(p,{icon:L(tt),onClick:s},null,8,["icon"])]),_:1},8,["modelValue"])]),e(xe,{data:q.value,onSelectionChange:Ne,"max-height":"300px",ref_key:"diseaseTable",ref:fe,class:"custom-table"},{default:t(()=>[e(ce,{type:"selection",width:"55"}),e(ce,{property:"diseaseCode",label:"ICD\u7F16\u7801"}),e(ce,{property:"diseaseName",label:"\u540D\u79F0"})]),_:1},8,["data"]),x("div",na,[e(Ue,{"current-page":j.value,"onUpdate:currentPage":n[11]||(n[11]=V=>j.value=V),"page-size":O.value,"onUpdate:pageSize":n[12]||(n[12]=V=>O.value=V),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:Z.value,onSizeChange:we,onCurrentChange:N},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"]),e(We,{title:"\u8BC4\u4F30/\u8BCA\u65AD",modelValue:M.value,"onUpdate:modelValue":n[20]||(n[20]=V=>M.value=V),width:"60%",onOpen:r,class:"custom-dialog"},{footer:t(()=>[x("span",va,[e(p,{onClick:n[19]||(n[19]=V=>M.value=!1)},{default:t(()=>n[38]||(n[38]=[g("\u53D6 \u6D88")])),_:1,__:[38]}),e(p,{type:"primary",onClick:h},{default:t(()=>n[39]||(n[39]=[g("\u786E \u5B9A")])),_:1,__:[39]})])]),default:t(()=>[x("div",sa,[x("div",ia,[x("div",ra,[x("div",da,[e(I,null,{default:t(()=>[e(L(Et))]),_:1}),n[32]||(n[32]=x("span",null,"\u897F\u533B\u8BCA\u65AD",-1))]),x("div",ua,[e(p,{type:"primary",plain:"",onClick:n[15]||(n[15]=V=>K("west")),disabled:T.value.length>0},{default:t(()=>n[33]||(n[33]=[g(" \u589E\u52A0 ")])),_:1,__:[33]},8,["disabled"]),e(p,{type:"danger",plain:"",onClick:n[16]||(n[16]=V=>me("west")),disabled:!C.value},{default:t(()=>n[34]||(n[34]=[g(" \u5220\u9664 ")])),_:1,__:[34]},8,["disabled"])])]),e(xe,{data:z.value,onSelectionChange:le,ref:"westTable","max-height":"200px",class:"custom-table"},{default:t(()=>[e(ce,{type:"selection",width:"55",disabled:!C.value},null,8,["disabled"]),e(ce,{prop:"disease.diseaseCode",label:"ICD\u7F16\u7801"}),e(ce,{prop:"disease.diseaseName",label:"\u540D\u79F0"}),e(ce,{label:"\u53D1\u75C5\u65E5\u671F",width:"180"},{default:t(V=>[e(ze,{modelValue:V.row.getSiskDate,"onUpdate:modelValue":Ze=>V.row.getSiskDate=Ze,type:"date",placeholder:"\u9009\u62E9\u65E5\u671F",style:{width:"100%"},class:"custom-date-picker"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])]),x("div",ca,[x("div",pa,[x("div",fa,[e(I,null,{default:t(()=>[e(L(zt))]),_:1}),n[35]||(n[35]=x("span",null,"\u4E2D\u533B\u8BCA\u65AD",-1))]),x("div",ma,[e(p,{type:"primary",plain:"",onClick:n[17]||(n[17]=V=>K("east")),disabled:z.value.length>0},{default:t(()=>n[36]||(n[36]=[g(" \u589E\u52A0 ")])),_:1,__:[36]},8,["disabled"]),e(p,{type:"danger",plain:"",onClick:n[18]||(n[18]=V=>me("east")),disabled:!E.value},{default:t(()=>n[37]||(n[37]=[g(" \u5220\u9664 ")])),_:1,__:[37]},8,["disabled"])])]),e(xe,{data:T.value,onSelectionChange:Te,ref_key:"eastTable",ref:B,"max-height":"200px",class:"custom-table"},{default:t(()=>[e(ce,{type:"selection",width:"55",disabled:!E.value},null,8,["disabled"]),e(ce,{prop:"disease.diseaseCode",label:"ICD\u7F16\u7801"}),e(ce,{prop:"disease.diseaseName",label:"\u540D\u79F0"}),e(ce,{label:"\u53D1\u75C5\u65E5\u671F",width:"180"},{default:t(V=>[e(ze,{modelValue:V.row.getSiskDate,"onUpdate:modelValue":Ze=>V.row.getSiskDate=Ze,type:"date",placeholder:"\u9009\u62E9\u65E5\u671F",style:{width:"100%"},class:"custom-date-picker"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])])])]),_:1},8,["modelValue"])]),_:1}),e(Re,{span:8},{default:t(()=>[e(He,{class:"ai-card-beauty"},{header:t(()=>[x("div",ga,[e(I,{class:"ai-title-icon"},{default:t(()=>[e(L(bt))]),_:1}),n[41]||(n[41]=x("span",{class:"ai-title-text"},"AI\u5206\u6790\u7ED3\u679C",-1)),se.value?(R(),ue(Ie,{key:0,type:"info",effect:"dark",class:"ai-status-tag"},{default:t(()=>n[40]||(n[40]=[g("\u5206\u6790\u4E2D...")])),_:1,__:[40]})):ke("",!0)])]),default:t(()=>[!ae.value&&!se.value?(R(),ue(je,{key:0,description:"\u6682\u65E0AI\u5206\u6790\u7ED3\u679C"})):(R(),ve("div",ya,[e(Tt,{name:"ai-fade-expand",mode:"out-in"},{default:t(()=>[$.value.analysis||$.value.comment?(R(),ve("div",{key:"ai-content",class:"ai-typewriter-content-beauty",ref_key:"aiContentRef",ref:_e},[$.value.analysis?(R(),ve("div",_a,[x("div",ba,[e(I,null,{default:t(()=>[e(L(Ft))]),_:1}),n[42]||(n[42]=x("span",null,"\u75C5\u5386\u5206\u6790\u7ED3\u679C\uFF1A",-1))]),x("div",wa,he($.value.analysis),1)])):ke("",!0),$.value.comment?(R(),ve("div",ha,[x("div",Ca,[e(I,null,{default:t(()=>[e(L(Mt))]),_:1}),n[43]||(n[43]=x("span",null,"\u8BC4\u4EF7\uFF1A",-1))]),x("div",ka,he($.value.comment),1)])):ke("",!0)],512)):ke("",!0)]),_:1})]))]),_:1})]),_:1})]),_:1})]),_:1})}}};const Ia={class:"toolbar"},Va={class:"total-amount"},xa={key:1},Ta={class:"template-section"},Sa={style:{display:"flex","flex-direction":"row","align-items":"center"}},$a={key:0},Na={class:"dialog-footer"},Ua={key:0},Ra={key:0,class:"result-images-container"},Aa={class:"dialog-footer"},Ea={__name:"Doc02",props:{patient:{type:Object,default:null},isDiagnosed:{type:Boolean,default:!1}},setup(_,{expose:ne}){const S=_,U=st(),H=m([]),z=m({total:0,size:10,current:1}),T=m(null),J=m(null),X=m([]),P=m([]),F=m(!1),C=m([]),E=m(""),M=m(!1),te=m(!1),q=m("template"),Y=m(""),fe=m({records:[],total:0,size:10}),j=m(null),O=m(""),Z=m({records:[],total:0,size:10}),G=m(null),k=m({name:"",applicationName:"",objective:"",position:"",isUrgent:!1,price:0}),w=m(!1),b=m(null);Xe(()=>S.patient,u=>{u?(B(u.id),Ee()):(se(),P.value=[])},{immediate:!0});const oe=Ge(()=>H.value.reduce((u,l)=>u+(l.price||0),0).toFixed(2));async function B(u,l=1){if(u){T.value=u;try{const y=await et("/neudoc/medicalrecord/getByRegistId",{registId:u});y.data.result&&y.data.data&&y.data.data.id?J.value=y.data.data.id:J.value=null}catch(y){console.error("\u83B7\u53D6\u75C5\u5386ID\u5931\u8D25",y),J.value=null}}if(!T.value)return;const o=`/checkapply/page?registId=${T.value}&recordType=1&pn=${l}&count=${z.value.size}`,a=await Ke(o);a.result?(H.value=a.data.records.map(y=>({...y,execState:De(y.state)})),z.value.total=a.data.total,z.value.current=a.data.current):(H.value=[],z.value.total=0)}function ae(u){B(null,u)}function se(){H.value=[],X.value=[],z.value.total=0,z.value.current=1,T.value=null,J.value=null}function ge(){M.value=!0,q.value="template",Ce(),fe.value.records.length===0&&de(1)}function re(u){Ce(),u.paneName==="template"&&fe.value.records.length===0?de(1):u.paneName==="item"&&Z.value.records.length===0&&be(1)}function Ce(){k.value={name:"",applicationName:"",objective:"",position:"",isUrgent:!1,price:0},G.value=null,j.value=null,Y.value="",O.value=""}async function de(u=1){const l=`/checktemplate/page?scope=1&pn=${u}&count=10&keyword=${Y.value}`,o=await Ke(l);o.result&&(fe.value=o.data)}function _e(u){de(u)}function ie(){de(1)}async function be(u=1){const l=`/fmeditem/page?pn=${u}&count=10&keyword=${O.value}`,o=await Ke(l);o.result&&(Z.value=o.data)}function Ne(u){be(u)}function we(){be(1)}async function N(u){j.value=u,G.value=null,k.value.name=u.name,k.value.applicationName=u.name}function s(u){G.value=u,j.value=null,k.value.name=u.itemName,k.value.price=u.price}async function v(){if(!S.patient){i.error("\u8BF7\u5148\u9009\u62E9\u60A3\u8005");return}if(!J.value)try{const o=await et("/neudoc/medicalrecord/getByRegistId",{registId:S.patient.id});if(o.data.result&&o.data.data&&o.data.data.id)J.value=o.data.data.id;else{i.error("\u83B7\u53D6\u75C5\u5386\u4FE1\u606F\u5931\u8D25,\u8BF7\u5148\u521B\u5EFA\u75C5\u5386\u9996\u9875!");return}}catch{i.error("\u83B7\u53D6\u75C5\u5386\u4FE1\u606F\u65F6\u53D1\u751F\u7F51\u7EDC\u9519\u8BEF");return}let u=[];if(j.value){const o=`/checkrelation/items?templateId=${j.value.id}`,a=await Ke(o);a.result&&a.data.length>0&&(u=a.data.map(y=>({medicalId:J.value,registId:T.value,itemId:y.id,name:k.value.applicationName,itemName:y.itemName,objective:k.value.objective,position:k.value.position,isUrgent:k.value.isUrgent?1:0,num:1,doctorId:U.getUserInfo.value.id,recordType:1})))}else G.value&&u.push({medicalId:J.value,registId:T.value,itemId:G.value.id,name:k.value.applicationName,itemName:G.value.itemName,objective:k.value.objective,position:k.value.position,isUrgent:k.value.isUrgent?1:0,num:1,doctorId:U.getUserInfo.value.id,recordType:1});if(u.length===0){i.error("\u6CA1\u6709\u8981\u65B0\u589E\u7684\u9879\u76EE");return}const l=await pe("/checkapply/add",u);l.data.result?(i.success("\u65B0\u589E\u6210\u529F"),M.value=!1,B(T.value)):i.error(l.data.errMsg||"\u65B0\u589E\u5931\u8D25")}function r(u){X.value=u}async function h(u,l,o,a){if(X.value.length===0){i.warning(a||"\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u9879\u76EE");return}const y=X.value.map($=>$.id),A=await pe("/checkapply/updateState",{ids:y,state:u});A.data.result?(i.success(l),B(T.value)):i.error(A.data.errMsg||o)}function K(){h(2,"\u5F00\u7ACB\u6210\u529F","\u5F00\u7ACB\u5931\u8D25")}function me(){h(0,"\u4F5C\u5E9F\u6210\u529F","\u4F5C\u5E9F\u5931\u8D25")}async function le(){if(X.value.length===0){i.warning("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u9879\u76EE");return}const u=X.value.filter(l=>l.state===1||l.state===0);if(u.length!==X.value.length){i.error("\u53EA\u80FD\u5220\u9664\u6682\u5B58\u6216\u4F5C\u5E9F\u72B6\u6001\u7684\u9879\u76EE");return}qe.confirm("\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684\u9879\u76EE\u5417?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{const l=u.map(a=>a.id),o=await pe("/checkapply/del",l);o.data.result?(i.success("\u5220\u9664\u6210\u529F"),B(T.value)):i.error(o.data.errMsg||"\u5220\u9664\u5931\u8D25")}).catch(()=>{})}function Te(){T.value?(B(T.value),i.success("\u5237\u65B0\u6210\u529F")):i.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u4F4D\u60A3\u8005")}const De=u=>({1:"\u6682\u5B58",2:"\u5DF2\u5F00\u7ACB",3:"\u5DF2\u4EA4\u8D39",4:"\u5DF2\u767B\u8BB0",5:"\u6267\u884C\u5B8C",6:"\u5DF2\u9000\u8D39",0:"\u5DF2\u4F5C\u5E9F"})[u]||"\u672A\u77E5";function Oe(u){b.value={resultDesc:u.resultDesc,resultImages:u.resultImages?u.resultImages.split(","):[]},w.value=!0}async function Ee(){const u=`/checktemplate/page?recordType=1&doctorId=${U.getUserInfo.value.id}`,l=await Ke(u);l.result&&(P.value=l.data.records)}async function Be(u){if(!T.value){i.error("\u8BF7\u5148\u9009\u62E9\u4E00\u4F4D\u60A3\u8005");return}const l=await Ke(`/checkrelation/items?templateId=${u.id}`);if(!l.result||l.data.length===0){i.error("\u6A21\u677F\u5185\u5BB9\u4E3A\u7A7A");return}const o=l.data.map(y=>({medicalId:J.value,registId:T.value,itemId:y.id,name:u.name,itemName:y.itemName,price:y.price,objective:"",position:"",isUrgent:0,num:1,state:1,recordType:1,doctorId:U.getUserInfo.value.id})),a=await pe("/checkapply/add",o);a.data.result?(i.success(`\u5DF2\u5E94\u7528\u6A21\u677F\u3010${u.name}\u3011`),B(T.value)):i.error(a.data.errMsg||"\u5E94\u7528\u6A21\u677F\u5931\u8D25")}async function Fe(u){E.value=u.name;const l=await Ke(`/checkrelation/items?templateId=${u.id}`);l.result?(C.value=l.data,F.value=!0):i.error("\u83B7\u53D6\u6A21\u677F\u8BE6\u60C5\u5931\u8D25")}function c(){if(X.value.length===0){i.warning("\u8BF7\u9009\u62E9\u8981\u5B58\u4E3A\u6A21\u677F\u7684\u9879\u76EE");return}qe.prompt("\u8BF7\u8F93\u5165\u6A21\u677F\u540D\u79F0","\u5B58\u4E3A\u7EC4\u5957",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",inputValidator:u=>u?!0:"\u6A21\u677F\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}).then(async({value:u})=>{const l=X.value.map(y=>y.itemId),o={name:u,scope:"3",recordType:1,itemIds:l,doctorId:U.getUserInfo.value.id,deptId:U.getUserInfo.value.deptID},a=await pe("/checktemplate/add",o);a.data.result?(i.success("\u6A21\u677F\u4FDD\u5B58\u6210\u529F"),Ee()):i.error(a.data.errMsg||"\u6A21\u677F\u4FDD\u5B58\u5931\u8D25")}).catch(()=>{i.info("\u64CD\u4F5C\u5DF2\u53D6\u6D88")})}async function D(u){try{await qe.confirm(`\u786E\u5B9A\u8981\u5220\u9664\u6A21\u677F\u3010${u.name}\u3011\u5417\uFF1F`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"});const l=await pe("/checktemplate/del",u);l.data.result?(i.success("\u5220\u9664\u6210\u529F"),Ee()):i.error(l.data.errMsg||"\u5220\u9664\u5931\u8D25")}catch(l){l!=="cancel"?i.error("\u64CD\u4F5C\u5931\u8D25"):i.info("\u5DF2\u53D6\u6D88\u5220\u9664")}}return ne({clearList:se}),(u,l)=>{const o=d("el-button"),a=d("el-tag"),y=d("el-table-column"),A=d("el-table"),$=d("el-pagination"),f=d("el-col"),n=d("el-card"),p=d("el-row"),I=d("el-main"),Q=d("el-container"),ee=d("el-input"),ye=d("el-tab-pane"),ce=d("el-tabs"),xe=d("el-divider"),Ue=d("el-form-item"),We=d("el-switch"),ze=d("el-form"),Re=d("el-dialog"),Ie=d("el-descriptions-item"),je=d("el-descriptions"),He=d("el-image"),Qe=d("el-empty");return R(),ve(ot,null,[e(Q,null,{default:t(()=>[e(I,null,{default:t(()=>[e(p,null,{default:t(()=>[e(f,{span:14},{default:t(()=>[x("div",Ia,[e(o,{type:"primary",size:"small",onClick:ge,disabled:_.isDiagnosed},{default:t(()=>l[14]||(l[14]=[g("\u65B0\u589E\u9879\u76EE")])),_:1,__:[14]},8,["disabled"]),e(o,{type:"danger",size:"small",onClick:le,disabled:_.isDiagnosed},{default:t(()=>l[15]||(l[15]=[g("\u5220\u9664\u9879\u76EE")])),_:1,__:[15]},8,["disabled"]),e(o,{type:"success",size:"small",onClick:K,disabled:_.isDiagnosed},{default:t(()=>l[16]||(l[16]=[g("\u5F00\u7ACB\u9879\u76EE")])),_:1,__:[16]},8,["disabled"]),e(o,{type:"warning",size:"small",onClick:me,disabled:_.isDiagnosed},{default:t(()=>l[17]||(l[17]=[g("\u4F5C\u5E9F\u9879\u76EE")])),_:1,__:[17]},8,["disabled"]),e(o,{size:"small",onClick:c,disabled:_.isDiagnosed},{default:t(()=>l[18]||(l[18]=[g("\u5B58\u4E3A\u7EC4\u5957")])),_:1,__:[18]},8,["disabled"]),e(o,{icon:L(mt),size:"small",onClick:Te},{default:t(()=>l[19]||(l[19]=[g("\u5237\u65B0")])),_:1,__:[19]},8,["icon"])]),x("div",Va,[e(a,null,{default:t(()=>[g("\u672C\u9879\u76EE\u91D1\u989D\u5408\u8BA1\uFF1A"+he(oe.value)+"\u5143",1)]),_:1})]),e(A,{data:H.value,style:{width:"100%"},onSelectionChange:r,"row-style":{cursor:_.isDiagnosed?"default":"pointer"}},{default:t(()=>[e(y,{type:"selection",width:"30",align:"center",selectable:()=>!_.isDiagnosed},null,8,["selectable"]),e(y,{prop:"name",label:"\u7533\u8BF7\u540D\u79F0",width:"120",align:"center"}),e(y,{prop:"itemName",label:"\u9879\u76EE\u540D\u79F0",width:"180",align:"center"}),e(y,{prop:"deptName",label:"\u6267\u884C\u79D1\u5BA4",align:"center"}),e(y,{prop:"execState",label:"\u6267\u884C\u72B6\u6001",align:"center"}),e(y,{prop:"price",label:"\u5355\u4EF7",align:"center"}),e(y,{label:"\u68C0\u67E5\u7ED3\u679C",align:"center"},{default:t(W=>[W.row.resultDesc||W.row.resultImages?(R(),ue(o,{key:0,type:"primary",link:"",size:"small",onClick:V=>Oe(W.row)},{default:t(()=>l[20]||(l[20]=[g(" \u67E5\u770B ")])),_:2,__:[20]},1032,["onClick"])):(R(),ve("span",xa,"--"))]),_:1})]),_:1},8,["data","row-style"]),H.value.length>0?(R(),ue($,{key:0,background:"",layout:"prev, pager, next",total:z.value.total,"page-size":z.value.size,onCurrentChange:ae,style:{"margin-top":"10px"}},null,8,["total","page-size"])):ke("",!0)]),_:1}),e(f,{span:10},{default:t(()=>[x("div",Ta,[e(n,{class:"box-card"},{header:t(()=>l[21]||(l[21]=[x("div",{class:"clearfix"},[x("span",null,"\u5E38\u7528\u6A21\u677F")],-1)])),default:t(()=>[e(A,{data:P.value,style:{width:"100%"}},{default:t(()=>[e(y,{prop:"name",label:"\u540D\u79F0",align:"center"}),e(y,{label:"\u64CD\u4F5C",align:"center"},{default:t(W=>[x("div",Sa,[e(o,{type:"text",size:"small",onClick:V=>Be(W.row),disabled:_.isDiagnosed},{default:t(()=>l[22]||(l[22]=[g("\u4F7F\u7528")])),_:2,__:[22]},1032,["onClick","disabled"]),e(o,{type:"text",size:"small",onClick:V=>Fe(W.row),style:{"margin-left":"8px"}},{default:t(()=>l[23]||(l[23]=[g("\u8BE6\u7EC6")])),_:2,__:[23]},1032,["onClick"]),parseInt(W.row.scope)===3?(R(),ue(o,{key:0,type:"text",size:"small",onClick:V=>D(W.row),style:{"margin-left":"8px",color:"#F56C6C"},disabled:_.isDiagnosed},{default:t(()=>l[24]||(l[24]=[g("\u5220\u9664")])),_:2,__:[24]},1032,["onClick","disabled"])):ke("",!0)])]),_:1})]),_:1},8,["data"])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),e(Re,{title:"\u65B0\u589E\u68C0\u67E5\u9879\u76EE",modelValue:M.value,"onUpdate:modelValue":l[9]||(l[9]=W=>M.value=W),width:"60%"},{footer:t(()=>[x("span",Na,[e(o,{onClick:l[8]||(l[8]=W=>M.value=!1)},{default:t(()=>l[26]||(l[26]=[g("\u53D6\u6D88")])),_:1,__:[26]}),e(o,{type:"primary",onClick:v,disabled:!j.value&&!G.value||_.isDiagnosed},{default:t(()=>l[27]||(l[27]=[g("\u786E\u8BA4\u65B0\u589E")])),_:1,__:[27]},8,["disabled"])])]),default:t(()=>[e(ce,{modelValue:q.value,"onUpdate:modelValue":l[2]||(l[2]=W=>q.value=W),onTabClick:re},{default:t(()=>[e(ye,{label:"\u9009\u62E9\u6A21\u677F",name:"template"},{default:t(()=>[e(p,null,{default:t(()=>[e(f,{span:12},{default:t(()=>[e(ee,{modelValue:Y.value,"onUpdate:modelValue":l[0]||(l[0]=W=>Y.value=W),placeholder:"\u6309\u6A21\u677F\u540D\u79F0\u641C\u7D22",class:"input-with-select",disabled:_.isDiagnosed},{append:t(()=>[e(o,{icon:L(tt),onClick:ie},null,8,["icon"])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(A,{data:fe.value.records,style:{width:"100%","margin-top":"10px"},onRowClick:N,"highlight-current-row":""},{default:t(()=>[e(y,{prop:"name",label:"\u6A21\u677F\u540D\u79F0"})]),_:1},8,["data"]),e($,{background:"",layout:"prev, pager, next",total:fe.value.total,"page-size":fe.value.size,onCurrentChange:_e,style:{"margin-top":"10px"}},null,8,["total","page-size"])]),_:1}),e(ye,{label:"\u9009\u62E9\u9879\u76EE",name:"item"},{default:t(()=>[e(p,null,{default:t(()=>[e(f,{span:12},{default:t(()=>[e(ee,{modelValue:O.value,"onUpdate:modelValue":l[1]||(l[1]=W=>O.value=W),placeholder:"\u6309\u9879\u76EE\u52A9\u8BB0\u7801\u641C\u7D22",class:"input-with-select",disabled:_.isDiagnosed},{append:t(()=>[e(o,{icon:L(tt),onClick:we},null,8,["icon"])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),e(A,{data:Z.value.records,style:{width:"100%","margin-top":"10px"},onRowClick:s,"highlight-current-row":""},{default:t(()=>[e(y,{prop:"itemName",label:"\u9879\u76EE\u540D\u79F0"}),e(y,{prop:"price",label:"\u5355\u4EF7",width:"100"}),e(y,{prop:"deptName",label:"\u6267\u884C\u79D1\u5BA4",width:"150"})]),_:1},8,["data"]),e($,{background:"",layout:"prev, pager, next",total:Z.value.total,"page-size":Z.value.size,onCurrentChange:Ne,style:{"margin-top":"10px"}},null,8,["total","page-size"])]),_:1})]),_:1},8,["modelValue"]),e(xe),j.value||G.value?(R(),ve("div",$a,[l[25]||(l[25]=x("h3",null,"\u9879\u76EE\u8BE6\u60C5",-1)),e(ze,{model:k.value,"label-width":"120px"},{default:t(()=>[e(Ue,{label:"\u7533\u8BF7\u540D\u79F0"},{default:t(()=>[e(ee,{modelValue:k.value.applicationName,"onUpdate:modelValue":l[3]||(l[3]=W=>k.value.applicationName=W),disabled:_.isDiagnosed},null,8,["modelValue","disabled"])]),_:1}),e(Ue,{label:"\u9879\u76EE\u540D\u79F0"},{default:t(()=>[e(ee,{modelValue:k.value.name,"onUpdate:modelValue":l[4]||(l[4]=W=>k.value.name=W),disabled:""},null,8,["modelValue"])]),_:1}),e(Ue,{label:"\u76EE\u7684\u8981\u6C42"},{default:t(()=>[e(ee,{modelValue:k.value.objective,"onUpdate:modelValue":l[5]||(l[5]=W=>k.value.objective=W),type:"textarea",disabled:_.isDiagnosed},null,8,["modelValue","disabled"])]),_:1}),e(Ue,{label:"\u68C0\u67E5\u90E8\u4F4D"},{default:t(()=>[e(ee,{modelValue:k.value.position,"onUpdate:modelValue":l[6]||(l[6]=W=>k.value.position=W),disabled:_.isDiagnosed},null,8,["modelValue","disabled"])]),_:1}),e(Ue,{label:"\u662F\u5426\u52A0\u6025"},{default:t(()=>[e(We,{modelValue:k.value.isUrgent,"onUpdate:modelValue":l[7]||(l[7]=W=>k.value.isUrgent=W),disabled:_.isDiagnosed},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])])):ke("",!0)]),_:1},8,["modelValue"]),e(Re,{title:"\u5B58\u4E3A\u7EC4\u5957",modelValue:te.value,"onUpdate:modelValue":l[10]||(l[10]=W=>te.value=W)},null,8,["modelValue"]),e(Re,{title:"\u6A21\u677F\u8BE6\u60C5: "+E.value,modelValue:F.value,"onUpdate:modelValue":l[11]||(l[11]=W=>F.value=W),width:"50%"},{default:t(()=>[e(A,{data:C.value},{default:t(()=>[e(y,{property:"itemName",label:"\u9879\u76EE\u540D\u79F0"}),e(y,{property:"price",label:"\u4EF7\u683C"}),e(y,{property:"deptName",label:"\u6267\u884C\u79D1\u5BA4"})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),e(Re,{title:"\u68C0\u67E5\u7ED3\u679C\u8BE6\u60C5",modelValue:w.value,"onUpdate:modelValue":l[13]||(l[13]=W=>w.value=W),width:"50%"},{footer:t(()=>[x("span",Aa,[e(o,{type:"primary",onClick:l[12]||(l[12]=W=>w.value=!1)},{default:t(()=>l[29]||(l[29]=[g("\u786E \u5B9A")])),_:1,__:[29]})])]),default:t(()=>[b.value?(R(),ve("div",Ua,[e(je,{column:1,border:""},{default:t(()=>[e(Ie,{"label-class-name":"result-label",label:"\u7ED3\u679C\u63CF\u8FF0"},{default:t(()=>[g(he(b.value.resultDesc||"\u6682\u65E0\u63CF\u8FF0"),1)]),_:1})]),_:1}),e(xe,{"content-position":"left"},{default:t(()=>l[28]||(l[28]=[g("\u7ED3\u679C\u56FE\u7247")])),_:1,__:[28]}),b.value.resultImages&&b.value.resultImages.length>0?(R(),ve("div",Ra,[(R(!0),ve(ot,null,rt(b.value.resultImages,(W,V)=>(R(),ue(He,{key:V,class:"result-image-item",src:W,"preview-src-list":b.value.resultImages,"initial-index":V,fit:"cover",lazy:""},null,8,["src","preview-src-list","initial-index"]))),128))])):(R(),ue(Qe,{key:1,description:"\u6682\u65E0\u56FE\u7247"}))])):ke("",!0)]),_:1},8,["modelValue"])],64)}}};var za=dt(Ea,[["__scopeId","data-v-e7f81562"]]);const Fa={class:"container",style:{padding:"20px"}},Ma={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Oa={key:1},Ba={key:0},ja={key:0,class:"result-images-container"},Ha={class:"dialog-footer"},La={__name:"Doc03",props:{patient:{type:Object,default:null},isDiagnosed:{type:Boolean,default:!1}},setup(_){const ne=st(),S=_,U=m(!1),H=m(""),z=m([]),T=m({total:0,size:5,current:1}),J=m([]),X=m([]),P=m(null),F=m(!1),C=m([]),E=m([]),M=m(""),te=m([]),q=m(null),Y=m(!1),fe=m([]),j=m(!1),O=m(null),Z=Ge(()=>C.value.reduce((v,r)=>v+(r.price||0),0).toFixed(2));Xe(()=>S.patient,async(v,r)=>{if(v&&v.id&&(!r||v.id!==r.id))try{const h=await Ve("/neudoc/medicalrecord/getByRegistId",{registId:v.id});if(h.data&&h.data.data&&h.data.data.id)q.value=h.data.data.id;else{const K={registId:v.id,caseNumber:v.caseNumber},me=await pe("/neudoc/medicalrecord/save",K);if(me.data&&me.data.data&&me.data.data.id)q.value=me.data.data.id;else{i.error("\u521B\u5EFA\u65B0\u75C5\u5386\u5931\u8D25\uFF0C\u65E0\u6CD5\u7EE7\u7EED\u64CD\u4F5C");return}}G(v.id),k()}catch(h){console.error("\u83B7\u53D6\u6216\u521B\u5EFA\u75C5\u5386\u5931\u8D25",h),i.error("\u51C6\u5907\u60A3\u8005\u75C5\u5386\u4FE1\u606F\u65F6\u51FA\u9519\uFF0C\u8BF7\u91CD\u8BD5")}else v||(C.value=[],M.value="",q.value=null,te.value=[],E.value=[])},{immediate:!0,deep:!0});async function G(v){const r=`/checkapply/page?registId=${v}&recordType=2&count=100`;try{const h=await Ve(r);C.value=h.data.data.records.map(K=>({...K})),C.value.length>0?(C.value[0].objective&&(M.value=C.value[0].objective),C.value[0].medicalId&&(q.value=C.value[0].medicalId)):M.value=""}catch(h){console.error("\u52A0\u8F7D\u68C0\u9A8C\u7533\u8BF7\u5931\u8D25:",h),C.value=[],M.value="",q.value=null}}async function k(){const v=`/checktemplate/page?recordType=2&doctorId=${ne.userInfo.id}&count=100`;try{const r=await Ve(v);te.value=r.data.data.records}catch(r){console.error("\u52A0\u8F7D\u68C0\u9A8C\u6A21\u677F\u5931\u8D25:",r)}}async function w(){const v="/department/tech";try{const r=await Ve(v);X.value=r.data.data}catch(r){console.error("\u52A0\u8F7D\u6267\u884C\u79D1\u5BA4\u5931\u8D25:",r)}}async function b(v=1){const r=`/fmeditem/page?expClassId=73&pn=${v}&count=${T.value.size}&keyword=${H.value}`;try{const h=await Ve(r);z.value=h.data.data.records,T.value.total=h.data.data.total,T.value.current=h.data.data.current}catch(h){console.error("\u52A0\u8F7D\u68C0\u9A8C\u9879\u76EE\u5931\u8D25:",h)}}function oe(v){b(v)}function B(){if(!S.patient){i.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u4F4D\u60A3\u8005");return}U.value=!0,H.value="",z.value=[],F.value=!1,P.value=null,w(),b(1)}function ae(v){J.value=v}function se(v){E.value=v}async function ge(){if(J.value.length===0){i.warning("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u68C0\u9A8C\u9879\u76EE");return}if(!P.value){i.warning("\u8BF7\u9009\u62E9\u6267\u884C\u79D1\u5BA4");return}const v=X.value.find(h=>h.id===P.value),r=J.value.map(h=>({registId:S.patient.id,itemId:h.id,itemName:h.itemName,price:h.price,deptId:P.value,deptName:v.deptName,isUrgent:F.value?1:0,state:1,medicalId:q.value,objective:M.value,recordType:2,doctorId:ne.userInfo.id}));try{const h=await pe("/checkapply/saveOrUpdateBatch",r);h.data.result?(i.success("\u9879\u76EE\u5DF2\u6DFB\u52A0\u5E76\u6682\u5B58"),U.value=!1,await G(S.patient.id)):i.error(h.data.errMsg||"\u6DFB\u52A0\u5931\u8D25")}catch{i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u6DFB\u52A0\u5931\u8D25")}}async function re(){if(E.value.length===0){i.warning("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u9879\u76EE");return}const v=E.value.filter(r=>r.id).map(r=>r.id);if(E.value.filter(r=>!r.id),v.length>0)try{const r=await pe("/checkapply/del",v);if(!r.data.result){i.error(r.data.errMsg||"\u5220\u9664\u5931\u8D25");return}}catch{i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u5220\u9664\u5931\u8D25");return}C.value=C.value.filter(r=>!E.value.some(h=>h===r)),i.success("\u5220\u9664\u6210\u529F"),E.value=[]}async function Ce(){if(!S.patient||C.value.length===0)return;const v=C.value.map(r=>({...r,medicalId:q.value,registId:S.patient.id,objective:M.value,recordType:2,doctorId:ne.userInfo.id}));try{await pe("/checkapply/saveOrUpdateBatch",v)}catch(r){throw console.error("Failed to save changes",r),i.error("\u81EA\u52A8\u4FDD\u5B58\u76EE\u7684\u8981\u6C42\u5931\u8D25"),new Error("SaveChangesFailed")}}async function de(){if(E.value.length===0){i.warning("\u8BF7\u9009\u62E9\u8981\u5F00\u7ACB\u7684\u9879\u76EE");return}try{await Ce()}catch{return}const v=E.value.filter(h=>h.id&&h.state===1).map(h=>h.id);if(E.value.some(h=>!h.id)&&i.warning('\u6709\u65B0\u9879\u76EE\u5C1A\u672A\u6682\u5B58\uFF0C\u8BF7\u5148\u70B9\u51FB"\u6682\u5B58"\u6309\u94AE\u3002'),v.length!=E.value.length){i.warning("\u8BF7\u4EC5\u9009\u62E9\u6682\u5B58\u72B6\u6001\u7684\u9879\u76EE\u8FDB\u884C\u5F00\u7ACB\u3002");return}if(v.length===0)return;const r={ids:v,state:2};try{const h=await pe("/checkapply/updateState",r);h.data.result?(i.success("\u5F00\u7ACB\u6210\u529F"),await G(S.patient.id),E.value=[]):i.error(h.data.errMsg||"\u5F00\u7ACB\u5931\u8D25")}catch{i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u5F00\u7ACB\u5931\u8D25")}}async function _e(){if(E.value.length===0){i.warning("\u8BF7\u9009\u62E9\u8981\u4F5C\u5E9F\u7684\u9879\u76EE");return}const v=E.value.filter(h=>h.id).map(h=>h.id);if(E.value.some(h=>!h.id)&&i.warning("\u65B0\u9879\u76EE\u65E0\u6CD5\u88AB\u4F5C\u5E9F\uFF0C\u8BF7\u5148\u6682\u5B58\u6216\u5220\u9664\u3002"),v.length===0)return;const r={ids:v,state:0};try{const h=await pe("/checkapply/updateState",r);h.data.result?(i.success("\u4F5C\u5E9F\u6210\u529F"),await G(S.patient.id),E.value=[]):i.error(h.data.errMsg||"\u4F5C\u5E9F\u5931\u8D25")}catch{i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u4F5C\u5E9F\u5931\u8D25")}}async function ie(v){if(!S.patient){i.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u4F4D\u60A3\u8005");return}try{const h=(await Ve(`/checktemplate/getById?id=${v.id}`)).data.data.items,K=new Map(X.value.map(le=>[le.id,le.deptName])),me=h.map(le=>({registId:S.patient.id,itemId:le.id,itemName:le.itemName,price:le.price,deptId:le.deptId,deptName:K.get(le.deptId)||"\u672A\u77E5\u79D1\u5BA4",isUrgent:0,state:1,medicalId:q.value,objective:M.value,recordType:2,doctorId:ne.userInfo.id}));await pe("/checkapply/saveOrUpdateBatch",me),i.success(`\u5DF2\u5E94\u7528\u5957\u7EC4: ${v.name}`),await G(S.patient.id)}catch(r){i.error("\u5E94\u7528\u5957\u7EC4\u5931\u8D25"),console.error(r)}}async function be(v){try{const r=await Ve(`/checkrelation/items?templateId=${v.id}`);r.data.result&&r.data.data?(fe.value=r.data.data,Y.value=!0):i.error("\u83B7\u53D6\u5957\u7EC4\u8BE6\u60C5\u5931\u8D25")}catch(r){console.error("\u83B7\u53D6\u5957\u7EC4\u8BE6\u60C5\u5931\u8D25:",r),i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u83B7\u53D6\u5957\u7EC4\u8BE6\u60C5\u5931\u8D25")}}async function Ne(v){qe.confirm(`\u786E\u5B9A\u8981\u5220\u9664\u5957\u7EC4 " ${v.name} " \u5417\uFF1F`,"\u786E\u8BA4\u5220\u9664",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{try{const r=await pe("/checktemplate/del",v);r.data.result?(i.success("\u5220\u9664\u6210\u529F"),k()):i.error(r.data.errMsg||"\u5220\u9664\u5931\u8D25")}catch{i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u5220\u9664\u5931\u8D25")}}).catch(()=>{})}async function we(){if(C.value.length===0){i.warning("\u6CA1\u6709\u53EF\u5B58\u4E3A\u5957\u7EC4\u7684\u9879\u76EE");return}await Ce(),qe.prompt("\u8BF7\u8F93\u5165\u5957\u7EC4\u540D\u79F0","\u5B58\u4E3A\u5957\u7EC4",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",inputPattern:/\S+/,inputErrorMessage:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}).then(async({value:v})=>{const r=C.value.map(K=>K.itemId),h={name:v,doctorId:ne.userInfo.id,scope:"personal",recordType:2,itemIds:r};try{const K=await pe("/checktemplate/add",h);K.data.result?(i.success("\u5957\u7EC4\u4FDD\u5B58\u6210\u529F"),k()):i.error(K.data.errMsg||"\u4FDD\u5B58\u5931\u8D25")}catch{i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u4FDD\u5B58\u5931\u8D25")}}).catch(()=>{})}const N=v=>{v.resultImages&&typeof v.resultImages=="string"?v.resultImages=v.resultImages.split(",").map(r=>r.trim()).filter(r=>r):v.resultImages||(v.resultImages=[]),O.value=v,j.value=!0},s=v=>({0:"\u5DF2\u4F5C\u5E9F",1:"\u6682\u5B58",2:"\u5DF2\u5F00\u7ACB",3:"\u5DF2\u4EA4\u8D39",4:"\u5DF2\u767B\u8BB0",5:"\u5DF2\u6267\u884C",6:"\u5DF2\u5B8C\u6210"})[v]||"\u672A\u77E5\u72B6\u6001";return(v,r)=>{const h=d("el-button"),K=d("el-input"),me=d("el-form-item"),le=d("el-table-column"),Te=d("el-table"),De=d("el-pagination"),Oe=d("el-option"),Ee=d("el-select"),Be=d("el-switch"),Fe=d("el-form"),c=d("el-dialog"),D=d("el-tag"),u=d("el-space"),l=d("el-empty"),o=d("el-card"),a=d("el-col"),y=d("el-row"),A=d("el-descriptions-item"),$=d("el-descriptions"),f=d("el-divider"),n=d("el-image");return R(),ve("div",Fa,[e(c,{title:"\u65B0\u589E\u68C0\u9A8C\u7533\u8BF7",modelValue:U.value,"onUpdate:modelValue":r[5]||(r[5]=p=>U.value=p),width:"40%"},{default:t(()=>[e(Fe,{size:"mini"},{default:t(()=>[e(me,null,{default:t(()=>[e(K,{modelValue:H.value,"onUpdate:modelValue":r[1]||(r[1]=p=>H.value=p),placeholder:"\u6309\u7F16\u7801/\u540D\u79F0/\u62FC\u97F3\u641C\u7D22...",class:"input-with-select",style:{width:"100%"}},{prepend:t(()=>r[11]||(r[11]=[g("\u68C0\u9A8C\u540D\u79F0\uFF1A")])),append:t(()=>[e(h,{icon:L(tt),onClick:r[0]||(r[0]=p=>b(1))},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(me,null,{default:t(()=>[e(Te,{border:"",data:z.value,size:"mini","max-height":"250px",onSelectionChange:ae},{default:t(()=>[e(le,{type:"selection",width:"55"}),e(le,{property:"itemCode",label:"\u7F16\u7801",width:"120"}),e(le,{property:"itemName",label:"\u9879\u76EE\u540D\u79F0"}),e(le,{property:"price",label:"\u5355\u4EF7",width:"80"})]),_:1},8,["data"])]),_:1}),e(me,null,{default:t(()=>[T.value.total>0?(R(),ue(De,{key:0,small:"",background:"",layout:"prev, pager, next",total:T.value.total,"page-size":T.value.size,"current-page":T.value.current,onCurrentChange:oe,style:{"margin-top":"10px","text-align":"center"}},null,8,["total","page-size","current-page"])):ke("",!0)]),_:1}),e(me,{label:"\u6267\u884C\u79D1\u5BA4"},{default:t(()=>[e(Ee,{placeholder:"\u8BF7\u9009\u62E9",modelValue:P.value,"onUpdate:modelValue":r[2]||(r[2]=p=>P.value=p)},{default:t(()=>[(R(!0),ve(ot,null,rt(X.value,p=>(R(),ue(Oe,{key:p.id,label:p.deptName,value:p.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(me,{label:"\u662F\u5426\u52A0\u6025\uFF1A"},{default:t(()=>[e(Be,{modelValue:F.value,"onUpdate:modelValue":r[3]||(r[3]=p=>F.value=p),"active-color":"#13ce66"},null,8,["modelValue"])]),_:1}),e(me,null,{default:t(()=>[e(h,{type:"primary",onClick:ge},{default:t(()=>r[12]||(r[12]=[g("\u786E \u5B9A")])),_:1,__:[12]}),e(h,{onClick:r[4]||(r[4]=p=>U.value=!1)},{default:t(()=>r[13]||(r[13]=[g("\u53D6 \u6D88")])),_:1,__:[13]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(y,{gutter:20},{default:t(()=>[e(a,{span:16},{default:t(()=>[e(u,{direction:"vertical",alignment:"stretch",style:{width:"100%"}},{default:t(()=>[e(o,{shadow:"never"},{header:t(()=>[x("div",Ma,[e(u,null,{default:t(()=>[e(D,null,{default:t(()=>r[14]||(r[14]=[g("\u672C\u9879\u76EE\u91D1\u989D\u5408\u8BA1:")])),_:1,__:[14]}),e(D,{type:"warning"},{default:t(()=>[g(he(Z.value)+"\u5143",1)]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(h,{type:"primary",icon:L(gt),onClick:B,disabled:_.isDiagnosed},{default:t(()=>r[15]||(r[15]=[g("\u65B0\u589E\u9879\u76EE")])),_:1,__:[15]},8,["icon","disabled"]),e(h,{type:"danger",icon:L(nt),onClick:re,disabled:_.isDiagnosed},{default:t(()=>r[16]||(r[16]=[g("\u5220\u9664\u9879\u76EE")])),_:1,__:[16]},8,["icon","disabled"]),e(h,{type:"success",icon:L(yt),onClick:de,disabled:_.isDiagnosed},{default:t(()=>r[17]||(r[17]=[g("\u5F00\u7ACB")])),_:1,__:[17]},8,["icon","disabled"]),e(h,{icon:L(_t),onClick:_e,disabled:_.isDiagnosed},{default:t(()=>r[18]||(r[18]=[g("\u4F5C\u5E9F")])),_:1,__:[18]},8,["icon","disabled"]),e(h,{icon:L(St),onClick:we,disabled:_.isDiagnosed},{default:t(()=>r[19]||(r[19]=[g("\u5B58\u4E3A\u5957\u7EC4")])),_:1,__:[19]},8,["icon","disabled"])]),_:1})])]),default:t(()=>[e(Te,{data:C.value,style:{width:"100%"},onSelectionChange:se,"row-style":{cursor:_.isDiagnosed?"default":"pointer"}},{empty:t(()=>[e(l,{description:"\u6682\u65E0\u68C0\u9A8C\u9879\u76EE"})]),default:t(()=>[e(le,{type:"selection",selectable:()=>!_.isDiagnosed},null,8,["selectable"]),e(le,{prop:"itemName",label:"\u9879\u76EE\u540D\u79F0",width:"180",align:"center"}),e(le,{prop:"deptName",label:"\u6267\u884C\u79D1\u5BA4",align:"center"}),e(le,{prop:"state",label:"\u6267\u884C\u72B6\u6001",align:"center"},{default:t(p=>[g(he(s(p.row.state)),1)]),_:1}),e(le,{prop:"price",label:"\u5355\u4EF7",align:"center"}),e(le,{label:"\u68C0\u9A8C\u7ED3\u679C",align:"center"},{default:t(p=>[p.row.resultDesc||p.row.resultImages?(R(),ue(h,{key:0,type:"primary",link:"",size:"small",onClick:I=>N(p.row)},{default:t(()=>r[20]||(r[20]=[g(" \u67E5\u770B ")])),_:2,__:[20]},1032,["onClick"])):(R(),ve("span",Oa,"--"))]),_:1})]),_:1},8,["data","row-style"])]),_:1}),e(o,{shadow:"never"},{header:t(()=>r[21]||(r[21]=[x("span",null,"\u76EE\u7684\u8981\u6C42",-1)])),default:t(()=>[e(K,{type:"textarea",modelValue:M.value,"onUpdate:modelValue":r[6]||(r[6]=p=>M.value=p),rows:4,placeholder:"\u3010\u68C0\u9A8C\u76EE\u7684\uFF1A\u3011\u3010\u60A3\u8005\u4E3B\u8BC9\uFF1A\u3011\u3010\u73B0\u75C5\u53F2\uFF1A\u3011",resize:"none",disabled:_.isDiagnosed},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(a,{span:8},{default:t(()=>[e(o,{shadow:"never"},{header:t(()=>r[22]||(r[22]=[x("span",null,"\u68C0\u9A8C\u5957\u7EC4",-1)])),default:t(()=>[e(Te,{data:te.value,style:{width:"100%"}},{empty:t(()=>[e(l,{description:"\u6682\u65E0\u68C0\u9A8C\u5957\u7EC4"})]),default:t(()=>[e(le,{prop:"name",label:"\u540D\u79F0"}),e(le,{fixed:"right",label:"\u64CD\u4F5C",width:"180",align:"center"},{default:t(p=>[e(u,null,{default:t(()=>[e(h,{onClick:lt(I=>ie(p.row),["prevent"]),type:"primary",text:"",size:"small",disabled:_.isDiagnosed},{default:t(()=>r[23]||(r[23]=[g("\u4F7F\u7528")])),_:2,__:[23]},1032,["onClick","disabled"]),e(h,{onClick:lt(I=>be(p.row),["prevent"]),type:"info",text:"",size:"small"},{default:t(()=>r[24]||(r[24]=[g("\u8BE6\u7EC6")])),_:2,__:[24]},1032,["onClick"]),e(h,{onClick:lt(I=>Ne(p.row),["prevent"]),type:"danger",text:"",size:"small",disabled:_.isDiagnosed},{default:t(()=>r[25]||(r[25]=[g("\u5220\u9664")])),_:2,__:[25]},1032,["onClick","disabled"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),e(c,{title:"\u5957\u7EC4\u8BE6\u60C5",modelValue:Y.value,"onUpdate:modelValue":r[8]||(r[8]=p=>Y.value=p),width:"30%"},{footer:t(()=>[e(h,{onClick:r[7]||(r[7]=p=>Y.value=!1)},{default:t(()=>r[26]||(r[26]=[g("\u5173 \u95ED")])),_:1,__:[26]})]),default:t(()=>[e(Te,{data:fe.value,border:"",size:"mini"},{default:t(()=>[e(le,{property:"itemName",label:"\u9879\u76EE\u540D\u79F0"}),e(le,{property:"price",label:"\u5355\u4EF7"})]),_:1},8,["data"])]),_:1},8,["modelValue"]),e(c,{title:"\u68C0\u9A8C\u7ED3\u679C\u8BE6\u60C5",modelValue:j.value,"onUpdate:modelValue":r[10]||(r[10]=p=>j.value=p),width:"50%"},{footer:t(()=>[x("span",Ha,[e(h,{type:"primary",onClick:r[9]||(r[9]=p=>j.value=!1)},{default:t(()=>r[28]||(r[28]=[g("\u786E \u5B9A")])),_:1,__:[28]})])]),default:t(()=>[O.value?(R(),ve("div",Ba,[e($,{column:1,border:""},{default:t(()=>[e(A,{"label-class-name":"result-label",label:"\u7ED3\u679C\u63CF\u8FF0"},{default:t(()=>[g(he(O.value.resultDesc||"\u6682\u65E0\u63CF\u8FF0"),1)]),_:1})]),_:1}),e(f,{"content-position":"left"},{default:t(()=>r[27]||(r[27]=[g("\u7ED3\u679C\u56FE\u7247")])),_:1,__:[27]}),O.value.resultImages&&O.value.resultImages.length>0?(R(),ve("div",ja,[(R(!0),ve(ot,null,rt(O.value.resultImages,(p,I)=>(R(),ue(n,{key:I,class:"result-image-item",src:p,"preview-src-list":O.value.resultImages,"initial-index":I,fit:"cover",lazy:""},null,8,["src","preview-src-list","initial-index"]))),128))])):(R(),ue(l,{key:1,description:"\u6682\u65E0\u56FE\u7247"}))])):ke("",!0)]),_:1},8,["modelValue"])])}}};var Pa=dt(La,[["__scopeId","data-v-5db1b234"]]);const qa={class:"card-header"},Wa={key:0},Xa={key:1},Ka={class:"action-bar",style:{"margin-bottom":"10px"}},Ja={__name:"Doc04",props:{patient:{type:Object,required:!0},isDiagnosed:{type:Boolean,default:!1}},setup(_){const ne=_,S=m({}),U=m([]),H=m([]),z=async()=>{if(!ne.patient.id)return;const k=await et("/neudoc/medicalrecord/getByRegistId",{registId:ne.patient.id});if(k.data&&k.data.data)if(S.value=k.data.data,k.data.data.medicalDiseases)U.value=k.data.data.medicalDiseases;else if(S.value.id){const w=await et("/neudoc/medicaldisease/list",{medicalId:S.value.id,diagnoseType:2});U.value=w.data.data||[]}else U.value=[];else S.value={registId:ne.patient.id,diagnosis:"",handling:""},U.value=[]};Xe(()=>ne.patient,k=>{k&&k.id?z():(S.value={},U.value=[])},{immediate:!0,deep:!0});const T=k=>{H.value=k},J=async()=>{if(H.value.length===0){i.warning("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u9879\u8FDB\u884C\u5220\u9664");return}await qe.confirm("\u786E\u5B9A\u8981\u5220\u9664\u9009\u4E2D\u7684\u8BCA\u65AD\u5417?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"});const k=H.value.filter(b=>b.id).map(b=>b.id);if(k.length>0)try{for(const b of k)await qt(`/neudoc/medicaldisease/del/${b}`)}catch{i.error("\u5220\u9664\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5");return}const w=new Set(H.value.map(b=>b.diseaseId));U.value=U.value.filter(b=>!w.has(b.diseaseId)),i.success("\u5220\u9664\u6210\u529F")},X=m(!1),P=m(""),F=m([]),C=m(0),E=m(1),M=m(10),te=m(null),q=m([]),Y=()=>{X.value=!0,P.value="",E.value=1,fe()},fe=async()=>{const k={pn:E.value,count:M.value,keyword:P.value},w=await et("/disease/page",k);w.data&&w.data.data?(F.value=w.data.data.records,C.value=w.data.data.total):(F.value=[],C.value=0)},j=k=>{E.value=k,fe()},O=k=>{q.value=k},Z=()=>{const k=new Set(U.value.map(w=>w.diseaseId));q.value.forEach(w=>{k.has(w.id)||(U.value.push({disease:w,diseaseId:w.id,siskDate:Ot().format("YYYY-MM-DD HH:mm:ss"),diagnoseCate:2,diagnoseType:2}),k.add(w.id))}),X.value=!1,i.success(`\u5DF2\u6DFB\u52A0 ${q.value.length} \u9879\u8BCA\u65AD`)},G=async()=>{if(!S.value.id){i.error("\u65E0\u6CD5\u83B7\u53D6\u75C5\u5386ID\uFF0C\u65E0\u6CD5\u4FDD\u5B58");return}const k={...S.value,medicalDiseases:U.value};try{const w=await Wt("/neudoc/medicalrecord/save",k);w.data&&w.data.result?(i.success("\u786E\u8BCA\u4FE1\u606F\u4FDD\u5B58\u6210\u529F"),await z()):i.error(w.data.errMsg||"\u4FDD\u5B58\u5931\u8D25")}catch(w){console.error("\u4FDD\u5B58\u5931\u8D25:",w),i.error("\u4FDD\u5B58\u8FC7\u7A0B\u4E2D\u53D1\u751F\u7F51\u7EDC\u6216\u670D\u52A1\u5668\u9519\u8BEF")}};return(k,w)=>{const b=d("el-button"),oe=d("el-empty"),B=d("el-input"),ae=d("el-form-item"),se=d("el-col"),ge=d("el-row"),re=d("el-divider"),Ce=d("el-form"),de=d("el-table-column"),_e=d("el-date-picker"),ie=d("el-option"),be=d("el-select"),Ne=d("el-pagination"),we=d("el-dialog"),N=d("el-card");return R(),ue(N,{class:"box-card"},{header:t(()=>[x("div",qa,[w[10]||(w[10]=x("span",null,"\u95E8\u8BCA\u786E\u8BCA",-1)),e(b,{type:"primary",disabled:!_.patient||!_.patient.id||_.isDiagnosed,onClick:G,icon:L(Vt)},{default:t(()=>w[9]||(w[9]=[g("\u786E\u8BCA\u4FDD\u5B58")])),_:1,__:[9]},8,["disabled","icon"])])]),default:t(()=>[!_.patient||!_.patient.id?(R(),ve("div",Wa,[e(oe,{description:"\u8BF7\u5148\u5728\u5DE6\u4FA7\u9009\u62E9\u4E00\u4F4D\u60A3\u8005"})])):(R(),ve("div",Xa,[e(Ce,{model:S.value,"label-width":"100px"},{default:t(()=>[e(ge,{gutter:20},{default:t(()=>[e(se,{span:8},{default:t(()=>[e(ae,{label:"\u75C5\u5386\u53F7"},{default:t(()=>[e(B,{modelValue:_.patient.caseNumber,"onUpdate:modelValue":w[0]||(w[0]=s=>_.patient.caseNumber=s),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(se,{span:8},{default:t(()=>[e(ae,{label:"\u60A3\u8005\u59D3\u540D"},{default:t(()=>[e(B,{modelValue:_.patient.realName,"onUpdate:modelValue":w[1]||(w[1]=s=>_.patient.realName=s),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(se,{span:8},{default:t(()=>[e(ae,{label:"\u5E74\u9F84"},{default:t(()=>[e(B,{modelValue:_.patient.age,"onUpdate:modelValue":w[2]||(w[2]=s=>_.patient.age=s),disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(re,{"content-position":"left"},{default:t(()=>w[11]||(w[11]=[g("\u75C5\u5386\u4FE1\u606F")])),_:1,__:[11]}),e(ae,{label:"\u521D\u6B65\u8BCA\u65AD"},{default:t(()=>[e(B,{modelValue:S.value.diagnosis,"onUpdate:modelValue":w[3]||(w[3]=s=>S.value.diagnosis=s),type:"textarea",rows:3,placeholder:"\u533B\u751F\u6839\u636E\u60A3\u8005\u60C5\u51B5\uFF0C\u5F97\u51FA\u7684\u521D\u6B65\u8BCA\u65AD\u7ED3\u679C",disabled:_.isDiagnosed},null,8,["modelValue","disabled"])]),_:1}),e(ae,{label:"\u5904\u7406\u610F\u89C1"},{default:t(()=>[e(B,{modelValue:S.value.handling,"onUpdate:modelValue":w[4]||(w[4]=s=>S.value.handling=s),type:"textarea",rows:3,placeholder:"\u533B\u751F\u5BF9\u75C5\u60C5\u7684\u5904\u7406\u610F\u89C1",disabled:_.isDiagnosed},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"]),e(re,{"content-position":"left"},{default:t(()=>w[12]||(w[12]=[g("\u6700\u7EC8\u8BCA\u65AD")])),_:1,__:[12]}),x("div",Ka,[e(b,{type:"primary",onClick:Y,icon:L(gt),disabled:_.isDiagnosed},{default:t(()=>w[13]||(w[13]=[g("\u6DFB\u52A0\u8BCA\u65AD")])),_:1,__:[13]},8,["icon","disabled"]),e(b,{type:"danger",onClick:J,icon:L(nt),disabled:_.isDiagnosed},{default:t(()=>w[14]||(w[14]=[g("\u5220\u9664\u8BCA\u65AD")])),_:1,__:[14]},8,["icon","disabled"])]),e(L(wt),{data:U.value,onSelectionChange:T,border:"","row-style":{cursor:_.isDiagnosed?"default":"pointer"}},{default:t(()=>[e(de,{type:"selection",width:"55",align:"center",selectable:()=>!_.isDiagnosed},null,8,["selectable"]),e(de,{prop:"disease.diseaseCode",label:"\u75BE\u75C5\u7F16\u7801",width:"120"}),e(de,{prop:"disease.diseaseName",label:"\u75BE\u75C5\u540D\u79F0"}),e(de,{label:"\u53D1\u75C5\u65E5\u671F",width:"220"},{default:t(s=>[e(_e,{modelValue:s.row.siskDate,"onUpdate:modelValue":v=>s.row.siskDate=v,type:"datetime",placeholder:"\u9009\u62E9\u53D1\u75C5\u65E5\u671F","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"},disabled:_.isDiagnosed},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),e(de,{label:"\u8BCA\u65AD\u72B6\u6001",width:"120"},{default:t(s=>[e(be,{modelValue:s.row.diagnoseCate,"onUpdate:modelValue":v=>s.row.diagnoseCate=v,placeholder:"\u8BF7\u9009\u62E9",disabled:_.isDiagnosed},{default:t(()=>[e(ie,{label:"\u7591\u8BCA",value:1}),e(ie,{label:"\u786E\u8BCA",value:2})]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),_:1})]),_:1},8,["data","row-style"])])),e(we,{title:"\u6DFB\u52A0\u8BCA\u65AD",modelValue:X.value,"onUpdate:modelValue":w[8]||(w[8]=s=>X.value=s),width:"60%"},{footer:t(()=>[e(b,{onClick:w[7]||(w[7]=s=>X.value=!1)},{default:t(()=>w[15]||(w[15]=[g("\u53D6\u6D88")])),_:1,__:[15]}),e(b,{type:"primary",onClick:Z},{default:t(()=>w[16]||(w[16]=[g("\u786E\u8BA4\u6DFB\u52A0")])),_:1,__:[16]})]),default:t(()=>[e(B,{modelValue:P.value,"onUpdate:modelValue":w[6]||(w[6]=s=>P.value=s),placeholder:"\u6309\u75BE\u75C5\u540D\u79F0\u6216\u7F16\u7801\u641C\u7D22",onKeyup:xt(fe,["enter"])},{append:t(()=>[e(b,{icon:L(tt),onClick:w[5]||(w[5]=()=>{E.value=1,fe()})},null,8,["icon"])]),_:1},8,["modelValue"]),e(L(wt),{ref_key:"diseaseTableRef",ref:te,data:F.value,onSelectionChange:O,height:"300px",style:{"margin-top":"15px"}},{default:t(()=>[e(de,{type:"selection",width:"55"}),e(de,{prop:"diseaseCode",label:"\u75BE\u75C5\u7F16\u7801",width:"120"}),e(de,{prop:"diseaseName",label:"\u75BE\u75C5\u540D\u79F0"}),e(de,{prop:"diseCategory.diseCategoryName",label:"\u75BE\u75C5\u5206\u7C7B"})]),_:1},8,["data"]),e(Ne,{style:{"margin-top":"15px"},layout:"prev, pager, next, jumper, ->, total",total:C.value,"current-page":E.value,"page-size":M.value,onCurrentChange:j},null,8,["total","current-page","page-size"])]),_:1},8,["modelValue"])]),_:1})}}};var Ya=dt(Ja,[["__scopeId","data-v-024b6769"]]);const Ga={class:"container",style:{padding:"20px"}},Qa={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Za={key:1},el={key:0},tl={key:0,class:"result-images-container"},al={class:"dialog-footer"},pt=180,ll=16,nl={__name:"Doc05",props:{patient:{type:Object,default:null},isDiagnosed:{type:Boolean,default:!1}},setup(_){const ne=st(),S=_,U=m(!1),H=m(""),z=m([]),T=m({total:0,size:5,current:1}),J=m([]),X=m([]),P=m(null),F=m(!1),C=m([]),E=m([]),M=m(""),te=m([]),q=m(null),Y=m(!1),fe=m([]),j=m(!1),O=m(null),Z=Ge(()=>C.value.reduce((N,s)=>N+(s.price||0),0).toFixed(2));Xe(()=>S.patient,async(N,s)=>{if(N&&N.id&&(!s||N.id!==s.id))try{const v=await Ve("/neudoc/medicalrecord/getByRegistId",{registId:N.id});if(v.data&&v.data.data&&v.data.data.id)q.value=v.data.data.id;else{const r={registId:N.id,caseNumber:N.caseNumber},h=await pe("/neudoc/medicalrecord/save",r);if(h.data&&h.data.data&&h.data.data.id)q.value=h.data.data.id;else{i.error("\u521B\u5EFA\u65B0\u75C5\u5386\u5931\u8D25\uFF0C\u65E0\u6CD5\u7EE7\u7EED\u64CD\u4F5C");return}}G(N.id),k()}catch(v){console.error("\u83B7\u53D6\u6216\u521B\u5EFA\u75C5\u5386\u5931\u8D25",v),i.error("\u51C6\u5907\u60A3\u8005\u75C5\u5386\u4FE1\u606F\u65F6\u51FA\u9519\uFF0C\u8BF7\u91CD\u8BD5")}else N||(C.value=[],M.value="",q.value=null,te.value=[])},{immediate:!0,deep:!0});async function G(N){const s=`/checkapply/page?registId=${N}&recordType=${pt}&count=100`;try{const v=await Ve(s);C.value=v.data.data.records.map(r=>({...r})),C.value.length>0?(C.value[0].objective&&(M.value=C.value[0].objective),C.value[0].medicalId&&(q.value=C.value[0].medicalId)):M.value=""}catch(v){console.error("\u52A0\u8F7D\u5904\u7F6E\u7533\u8BF7\u5931\u8D25:",v),C.value=[],M.value="",q.value=null}}async function k(){const N=`/checktemplate/page?recordType=${pt}&doctorId=${ne.userInfo.id}&count=100`;try{const s=await Ve(N);te.value=s.data.data.records}catch(s){console.error("\u52A0\u8F7D\u5904\u7F6E\u6A21\u677F\u5931\u8D25:",s)}}async function w(){const N="/department/page?count=200";try{const s=await Ve(N);X.value=s.data.data.records}catch(s){console.error("\u52A0\u8F7D\u6267\u884C\u79D1\u5BA4\u5931\u8D25:",s)}}async function b(N=1){const s=`/fmeditem/page?expClassId=${ll}&pn=${N}&count=${T.value.size}&keyword=${H.value}`;try{const v=await Ve(s);z.value=v.data.data.records,T.value.total=v.data.data.total,T.value.current=v.data.data.current}catch(v){console.error("\u52A0\u8F7D\u5904\u7F6E\u9879\u76EE\u5931\u8D25:",v)}}function oe(N){b(N)}function B(){if(!S.patient){i.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u4F4D\u60A3\u8005");return}U.value=!0,H.value="",z.value=[],F.value=!1,P.value=null,w(),b(1)}function ae(N){J.value=N}function se(N){E.value=N}async function ge(){if(J.value.length===0){i.warning("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5904\u7F6E\u9879\u76EE");return}if(!P.value){i.warning("\u8BF7\u9009\u62E9\u6267\u884C\u79D1\u5BA4");return}const N=J.value.map(v=>({medicalId:q.value,registId:S.patient.id,itemId:v.id,name:v.itemName,itemName:v.itemName,objective:M.value,isUrgent:F.value?1:0,num:1,state:1,recordType:pt,doctorId:ne.userInfo.id,deptId:P.value,price:v.price})),s=await pe("/checkapply/add",N);s.data.result?(i.success("\u9879\u76EE\u5DF2\u4FDD\u5B58"),U.value=!1,G(S.patient.id)):i.error(s.data.errMsg||"\u4FDD\u5B58\u5931\u8D25")}async function re(){if(E.value.length===0){i.warning("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u9879\u76EE");return}const N=E.value.filter(s=>s.id).map(s=>s.id);if(N.length>0)try{await pe("/checkapply/del",N)}catch{i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u5220\u9664\u5931\u8D25");return}C.value=C.value.filter(s=>!E.value.some(v=>v===s)),i.success("\u5220\u9664\u6210\u529F"),E.value=[]}async function Ce(){if(E.value.length===0){i.warning("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5904\u7F6E\u9879\u76EE\u3002");return}if(C.value.some(v=>!v.state)){i.warning("\u6709\u65B0\u9879\u76EE\u5C1A\u672A\u6682\u5B58\uFF0C\u8BF7\u5148\u70B9\u51FB\u201C\u6682\u5B58\u201D\u6309\u94AE\u3002");return}const N=E.value.filter(v=>v.id).map(v=>v.id);if(N.length===0)return;const s={ids:N,state:2};try{await pe("/checkapply/updateState",s),i.success("\u5F00\u7ACB\u6210\u529F"),G(S.patient.id),E.value=[]}catch{i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u5F00\u7ACB\u5931\u8D25")}}async function de(){if(E.value.length===0){i.warning("\u8BF7\u9009\u62E9\u8981\u4F5C\u5E9F\u7684\u9879\u76EE");return}E.value.some(v=>!v.id)&&i.warning("\u65B0\u9879\u76EE\u65E0\u6CD5\u88AB\u4F5C\u5E9F\uFF0C\u8BF7\u5148\u6682\u5B58\u6216\u5220\u9664\u3002");const N=E.value.filter(v=>v.id).map(v=>v.id);if(N.length===0)return;const s={ids:N,state:0};try{await pe("/checkapply/updateState",s),i.success("\u4F5C\u5E9F\u6210\u529F"),G(S.patient.id),E.value=[]}catch{i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u4F5C\u5E9F\u5931\u8D25")}}async function _e(N){try{const s=await Ve(`/checkrelation/items?templateId=${N.id}`);if(s.data.result&&s.data.data){const v=s.data.data;if(v.length>0){const r=[];v.forEach(h=>{C.value.some(K=>K.itemId===h.id)||r.push({id:null,registId:S.patient.id,itemId:h.id,itemName:h.itemName,price:h.price,deptId:h.deptId,deptName:h.deptName,isUrgent:0})}),r.length>0?(C.value.push(...r),await saveApplyItems(),i.success(`\u5957\u7EC4"${N.name}"\u5DF2\u6DFB\u52A0\u5E76\u6682\u5B58`)):i.info("\u5957\u7EC4\u4E2D\u7684\u9879\u76EE\u5DF2\u5B58\u5728\u3002")}}else i.error("\u83B7\u53D6\u5957\u7EC4\u9879\u76EE\u5931\u8D25")}catch(s){console.error("\u4F7F\u7528\u6A21\u677F\u5931\u8D25:",s),i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u4F7F\u7528\u6A21\u677F\u5931\u8D25")}}async function ie(N){try{const s=await Ve(`/checkrelation/items?templateId=${N.id}`);s.data.result&&s.data.data?(fe.value=s.data.data,Y.value=!0):i.error("\u83B7\u53D6\u5957\u7EC4\u8BE6\u60C5\u5931\u8D25")}catch(s){console.error("\u83B7\u53D6\u5957\u7EC4\u8BE6\u60C5\u5931\u8D25:",s),i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u83B7\u53D6\u5957\u7EC4\u8BE6\u60C5\u5931\u8D25")}}async function be(N){qe.confirm(`\u786E\u5B9A\u8981\u5220\u9664\u5957\u7EC4 " ${N.name} " \u5417\uFF1F`,"\u786E\u8BA4\u5220\u9664",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{try{await pe("/checktemplate/del",N),i.success("\u5220\u9664\u6210\u529F"),k()}catch{i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u5220\u9664\u5931\u8D25")}}).catch(()=>{})}async function Ne(){if(C.value.length===0){i.warning("\u6CA1\u6709\u53EF\u5B58\u4E3A\u5957\u7EC4\u7684\u9879\u76EE");return}qe.prompt("\u8BF7\u8F93\u5165\u5957\u7EC4\u540D\u79F0","\u5B58\u4E3A\u5957\u7EC4",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",inputPattern:/.+/,inputErrorMessage:"\u5957\u7EC4\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}).then(async({value:N})=>{const s=C.value.map(r=>r.itemId),v={name:N,scope:"3",recordType:`${pt}`,userId:ne.userInfo.id,itemIds:s};try{await pe("/checktemplate/add",v),i.success("\u5957\u7EC4\u4FDD\u5B58\u6210\u529F"),k()}catch{i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u4FDD\u5B58\u5931\u8D25")}}).catch(()=>{})}const we=N=>{N.resultImages&&typeof N.resultImages=="string"?N.resultImages=N.resultImages.split(",").map(s=>s.trim()).filter(s=>s):N.resultImages||(N.resultImages=[]),O.value=N,j.value=!0};return(N,s)=>{const v=d("el-button"),r=d("el-input"),h=d("el-form-item"),K=d("el-table-column"),me=d("el-table"),le=d("el-pagination"),Te=d("el-option"),De=d("el-select"),Oe=d("el-switch"),Ee=d("el-form"),Be=d("el-dialog"),Fe=d("el-tag"),c=d("el-space"),D=d("el-empty"),u=d("el-card"),l=d("el-col"),o=d("el-row"),a=d("el-descriptions-item"),y=d("el-descriptions"),A=d("el-divider"),$=d("el-image");return R(),ve("div",Ga,[e(Be,{title:"\u65B0\u589E\u5904\u7F6E\u7533\u8BF7",modelValue:U.value,"onUpdate:modelValue":s[5]||(s[5]=f=>U.value=f),width:"40%"},{default:t(()=>[e(Ee,{size:"mini"},{default:t(()=>[e(h,null,{default:t(()=>[e(r,{modelValue:H.value,"onUpdate:modelValue":s[1]||(s[1]=f=>H.value=f),placeholder:"\u6309\u7F16\u7801/\u540D\u79F0/\u62FC\u97F3\u641C\u7D22...",class:"input-with-select",style:{width:"100%"}},{prepend:t(()=>s[11]||(s[11]=[g("\u5904\u7F6E\u540D\u79F0\uFF1A")])),append:t(()=>[e(v,{icon:L(tt),onClick:s[0]||(s[0]=f=>b(1))},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(me,{border:"",data:z.value,size:"mini","max-height":"250px",onSelectionChange:ae},{default:t(()=>[e(K,{type:"selection",width:"55"}),e(K,{property:"itemCode",label:"\u7F16\u7801",width:"120"}),e(K,{property:"itemName",label:"\u9879\u76EE\u540D\u79F0"}),e(K,{property:"price",label:"\u5355\u4EF7",width:"80"})]),_:1},8,["data"])]),_:1}),e(h,null,{default:t(()=>[T.value.total>0?(R(),ue(le,{key:0,small:"",background:"",layout:"prev, pager, next",total:T.value.total,"page-size":T.value.size,"current-page":T.value.current,onCurrentChange:oe,style:{"margin-top":"10px","text-align":"center"}},null,8,["total","page-size","current-page"])):ke("",!0)]),_:1}),e(h,{label:"\u6267\u884C\u79D1\u5BA4"},{default:t(()=>[e(De,{placeholder:"\u8BF7\u9009\u62E9",modelValue:P.value,"onUpdate:modelValue":s[2]||(s[2]=f=>P.value=f)},{default:t(()=>[(R(!0),ve(ot,null,rt(X.value,f=>(R(),ue(Te,{key:f.id,label:f.deptName,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(h,{label:"\u662F\u5426\u52A0\u6025\uFF1A"},{default:t(()=>[e(Oe,{modelValue:F.value,"onUpdate:modelValue":s[3]||(s[3]=f=>F.value=f),"active-color":"#13ce66"},null,8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(v,{type:"primary",onClick:ge},{default:t(()=>s[12]||(s[12]=[g("\u786E \u5B9A")])),_:1,__:[12]}),e(v,{onClick:s[4]||(s[4]=f=>U.value=!1)},{default:t(()=>s[13]||(s[13]=[g("\u53D6 \u6D88")])),_:1,__:[13]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(o,{gutter:20},{default:t(()=>[e(l,{span:16},{default:t(()=>[e(c,{direction:"vertical",alignment:"stretch",style:{width:"100%"}},{default:t(()=>[e(u,{shadow:"never"},{header:t(()=>[x("div",Qa,[e(c,null,{default:t(()=>[e(Fe,null,{default:t(()=>s[14]||(s[14]=[g("\u672C\u9879\u76EE\u91D1\u989D\u5408\u8BA1:")])),_:1,__:[14]}),e(Fe,{type:"warning"},{default:t(()=>[g(he(Z.value)+"\u5143",1)]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(v,{type:"primary",icon:L(gt),onClick:B,disabled:_.isDiagnosed},{default:t(()=>s[15]||(s[15]=[g("\u65B0\u589E\u9879\u76EE")])),_:1,__:[15]},8,["icon","disabled"]),e(v,{type:"danger",icon:L(nt),onClick:re,disabled:_.isDiagnosed},{default:t(()=>s[16]||(s[16]=[g("\u5220\u9664\u9879\u76EE")])),_:1,__:[16]},8,["icon","disabled"]),e(v,{type:"success",icon:L(yt),onClick:Ce,disabled:_.isDiagnosed},{default:t(()=>s[17]||(s[17]=[g("\u5F00\u7ACB")])),_:1,__:[17]},8,["icon","disabled"]),e(v,{icon:L(_t),onClick:de,disabled:_.isDiagnosed},{default:t(()=>s[18]||(s[18]=[g("\u4F5C\u5E9F")])),_:1,__:[18]},8,["icon","disabled"]),e(v,{icon:L(St),onClick:Ne,disabled:_.isDiagnosed},{default:t(()=>s[19]||(s[19]=[g("\u5B58\u4E3A\u5957\u7EC4")])),_:1,__:[19]},8,["icon","disabled"])]),_:1})])]),default:t(()=>[e(me,{data:C.value,style:{width:"100%"},onSelectionChange:se,"row-style":{cursor:_.isDiagnosed?"default":"pointer"}},{empty:t(()=>[e(D,{description:_.isDiagnosed?"\u60A3\u8005\u5DF2\u8BCA\u6BD5":"\u6682\u65E0\u5904\u7F6E\u9879\u76EE"},null,8,["description"])]),default:t(()=>[e(K,{type:"selection",selectable:()=>!_.isDiagnosed},null,8,["selectable"]),e(K,{property:"itemName",label:"\u9879\u76EE\u540D\u79F0"}),e(K,{property:"deptName",label:"\u6267\u884C\u79D1\u5BA4",width:"100"}),e(K,{label:"\u52A0\u6025",width:"60",align:"center"},{default:t(f=>[e(Fe,{type:f.row.isUrgent===1?"danger":"info",size:"small"},{default:t(()=>[g(he(f.row.isUrgent===1?"\u662F":"\u5426"),1)]),_:2},1032,["type"])]),_:1}),e(K,{label:"\u72B6\u6001",width:"80",align:"center"},{default:t(f=>[x("span",null,he(f.row.state===1?"\u6682\u5B58":f.row.state===2?"\u5DF2\u5F00\u7ACB":"\u5DF2\u4F5C\u5E9F"),1)]),_:1}),e(K,{property:"price",label:"\u5355\u4EF7",width:"80"}),e(K,{label:"\u5904\u7F6E\u7ED3\u679C",align:"center"},{default:t(f=>[f.row.resultDesc||f.row.resultImages?(R(),ue(v,{key:0,type:"primary",link:"",size:"small",onClick:n=>we(f.row)},{default:t(()=>s[20]||(s[20]=[g(" \u67E5\u770B ")])),_:2,__:[20]},1032,["onClick"])):(R(),ve("span",Za,"--"))]),_:1})]),_:1},8,["data","row-style"])]),_:1}),e(u,{shadow:"never"},{header:t(()=>s[21]||(s[21]=[x("span",null,"\u76EE\u7684\u8981\u6C42",-1)])),default:t(()=>[e(r,{type:"textarea",modelValue:M.value,"onUpdate:modelValue":s[6]||(s[6]=f=>M.value=f),rows:4,placeholder:"\u3010\u5904\u7F6E\u76EE\u7684\uFF1A\u3011\u3010\u60A3\u8005\u4E3B\u8BC9\uFF1A\u3011\u3010\u73B0\u75C5\u53F2\uFF1A\u3011",resize:"none",disabled:_.isDiagnosed},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(l,{span:8},{default:t(()=>[e(u,{shadow:"never"},{header:t(()=>s[22]||(s[22]=[x("span",null,"\u5904\u7F6E\u5957\u7EC4",-1)])),default:t(()=>[e(me,{data:te.value,style:{width:"100%"}},{empty:t(()=>[e(D,{description:_.isDiagnosed?"\u60A3\u8005\u5DF2\u8BCA\u6BD5":"\u6682\u65E0\u5904\u7F6E\u5957\u7EC4"},null,8,["description"])]),default:t(()=>[e(K,{prop:"name",label:"\u540D\u79F0"}),e(K,{fixed:"right",label:"\u64CD\u4F5C",width:"180",align:"center"},{default:t(f=>[e(c,null,{default:t(()=>[e(v,{onClick:lt(n=>_e(f.row),["prevent"]),type:"primary",text:"",size:"small",disabled:_.isDiagnosed},{default:t(()=>s[23]||(s[23]=[g("\u4F7F\u7528")])),_:2,__:[23]},1032,["onClick","disabled"]),e(v,{onClick:lt(n=>ie(f.row),["prevent"]),type:"info",text:"",size:"small"},{default:t(()=>s[24]||(s[24]=[g("\u8BE6\u7EC6")])),_:2,__:[24]},1032,["onClick"]),e(v,{onClick:lt(n=>be(f.row),["prevent"]),type:"danger",text:"",size:"small",disabled:_.isDiagnosed},{default:t(()=>s[25]||(s[25]=[g("\u5220\u9664")])),_:2,__:[25]},1032,["onClick","disabled"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),e(Be,{title:"\u5957\u7EC4\u8BE6\u60C5",modelValue:Y.value,"onUpdate:modelValue":s[8]||(s[8]=f=>Y.value=f),width:"30%"},{footer:t(()=>[e(v,{onClick:s[7]||(s[7]=f=>Y.value=!1)},{default:t(()=>s[26]||(s[26]=[g("\u5173 \u95ED")])),_:1,__:[26]})]),default:t(()=>[e(me,{data:fe.value,border:"",size:"mini"},{default:t(()=>[e(K,{property:"itemName",label:"\u9879\u76EE\u540D\u79F0"}),e(K,{property:"price",label:"\u5355\u4EF7"})]),_:1},8,["data"])]),_:1},8,["modelValue"]),e(Be,{title:"\u5904\u7F6E\u7ED3\u679C\u8BE6\u60C5",modelValue:j.value,"onUpdate:modelValue":s[10]||(s[10]=f=>j.value=f),width:"50%"},{footer:t(()=>[x("span",al,[e(v,{type:"primary",onClick:s[9]||(s[9]=f=>j.value=!1)},{default:t(()=>s[28]||(s[28]=[g("\u786E \u5B9A")])),_:1,__:[28]})])]),default:t(()=>[O.value?(R(),ve("div",el,[e(y,{column:1,border:""},{default:t(()=>[e(a,{"label-class-name":"result-label",label:"\u7ED3\u679C\u63CF\u8FF0"},{default:t(()=>[g(he(O.value.resultDesc||"\u6682\u65E0\u63CF\u8FF0"),1)]),_:1})]),_:1}),e(A,{"content-position":"left"},{default:t(()=>s[27]||(s[27]=[g("\u7ED3\u679C\u56FE\u7247")])),_:1,__:[27]}),O.value.resultImages&&O.value.resultImages.length>0?(R(),ve("div",tl,[(R(!0),ve(ot,null,rt(O.value.resultImages,(f,n)=>(R(),ue($,{key:n,class:"result-image-item",src:f,"preview-src-list":O.value.resultImages,"initial-index":n,fit:"cover",lazy:""},null,8,["src","preview-src-list","initial-index"]))),128))])):(R(),ue(D,{key:1,description:"\u6682\u65E0\u56FE\u7247"}))])):ke("",!0)]),_:1},8,["modelValue"])])}}};var ol=dt(nl,[["__scopeId","data-v-593ac4da"]]);const sl={style:{display:"flex","justify-content":"space-between","align-items":"center"}},il={style:{display:"flex","justify-content":"space-between","align-items":"center"}},rl={class:"ai-dialog-title"},dl={class:"ai-dialog-content"},ul={key:0,class:"ai-section-block"},cl=["innerHTML"],pl={key:1,class:"ai-section-block ai-section-comment"},fl=["innerHTML"],ml={__name:"Doc06",props:{patient:{type:Object,default:null},isDiagnosed:{type:Boolean,default:!1}},setup(_){const ne=st(),S=_,U=m(""),H=m(null),z=m([]),T=m(null),J=m([]),X=m([]),P=m([]),F=m(""),C=m(null),E=m([]),M=m(!1),te=m(!1),q=m(!1),Y=m(""),fe=m(""),j=m({}),O=m(""),Z=m(!1),G=m(!1);let k=null,w=null,b="";const oe=m(null),B=m(null);Xe(()=>S.patient,o=>{o&&o.id?se():ae()},{immediate:!0,deep:!0});function ae(){U.value="",H.value=null,z.value=[],T.value=null,J.value=[]}async function se(){var o;if(!!((o=S.patient)!=null&&o.id))try{const a=await Ve(`/neudoc/medicalrecord/getByRegistId?registId=${S.patient.id}`);a&&a.data&&a.data.data?(H.value=a.data.data.id,U.value=a.data.data.diagnosis):(i.warning("\u672A\u627E\u5230\u60A3\u8005\u75C5\u5386\u4FE1\u606F"),ae()),await ge(),await me()}catch(a){console.error(a),i.error("\u52A0\u8F7D\u60A3\u8005\u4FE1\u606F\u5931\u8D25")}}async function ge(){var o;if(!!((o=S.patient)!=null&&o.id))try{const a=await Ve("/prescription/page",{registId:S.patient.id,count:100});a&&a.data&&a.data.data&&a.data.data.records?(z.value=a.data.data.records,T.value&&!z.value.find(y=>y.id===T.value.id)&&(T.value=null,J.value=[])):z.value=[]}catch(a){console.error("\u52A0\u8F7D\u5904\u65B9\u5217\u8868\u5931\u8D25",a),i.error("\u52A0\u8F7D\u5904\u65B9\u5217\u8868\u5931\u8D25")}}function re(){if(!H.value){i.warning("\u8BF7\u5148\u786E\u8BA4\u60A3\u8005\u7684\u75C5\u5386\u4FE1\u606F\uFF01");return}Y.value="",M.value=!0}async function Ce(){const o={medicalId:H.value,registId:S.patient.id,userId:ne.userInfo.id,prescriptionName:Y.value||`\u65B0\u589E\u5904\u65B9_${Date.now()}`};try{await pe("/prescription/add",o),i.success("\u5904\u65B9\u5DF2\u6DFB\u52A0"),M.value=!1,await ge()}catch{i.error("\u6DFB\u52A0\u5904\u65B9\u5931\u8D25")}}async function de(){if(!T.value){i.warning("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u5904\u65B9");return}const o=T.value.prescriptionState;if(o!==1&&o!==3){i.error("\u53EA\u80FD\u5220\u9664\u6682\u5B58\u6216\u4F5C\u5E9F\u72B6\u6001\u7684\u5904\u65B9\uFF01");return}await qe.confirm(`\u786E\u8BA4\u5220\u9664\u5904\u65B9 "${T.value.prescriptionName}"?`,"\u8B66\u544A",{type:"warning"});try{await pe("/prescription/del",[T.value.id]),i.success("\u5904\u65B9\u5DF2\u5220\u9664"),T.value=null,J.value=[],await ge()}catch{i.error("\u5220\u9664\u5904\u65B9\u5931\u8D25")}}async function _e(){if(!T.value){i.warning("\u8BF7\u9009\u62E9\u8981\u5F00\u7ACB\u7684\u5904\u65B9");return}await be(2,"\u5F00\u7ACB")}async function ie(){if(!T.value){i.warning("\u8BF7\u9009\u62E9\u8981\u4F5C\u5E9F\u7684\u5904\u65B9");return}await be(3,"\u4F5C\u5E9F")}async function be(o,a){try{await qe.confirm(`\u786E\u8BA4\u8981${a}\u9009\u4E2D\u7684\u5904\u65B9\u5417?`,"\u63D0\u793A"),await pe("/prescription/updateState",{ids:[T.value.id],prescriptionState:o}),i.success(`\u5904\u65B9\u5DF2${a}`),await ge()}catch(y){y!=="cancel"&&i.error(`${a}\u64CD\u4F5C\u5931\u8D25`)}}function Ne(o){T.value=o,we(o.id)}async function we(o){try{const a=await Ve("/prescriptiondetailed/page",{prescriptionId:o,count:500});a&&a.data&&a.data.data&&a.data.data.records?J.value=a.data.data.records:J.value=[]}catch{i.error("\u52A0\u8F7D\u5904\u65B9\u660E\u7EC6\u5931\u8D25"),J.value=[]}}function N(){if(!T.value){i.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u5904\u65B9");return}if(T.value.prescriptionState!==1){i.error("\u53EA\u80FD\u4E3A\u6682\u5B58\u72B6\u6001\u7684\u5904\u65B9\u589E\u5220\u836F\u54C1\uFF01");return}fe.value="",te.value=!0}async function s(o,a){if(o)try{const y=await Ve("/drugs/page",{keyword:o,count:20});console.log("Response from /drugs/page:",y),y&&y.data&&y.data.data&&y.data.data.records?a(y.data.data.records):a([])}catch(y){console.error("\u52A0\u8F7D\u836F\u54C1\u5931\u8D25:",y),a([])}else a([])}function v(o){j.value={prescriptionId:T.value.id,drugsId:o.id,drugsPrice:o.drugsPrice,amount:1,drugsName:o.drugsName,drugsUsage:"\u9075\u533B\u5631",dosage:"\u9075\u533B\u5631",frequency:"\u6BCF\u65E5\u4E00\u6B21"},q.value=!0}async function r(){try{await pe("/prescriptiondetailed/add",j.value),i.success("\u836F\u54C1\u5DF2\u6DFB\u52A0"),q.value=!1,te.value=!1,await we(T.value.id)}catch{i.error("\u6DFB\u52A0\u836F\u54C1\u5931\u8D25")}}async function h(){if(X.value.length!==0){if(T.value.prescriptionState!==1){i.error("\u53EA\u80FD\u4E3A\u6682\u5B58\u72B6\u6001\u7684\u5904\u65B9\u589E\u5220\u836F\u54C1\uFF01");return}try{await qe.confirm(`\u786E\u8BA4\u5220\u9664\u9009\u4E2D\u7684 ${X.value.length} \u9879\u836F\u54C1\u5417?`,"\u8B66\u544A",{type:"warning"});const o=X.value.map(a=>a.id);await pe("/prescriptiondetailed/del",o),i.success("\u836F\u54C1\u5DF2\u5220\u9664"),await we(T.value.id)}catch(o){o!=="cancel"&&i.error("\u5220\u9664\u836F\u54C1\u5931\u8D25")}}}function K(o){X.value=o}async function me(){try{const o=await Ve("/drugstemplate/page",{keyword:F.value,scope:"3",count:100,userId:ne.userInfo.id});o&&o.data&&o.data.data&&o.data.data.records?P.value=o.data.data.records:P.value=[]}catch{i.error("\u52A0\u8F7D\u6A21\u677F\u5931\u8D25")}}async function le(o){C.value=o;try{const a=await Ve("/drugstemplate/details",{templateId:o.id});a&&a.data&&a.data.data?E.value=a.data.data:E.value=[]}catch{i.error("\u52A0\u8F7D\u6A21\u677F\u8BE6\u60C5\u5931\u8D25")}}async function Te(){if(!(!C.value||!T.value)){if(T.value.prescriptionState!==1){i.error("\u53EA\u80FD\u4E3A\u6682\u5B58\u72B6\u6001\u7684\u5904\u65B9\u4F7F\u7528\u6A21\u677F\uFF01");return}try{await pe("/prescription/addByTemplate",{prescriptionId:T.value.id,templateId:C.value.id}),i.success("\u6A21\u677F\u5DF2\u5E94\u7528"),await we(T.value.id)}catch{i.error("\u5E94\u7528\u6A21\u677F\u5931\u8D25")}}}function De(o){return{1:"\u6682\u5B58",2:"\u5DF2\u5F00\u7ACB",3:"\u4F5C\u5E9F"}[o]||"\u672A\u77E5"}function Oe(o){return{1:"\u4E2A\u4EBA",2:"\u79D1\u5BA4",3:"\u5168\u9662"}[o]||"\u672A\u77E5"}function Ee(o){return o.replace(/\*\*[^*]+\*\*/g,"").replace(/\*\*/g,"").trim()}function Be(o){const a=Ee(o),y={analysis:"",comment:""},A=a.match(/([\s\S]*?)(评价[：:][\s\S]*)/);return A?(y.analysis=A[1].trim(),y.comment=A[2].replace(/^评价[：:]/,"").trim()):y.analysis=a,y}function Fe(o){const a=["\u5B58\u5728\u95EE\u9898","\u4E0D\u5408\u7406","\u5EFA\u8BAE\u8C03\u6574","\u8B66\u60D5","\u6CE8\u610F","\u9700\u6539\u8FDB","\u98CE\u9669","\u8B66\u544A","\u9700\u5173\u6CE8","\u9700\u6CE8\u610F","\u9700\u8B66\u60D5","\u4E0D\u5EFA\u8BAE","\u9519\u8BEF","\u7981\u5FCC","\u51B2\u7A81","\u91CD\u590D","\u5242\u91CF\u8FC7\u5927","\u5242\u91CF\u8FC7\u5C0F","\u8D85\u91CF","\u6F0F\u7528","\u9057\u6F0F","\u614E\u7528","\u8B66\u793A","\u8B66\u62A5","\u5F02\u5E38","\u7591\u4F3C","\u9700\u4F18\u5316","\u9700\u8C03\u6574","\u9700\u5B8C\u5584","\u9700\u8865\u5145","\u9700\u4FEE\u6B63","\u9700\u6392\u67E5","\u9700\u89C4\u907F","\u9700\u9632\u8303","\u9700\u8B66\u89C9","\u9700\u8B66\u9192","\u9700\u91CD\u89C6","\u9700\u907F\u514D","\u9700\u9632\u6B62","\u9700\u7EA0\u6B63","\u9700\u8865\u6551","\u9700\u4FEE\u590D","\u9700\u8865\u5168","\u9700\u8865\u5F3A","\u9700\u8865\u507F","\u9700\u8865\u8DB3","\u9700\u8865\u9F50"],y=new RegExp(`(${a.join("|")})([sS]*?)([\u3002\uFF1B;
]|$)`,"g");return o.replace(y,(A,$,f,n)=>`<span class='ai-unreasonable-highlight'>${$}${f}${n}</span>`)}const c=Ge(()=>{const o=Be(O.value);return{analysis:o.analysis?Fe(o.analysis):"",comment:o.comment?Fe(o.comment):""}});function D(){O.value="",w&&clearInterval(w),k&&(k.close(),k=null),b=""}function u(o){w&&clearInterval(w);let a=0;const y=O.value,A=Ee(o);w=setInterval(()=>{O.value=y+A.slice(y.length,y.length+a+1),a++,y.length+a>=A.length&&clearInterval(w)},18)}Xe(O,async()=>{await It(),oe.value&&oe.value.wrapRef&&(oe.value.wrapRef.scrollTop=oe.value.wrapRef.scrollHeight),B.value&&B.value.scrollIntoView&&B.value.scrollIntoView({behavior:"smooth",block:"end"})});async function l(){if(!T.value||J.value.length===0){i.warning("\u8BF7\u9009\u62E9\u5904\u65B9\u5E76\u786E\u4FDD\u6709\u836F\u54C1");return}D(),Z.value=!0,G.value=!0;const o={diagnosis:U.value,drugs:J.value.map(A=>({name:A.drugsName,usage:A.drugsUsage,dosage:A.dosage,frequency:A.frequency,amount:A.amount}))},a=encodeURIComponent(JSON.stringify(o)),y=ne.userInfo.token||localStorage.getItem("token");k=new ft.exports.EventSourcePolyfill(`/ai/ana?message=${a}`,{headers:{token:y}}),k.onmessage=function(A){let $=A.data.trim();if($.startsWith("data:")&&($=$.substring(5).trim()),!($===""||$.startsWith(":")))try{const f=JSON.parse($);if(f.output&&f.output.choices&&f.output.choices.length>0){const n=f.output.choices[0].message;n&&n.content&&(b=n.content,u(b))}}catch(f){console.warn("\u65E0\u6CD5\u89E3\u6790SSE\u4E2D\u7684JSON\u7247\u6BB5:",A.data,f)}},k.onerror=function(){Z.value=!1,k&&k.close()}}return(o,a)=>{const y=d("el-tag"),A=d("el-col"),$=d("el-button"),f=d("el-button-group"),n=d("el-row"),p=d("el-card"),I=d("el-table-column"),Q=d("el-empty"),ee=d("el-table"),ye=d("el-input"),ce=d("el-aside"),xe=d("el-main"),Ue=d("el-container"),We=d("el-tab-pane"),ze=d("el-tabs"),Re=d("el-dialog"),Ie=d("el-autocomplete"),je=d("el-form-item"),He=d("el-input-number"),Qe=d("el-form"),W=d("el-scrollbar");return R(),ue(Ue,{direction:"vertical",style:{height:"100%",padding:"10px"}},{default:t(()=>[e(n,{gutter:10,style:{"margin-bottom":"10px"}},{default:t(()=>[e(A,{span:24},{default:t(()=>[e(p,{shadow:"never"},{default:t(()=>[e(n,{justify:"space-between",align:"middle"},{default:t(()=>[e(A,{span:12},{default:t(()=>[e(y,null,{default:t(()=>a[15]||(a[15]=[g("\u5F53\u524D\u8BCA\u65AD:")])),_:1,__:[15]}),e(y,{type:"info",style:{"margin-left":"10px"}},{default:t(()=>[g(he(U.value||"\u6682\u65E0"),1)]),_:1})]),_:1}),e(A,{span:12,style:{"text-align":"right"}},{default:t(()=>[e(f,null,{default:t(()=>[e($,{type:"primary",icon:L(ht),onClick:re,disabled:_.isDiagnosed},{default:t(()=>a[16]||(a[16]=[g("\u589E\u65B9")])),_:1,__:[16]},8,["icon","disabled"]),e($,{type:"danger",icon:L(nt),onClick:de,disabled:_.isDiagnosed},{default:t(()=>a[17]||(a[17]=[g("\u5220\u65B9")])),_:1,__:[17]},8,["icon","disabled"]),e($,{type:"success",icon:L(yt),onClick:_e,disabled:_.isDiagnosed},{default:t(()=>a[18]||(a[18]=[g("\u5F00\u7ACB")])),_:1,__:[18]},8,["icon","disabled"]),e($,{type:"warning",icon:L(_t),onClick:ie,disabled:_.isDiagnosed},{default:t(()=>a[19]||(a[19]=[g("\u4F5C\u5E9F")])),_:1,__:[19]},8,["icon","disabled"]),e($,{icon:L(mt),onClick:se,disabled:_.isDiagnosed},{default:t(()=>a[20]||(a[20]=[g("\u5237\u65B0")])),_:1,__:[20]},8,["icon","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(n,{gutter:10,style:{height:"calc(100% - 120px)"}},{default:t(()=>[e(A,{span:6},{default:t(()=>[e(p,{shadow:"never",style:{height:"100%",display:"flex","flex-direction":"column"}},{header:t(()=>a[21]||(a[21]=[x("span",null,"\u5904\u65B9\u5217\u8868",-1)])),default:t(()=>[e(ee,{data:z.value,"highlight-current-row":"",onRowClick:Ne,height:"100%",style:{flex:"1"},"row-style":{cursor:_.isDiagnosed?"default":"pointer"}},{empty:t(()=>[e(Q,{description:"\u6682\u65E0\u5904\u65B9"})]),default:t(()=>[e(I,{prop:"prescriptionName",label:"\u540D\u79F0"}),e(I,{prop:"prescriptionState",label:"\u72B6\u6001",width:"70"},{default:t(V=>[g(he(De(V.row.prescriptionState)),1)]),_:1})]),_:1},8,["data","row-style"])]),_:1})]),_:1}),e(A,{span:18},{default:t(()=>[e(p,{shadow:"never",style:{height:"100%",display:"flex","flex-direction":"column"}},{header:t(()=>[x("div",sl,[x("span",null,he(T.value?T.value.prescriptionName:"\u5904\u65B9\u660E\u7EC6"),1),e(f,null,{default:t(()=>[e($,{type:"primary",icon:L(ht),size:"small",onClick:N,disabled:!T.value||_.isDiagnosed},{default:t(()=>a[22]||(a[22]=[g("\u589E\u836F")])),_:1,__:[22]},8,["icon","disabled"]),e($,{type:"danger",icon:L(nt),size:"small",onClick:h,disabled:X.value.length===0||_.isDiagnosed},{default:t(()=>a[23]||(a[23]=[g("\u5220\u836F")])),_:1,__:[23]},8,["icon","disabled"]),e($,{type:"info",size:"small",onClick:l,disabled:!T.value||J.value.length===0},{default:t(()=>a[24]||(a[24]=[g("\u5206\u6790\u836F\u65B9")])),_:1,__:[24]},8,["disabled"])]),_:1})])]),default:t(()=>[e(ee,{data:J.value,onSelectionChange:K,height:"100%",style:{flex:"1"},"row-style":{cursor:_.isDiagnosed?"default":"pointer"}},{empty:t(()=>[e(Q,{description:"\u8BF7\u5148\u5728\u5DE6\u4FA7\u9009\u62E9\u5904\u65B9"})]),default:t(()=>[e(I,{type:"selection",width:"55",selectable:()=>!_.isDiagnosed},null,8,["selectable"]),e(I,{prop:"drugsName",label:"\u836F\u54C1\u540D\u79F0"}),e(I,{prop:"drugsFormat",label:"\u89C4\u683C",width:"120"}),e(I,{prop:"drugsPrice",label:"\u5355\u4EF7",width:"80"}),e(I,{prop:"drugsUsage",label:"\u7528\u6CD5",width:"100"}),e(I,{prop:"dosage",label:"\u7528\u91CF",width:"80"}),e(I,{prop:"frequency",label:"\u9891\u6B21",width:"80"}),e(I,{prop:"amount",label:"\u6570\u91CF",width:"80"})]),_:1},8,["data","row-style"])]),_:1})]),_:1})]),_:1}),e(n,{gutter:10,style:{"margin-top":"10px"}},{default:t(()=>[e(A,{span:24},{default:t(()=>[e(ze,{type:"border-card"},{default:t(()=>[e(We,{label:"\u5904\u65B9\u6A21\u677F"},{default:t(()=>[e(Ue,null,{default:t(()=>[e(ce,{width:"400px",style:{"padding-right":"10px"}},{default:t(()=>[e(ye,{modelValue:F.value,"onUpdate:modelValue":a[0]||(a[0]=V=>F.value=V),placeholder:"\u641C\u7D22\u6A21\u677F",onInput:me,clearable:""},null,8,["modelValue"]),e(ee,{data:P.value,"highlight-current-row":"",onRowClick:le,size:"small",style:{"margin-top":"10px"},"row-style":{cursor:_.isDiagnosed?"default":"pointer"}},{default:t(()=>[e(I,{prop:"name",label:"\u6A21\u677F\u540D\u79F0"}),e(I,{prop:"scope",label:"\u8303\u56F4",width:"80"},{default:t(V=>[g(he(Oe(V.row.scope)),1)]),_:1})]),_:1},8,["data","row-style"])]),_:1}),e(xe,{style:{padding:"0"}},{default:t(()=>[e(p,{shadow:"never"},{header:t(()=>[x("div",il,[a[26]||(a[26]=x("span",null,"\u6A21\u677F\u660E\u7EC6",-1)),e($,{type:"primary",onClick:Te,disabled:!C.value||!T.value||_.isDiagnosed},{default:t(()=>a[25]||(a[25]=[g("\u4F7F\u7528\u8BE5\u6A21\u677F")])),_:1,__:[25]},8,["disabled"])])]),default:t(()=>[e(ee,{data:E.value,size:"small"},{default:t(()=>[e(I,{prop:"drugsName",label:"\u836F\u54C1"}),e(I,{prop:"drugsFormat",label:"\u89C4\u683C"}),e(I,{prop:"drugsUsage",label:"\u7528\u6CD5"}),e(I,{prop:"dosage",label:"\u7528\u91CF"})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Re,{title:"\u65B0\u589E\u5904\u65B9",modelValue:M.value,"onUpdate:modelValue":a[3]||(a[3]=V=>M.value=V),width:"30%"},{footer:t(()=>[e($,{onClick:a[2]||(a[2]=V=>M.value=!1)},{default:t(()=>a[27]||(a[27]=[g("\u53D6\u6D88")])),_:1,__:[27]}),e($,{type:"primary",onClick:Ce},{default:t(()=>a[28]||(a[28]=[g("\u786E\u5B9A")])),_:1,__:[28]})]),default:t(()=>[e(ye,{modelValue:Y.value,"onUpdate:modelValue":a[1]||(a[1]=V=>Y.value=V),placeholder:"\u9ED8\u8BA4\u4E3A'\u65B0\u589E\u5904\u65B9+\u65F6\u95F4\u6233'"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(Re,{title:"\u6DFB\u52A0\u836F\u54C1",modelValue:te.value,"onUpdate:modelValue":a[6]||(a[6]=V=>te.value=V),width:"60%"},{footer:t(()=>[e($,{onClick:a[5]||(a[5]=V=>te.value=!1)},{default:t(()=>a[29]||(a[29]=[g("\u5173\u95ED")])),_:1,__:[29]})]),default:t(()=>[e(Ie,{modelValue:fe.value,"onUpdate:modelValue":a[4]||(a[4]=V=>fe.value=V),"fetch-suggestions":s,placeholder:"\u641C\u7D22\u836F\u54C1",style:{width:"100%","margin-bottom":"10px"},onSelect:v,"value-key":"drugsName"},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(Re,{title:"\u7F16\u8F91\u836F\u54C1\u8BE6\u60C5",modelValue:q.value,"onUpdate:modelValue":a[12]||(a[12]=V=>q.value=V),width:"30%"},{footer:t(()=>[e($,{onClick:a[11]||(a[11]=V=>q.value=!1)},{default:t(()=>a[30]||(a[30]=[g("\u53D6\u6D88")])),_:1,__:[30]}),e($,{type:"primary",onClick:r},{default:t(()=>a[31]||(a[31]=[g("\u786E\u5B9A")])),_:1,__:[31]})]),default:t(()=>[e(Qe,{model:j.value,"label-width":"80px"},{default:t(()=>[e(je,{label:"\u836F\u54C1"},{default:t(()=>[g(he(j.value.drugsName),1)]),_:1}),e(je,{label:"\u7528\u6CD5"},{default:t(()=>[e(ye,{modelValue:j.value.drugsUsage,"onUpdate:modelValue":a[7]||(a[7]=V=>j.value.drugsUsage=V)},null,8,["modelValue"])]),_:1}),e(je,{label:"\u7528\u91CF"},{default:t(()=>[e(ye,{modelValue:j.value.dosage,"onUpdate:modelValue":a[8]||(a[8]=V=>j.value.dosage=V)},null,8,["modelValue"])]),_:1}),e(je,{label:"\u9891\u6B21"},{default:t(()=>[e(ye,{modelValue:j.value.frequency,"onUpdate:modelValue":a[9]||(a[9]=V=>j.value.frequency=V)},null,8,["modelValue"])]),_:1}),e(je,{label:"\u6570\u91CF"},{default:t(()=>[e(He,{modelValue:j.value.amount,"onUpdate:modelValue":a[10]||(a[10]=V=>j.value.amount=V),min:1},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(Re,{modelValue:G.value,"onUpdate:modelValue":a[14]||(a[14]=V=>G.value=V),width:"540px","close-on-click-modal":!1,"close-on-press-escape":!0,class:"ai-dialog-beauty"},{title:t(()=>[x("div",rl,[a[33]||(a[33]=x("i",{class:"el-icon-s-opportunity ai-title-icon"},null,-1)),a[34]||(a[34]=x("span",{class:"ai-title-gradient"},"AI\u836F\u65B9\u5206\u6790",-1)),Z.value?(R(),ue(y,{key:0,type:"info",size:"mini",style:{"margin-left":"10px"}},{default:t(()=>a[32]||(a[32]=[g("\u5206\u6790\u4E2D...")])),_:1,__:[32]})):ke("",!0)])]),footer:t(()=>[e($,{onClick:a[13]||(a[13]=V=>G.value=!1)},{default:t(()=>a[38]||(a[38]=[g("\u5173\u95ED")])),_:1,__:[38]})]),default:t(()=>[x("div",dl,[!O.value&&!Z.value?(R(),ue(Q,{key:0,description:"\u6682\u65E0AI\u5206\u6790\u7ED3\u679C"})):(R(),ue(W,{key:1,class:"ai-scrollbar-beauty",ref_key:"aiScrollbarRef",ref:oe},{default:t(()=>[e(Tt,{name:"ai-fade-expand",mode:"out-in"},{default:t(()=>[c.value.analysis||c.value.comment?(R(),ve("div",{key:"ai-content",class:"ai-typewriter-content-beauty ai-dialog-content-inner",ref_key:"aiContentRef",ref:B},[c.value.analysis?(R(),ve("div",ul,[a[35]||(a[35]=x("span",{class:"ai-section-title"},"\u836F\u65B9\u5206\u6790\u7ED3\u679C",-1)),x("div",{class:"ai-section-text",innerHTML:c.value.analysis},null,8,cl)])):ke("",!0),c.value.comment?(R(),ve("div",pl,[a[36]||(a[36]=x("div",{class:"ai-section-divider"},null,-1)),a[37]||(a[37]=x("span",{class:"ai-section-title ai-section-title-comment"},"AI\u7EFC\u5408\u8BC4\u4EF7",-1)),x("div",{class:"ai-section-text ai-section-text-comment",innerHTML:c.value.comment},null,8,fl)])):ke("",!0)],512)):ke("",!0)]),_:1})]),_:1},512))])]),_:1},8,["modelValue"])]),_:1})}}};var vl=dt(ml,[["__scopeId","data-v-6d907fbe"]]);const gl={class:"container"},yl={__name:"doc07",props:{patient:{type:Object,default:null}},setup(_){const ne=_,S=m({keyword:"",itemType:""}),U=m([]),H=Ge(()=>U.value.filter(F=>!F.payTime&&!F.backId).reduce((F,C)=>F+C.price*C.amount,0).toFixed(2)),z=async()=>{let F={...S.value};if(F.itemType===""&&delete F.itemType,!F.keyword){U.value=[];return}const C=await Ve("/patientcosts/list",F);C&&C.data&&C.data.result?U.value=C.data.data:(U.value=[],i.error("\u83B7\u53D6\u8D39\u7528\u5217\u8868\u5931\u8D25"))},T=()=>{z()},J=async()=>{if(!ne.patient||!ne.patient.id){i.warning("\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u60A3\u8005");return}const F=await pe("/patientcosts/doPay",{registId:ne.patient.id});F.data.result?(i.success("\u6A21\u62DF\u7F34\u8D39\u6210\u529F"),z()):i.error(F.data.errMsg||"\u7F34\u8D39\u5931\u8D25")},X=F=>F.backId?"info":F.payTime?"success":"warning",P=F=>F.backId?"\u5DF2\u9000\u8D39":F.payTime?"\u5DF2\u6536\u8D39":"\u672A\u6536\u8D39";return Xe(()=>ne.patient,F=>{F&&F.caseNumber?(S.value.keyword=F.caseNumber,z()):(S.value.keyword="",U.value=[])},{immediate:!0,deep:!0}),(F,C)=>{const E=d("el-input"),M=d("el-form-item"),te=d("el-option"),q=d("el-select"),Y=d("el-button"),fe=d("el-form"),j=d("el-row"),O=d("el-tag"),Z=d("el-table-column"),G=d("el-table");return R(),ve("div",gl,[e(j,null,{default:t(()=>[e(fe,{inline:!0,model:S.value,class:"demo-form-inline"},{default:t(()=>[e(M,{label:"\u75C5\u5386\u53F7/\u59D3\u540D"},{default:t(()=>[e(E,{modelValue:S.value.keyword,"onUpdate:modelValue":C[0]||(C[0]=k=>S.value.keyword=k),placeholder:"\u75C5\u5386\u53F7/\u59D3\u540D",disabled:""},null,8,["modelValue"])]),_:1}),e(M,{label:"\u9879\u76EE\u7C7B\u522B"},{default:t(()=>[e(q,{modelValue:S.value.itemType,"onUpdate:modelValue":C[1]||(C[1]=k=>S.value.itemType=k),placeholder:"\u9879\u76EE\u7C7B\u522B",clearable:"",style:{width:"120px"}},{default:t(()=>[e(te,{label:"\u5168\u90E8",value:""}),e(te,{label:"\u975E\u836F\u54C1",value:"1"}),e(te,{label:"\u836F\u54C1",value:"2"})]),_:1},8,["modelValue"])]),_:1}),e(M,null,{default:t(()=>[e(Y,{type:"primary",onClick:T},{default:t(()=>C[2]||(C[2]=[g("\u67E5\u8BE2")])),_:1,__:[2]})]),_:1}),e(M,null,{default:t(()=>[e(Y,{type:"success",onClick:J},{default:t(()=>C[3]||(C[3]=[g("\u68C0\u67E5\u7F34\u8D39")])),_:1,__:[3]})]),_:1})]),_:1},8,["model"])]),_:1}),e(j,{style:{"background-color":"#EAF1F5"}},{default:t(()=>[e(O,{size:"mini"},{default:t(()=>C[4]||(C[4]=[g("\u60A3\u8005\u8D26\u5355\u660E\u7EC6\uFF1A")])),_:1,__:[4]})]),_:1}),e(j,{style:{margin:"5px"}},{default:t(()=>[e(G,{data:U.value,style:{width:"100%"},ref:"singleTable"},{default:t(()=>[e(Z,{type:"index",width:"50"}),e(Z,{property:"name",label:"\u540D\u79F0"}),e(Z,{property:"price",label:"\u5355\u4EF7",width:"100"}),e(Z,{property:"amount",label:"\u6570\u91CF",width:"100"}),e(Z,{label:"\u91D1\u989D",width:"100"},{default:t(k=>[g(he((k.row.price*k.row.amount).toFixed(2)),1)]),_:1}),e(Z,{label:"\u6536\u8D39\u72B6\u6001",width:"100"},{default:t(k=>[e(O,{type:X(k.row)},{default:t(()=>[g(he(P(k.row)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1}),e(j,{style:{margin:"5px"}},{default:t(()=>[e(O,{size:"mini"},{default:t(()=>C[5]||(C[5]=[g("\u91D1\u989D\u5408\u8BA1\uFF1A")])),_:1,__:[5]}),x("span",null,he(H.value)+"\u5143",1)]),_:1})])}}};const _l={class:"patient-info-bar"},bl={key:0,class:"patient-details"},wl={key:1,class:"placeholder-text"},Dl={__name:"DocHome",setup(_){const ne=st(),S=m(!1),U=m(!1),H=m({}),z=m({}),T=m(null),J=m(null),X=m(null),P=m(""),F=m(!0),C=m(null),E=m(!1),M=m(!0);Dt(async()=>{te(1),q(1)});async function te(w){S.value=!0;const b=kt(new Date),oe=`count=100&pn=${w}&regDate=${b}&deptId=${ne.getUserInfo.value.deptID}&docId=${ne.getUserInfo.value.id}${P.value?`&keyword=${P.value}`:""}`;try{const[B,ae]=await Promise.all([Ke(`/register/page?state=1&${oe}`,null),Ke(`/register/page?state=2&${oe}`,null)]);if(B.result&&ae.result){const se=B.data.records||[],ge=ae.data.records||[],re=[...se,...ge];re.sort((Ce,de)=>de.id-Ce.id),H.value={...B.data,records:re,total:B.data.total+ae.data.total}}else i.error("\u52A0\u8F7D\u672A\u8BCA\u60A3\u8005\u5217\u8868\u5931\u8D25"),(B.errMsg==="\u672A\u767B\u5F55"||ae.errMsg==="\u672A\u767B\u5F55")&&Ct.push("/login")}catch(B){i.error("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u52A0\u8F7D\u672A\u8BCA\u60A3\u8005\u5217\u8868\u5931\u8D25"),console.error(B)}finally{S.value=!1}}async function q(w){U.value=!0;var b=kt(new Date);let oe=`/register/page?count=100&pn=${w}&state=3&regDate=${b}`;oe+=`&deptId=${ne.getUserInfo.value.deptID}`,oe+=`&docId=${ne.getUserInfo.value.id}`,P.value&&(oe+=`&keyword=${P.value}`);const B=await Ke(oe,null);B.result?(z.value=B.data,U.value=!1):B.errMsg=="\u672A\u767B\u5F55"&&Ct.push("/login")}const Y=m("1"),fe=()=>{},j=(w,b,oe)=>{C.value=w,M.value=!0,E.value=!1},O=(w,b,oe)=>{M.value=!1,C.value=w,E.value=!0};function Z(){te(1),q(1)}function G(){te(1),q(1)}const k=async()=>{if(!C.value){i.error("\u8BF7\u5148\u9009\u62E9\u4E00\u4F4D\u60A3\u8005");return}try{await T.value.save(),await qe.confirm(`\u786E\u5B9A\u8981\u7ED3\u675F\u5BF9\u3010${C.value.realName}\u3011\u7684\u8BCA\u65AD\u5417\uFF1F`,"\u8BCA\u6BD5\u786E\u8BA4",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"});const w=await pe("/register/finish",{id:C.value.id});w.data.result?(i.success("\u8BCA\u6BD5\u6210\u529F"),G(),C.value=null,M.value=!1,Y.value="1"):i.error(w.data.errMsg||"\u8BCA\u6BD5\u5931\u8D25")}catch(w){console.error("\u8BCA\u6BD5\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF:",w),w&&w.message&&!w.message.includes("No patient selected")&&w!=="cancel"||w==="cancel"&&i.info("\u64CD\u4F5C\u5DF2\u53D6\u6D88")}};return(w,b)=>{const oe=d("el-tag"),B=d("el-col"),ae=d("el-button"),se=d("el-row"),ge=d("el-input"),re=d("el-table-column"),Ce=d("el-table"),de=d("el-aside"),_e=d("el-space"),ie=d("el-tab-pane"),be=d("el-tabs"),Ne=d("el-main"),we=d("el-container"),N=Bt("loading");return R(),ue(we,null,{default:t(()=>[vt(e(de,{width:"250px",class:"sidebar-card"},{default:t(()=>[e(se,null,{default:t(()=>[e(B,{span:12,style:{"text-align":"left"}},{default:t(()=>[e(oe,{size:"mini",style:{width:"100%"},class:"sidebar-section-title"},{default:t(()=>b[3]||(b[3]=[g("\u60A3\u8005\u9009\u62E9\uFF1A")])),_:1,__:[3]})]),_:1}),e(B,{span:12,style:{"text-align":"right"}},{default:t(()=>[e(ae,{type:"primary",icon:L(mt),size:"small",onClick:G,style:{"margin-right":"5px"}},null,8,["icon"])]),_:1})]),_:1}),e(se,null,{default:t(()=>[e(B,{span:24},{default:t(()=>[e(ge,{modelValue:P.value,"onUpdate:modelValue":b[0]||(b[0]=s=>P.value=s),placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9",class:"input-with-select sidebar-search"},{prepend:t(()=>b[4]||(b[4]=[g("\u60A3\u8005\u540D:")])),append:t(()=>[e(ae,{icon:L(tt),onClick:Z},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(se,null,{default:t(()=>[e(B,{span:24,style:{"margin-top":"20px"}},{default:t(()=>[e(oe,{size:"mini",style:{width:"100%"},class:"sidebar-section-title"},{default:t(()=>b[5]||(b[5]=[g("\u672A\u8BCA\u60A3\u8005\uFF1A")])),_:1,__:[5]}),vt((R(),ue(Ce,{data:H.value.records,style:{width:"100%"},onRowClick:j,class:"sidebar-table"},{default:t(()=>[e(re,{prop:"caseNumber",label:"\u75C5\u5386\u53F7",align:"center"}),e(re,{prop:"realName",label:"\u59D3\u540D",align:"center"}),e(re,{prop:"gender",label:"\u6027\u522B",width:"70",align:"center"},{default:t(s=>[g(he(s.row.gender==71?"\u7537":"\u5973"),1)]),_:1}),e(re,{prop:"age",label:"\u5E74\u9F84",align:"center"})]),_:1},8,["data"])),[[N,S.value]])]),_:1})]),_:1}),e(se,null,{default:t(()=>[e(B,{span:24,style:{"margin-top":"20px"}},{default:t(()=>[e(oe,{size:"mini",style:{width:"100%"},class:"sidebar-section-title"},{default:t(()=>b[6]||(b[6]=[g("\u5DF2\u8BCA\u60A3\u8005\uFF1A")])),_:1,__:[6]}),vt((R(),ue(Ce,{data:z.value.records,style:{width:"100%"},onRowClick:O,class:"sidebar-table"},{default:t(()=>[e(re,{prop:"caseNumber",label:"\u75C5\u5386\u53F7",align:"center"}),e(re,{prop:"realName",label:"\u59D3\u540D",align:"center"}),e(re,{prop:"gender",label:"\u6027\u522B",width:"70",align:"center"},{default:t(s=>[g(he(s.row.gender==71?"\u7537":"\u5973"),1)]),_:1}),e(re,{prop:"age",label:"\u5E74\u9F84",align:"center"})]),_:1},8,["data"])),[[N,U.value]])]),_:1})]),_:1})]),_:1},512),[[jt,F.value]]),e(Ne,{style:{"padding-top":"0px"}},{default:t(()=>[x("div",_l,[e(ae,{icon:F.value?L(Ht):L(Lt),text:"",circle:"",onClick:b[1]||(b[1]=s=>F.value=!F.value),title:F.value?"\u9690\u85CF\u60A3\u8005\u680F":"\u663E\u793A\u60A3\u8005\u680F"},null,8,["icon","title"]),C.value?(R(),ve("div",bl,[e(_e,{size:20,spacer:"|"},{default:t(()=>[x("span",null,[b[7]||(b[7]=x("strong",null,"\u59D3\u540D:",-1)),g(" "+he(C.value.realName),1)]),x("span",null,[b[8]||(b[8]=x("strong",null,"\u75C5\u5386\u53F7:",-1)),g(" "+he(C.value.caseNumber),1)]),x("span",null,[b[9]||(b[9]=x("strong",null,"\u6027\u522B:",-1)),g(" "+he(C.value.gender===71?"\u7537":"\u5973"),1)]),x("span",null,[b[10]||(b[10]=x("strong",null,"\u5E74\u9F84:",-1)),g(" "+he(C.value.age),1)])]),_:1})])):(R(),ve("div",wl," \u8BF7\u4ECE\u5DE6\u4FA7\u9009\u62E9\u4E00\u4F4D\u60A3\u8005 ")),C.value&&M.value?(R(),ue(ae,{key:2,type:"success",onClick:k,icon:L(Pt),round:""},{default:t(()=>b[11]||(b[11]=[g(" \u8BCA\u6BD5 ")])),_:1,__:[11]},8,["icon"])):ke("",!0)]),e(se,null,{default:t(()=>[e(be,{modelValue:Y.value,"onUpdate:modelValue":b[2]||(b[2]=s=>Y.value=s),type:"card",class:"demo-tabs",onTabClick:fe},{default:t(()=>[e(ie,{label:"\u75C5\u5386\u9996\u9875",name:"1"},{default:t(()=>[e(Da,{ref_key:"medicalRecordComp",ref:T,patient:C.value,"is-diagnosed":E.value},null,8,["patient","is-diagnosed"])]),_:1}),e(ie,{label:"\u68C0\u67E5\u7533\u8BF7",name:"2"},{default:t(()=>[Y.value==="2"?(R(),ue(za,{key:0,ref_key:"checkApplyComp",ref:J,patient:C.value,"is-diagnosed":E.value},null,8,["patient","is-diagnosed"])):ke("",!0)]),_:1}),e(ie,{label:"\u68C0\u9A8C\u7533\u8BF7",name:"3"},{default:t(()=>[Y.value==="3"?(R(),ue(Pa,{key:0,ref_key:"testApplyComp",ref:X,patient:C.value,"is-diagnosed":E.value},null,8,["patient","is-diagnosed"])):ke("",!0)]),_:1}),e(ie,{label:"\u95E8\u8BCA\u786E\u8BCA",name:"4"},{default:t(()=>[Y.value==="4"?(R(),ue(Ya,{key:0,patient:C.value,"is-diagnosed":E.value},null,8,["patient","is-diagnosed"])):ke("",!0)]),_:1}),e(ie,{label:"\u5904\u7F6E\u7533\u8BF7",name:"5"},{default:t(()=>[Y.value==="5"?(R(),ue(ol,{key:0,patient:C.value,"is-diagnosed":E.value},null,8,["patient","is-diagnosed"])):ke("",!0)]),_:1}),e(ie,{label:"\u5904\u65B9\u7533\u8BF7",name:"6"},{default:t(()=>[Y.value==="6"?(R(),ue(vl,{key:0,patient:C.value,"is-diagnosed":E.value},null,8,["patient","is-diagnosed"])):ke("",!0)]),_:1}),e(ie,{label:"\u8D39\u7528\u67E5\u8BE2*",name:"7"},{default:t(()=>[Y.value==="7"?(R(),ue(yl,{key:0,patient:C.value},null,8,["patient"])):ke("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(se)]),_:1})]),_:1})}}};export{Dl as default};
